var GlobalParams={video:{zIndex:1},background:{zIndex:0}};window.paella=window.paella||{},paella.player=null,paella.version="5.3.4 - build: 92cc4ff",function(){if(window.paella_debug_baseUrl)paella.baseUrl=window.paella_debug_baseUrl;else{var e=document.getElementsByTagName("script"),t=e[e.length-1].src.split("/");t.pop(),t.pop(),paella.baseUrl=t.join("/")+"/"}}(),paella.events={play:"paella:play",pause:"paella:pause",next:"paella:next",previous:"paella:previous",seeking:"paella:seeking",seeked:"paella:seeked",timeupdate:"paella:timeupdate",timeUpdate:"paella:timeupdate",seekTo:"paella:setseek",endVideo:"paella:endvideo",seekToTime:"paella:seektotime",setTrim:"paella:settrim",setPlaybackRate:"paella:setplaybackrate",setVolume:"paella:setVolume",setComposition:"paella:setComposition",loadStarted:"paella:loadStarted",loadComplete:"paella:loadComplete",loadPlugins:"paella:loadPlugins",error:"paella:error",setProfile:"paella:setprofile",documentChanged:"paella:documentChanged",didSaveChanges:"paella:didsavechanges",controlBarWillHide:"paella:controlbarwillhide",controlBarDidHide:"paella:controlbardidhide",controlBarDidShow:"paella:controlbardidshow",hidePopUp:"paella:hidePopUp",showPopUp:"paella:showPopUp",enterFullscreen:"paella:enterFullscreen",exitFullscreen:"paella:exitFullscreen",resize:"paella:resize",videoZoomChanged:"paella:videoZoomChanged",audioLanguageChanged:"paella:audiolanguagechanged",zoomAvailabilityChanged:"paella:zoomavailabilitychanged",qualityChanged:"paella:qualityChanged",singleVideoReady:"paella:singleVideoReady",singleVideoUnloaded:"paella:singleVideoUnloaded",videoReady:"paella:videoReady",videoUnloaded:"paella:videoUnloaded",controlBarLoaded:"paella:controlBarLoaded",flashVideoEvent:"paella:flashVideoEvent",captionAdded:"paella:caption:add",captionsEnabled:"paella:caption:enabled",captionsDisabled:"paella:caption:disabled",trigger:function(e,t){$(document).trigger(e,t)},bind:function(e,t){$(document).bind(e,function(e,a){t(e,a)})},setupExternalListener:function(){window.addEventListener("message",function(e){e.data&&e.data.event&&paella.events.trigger(e.data.event,e.data.params)},!1)}},paella.events.setupExternalListener(),Class("paella.MouseManager",{targetObject:null,initialize:function(){var e=this;paella.events.bind("mouseup",function(t){e.up(t)}),paella.events.bind("mousemove",function(t){e.move(t)}),paella.events.bind("mouseover",function(t){e.over(t)})},down:function(e,t){return this.targetObject=e,this.targetObject&&this.targetObject.down&&(this.targetObject.down(t,t.pageX,t.pageY),t.cancelBubble=!0),!1},up:function(e){return this.targetObject&&this.targetObject.up&&(this.targetObject.up(e,e.pageX,e.pageY),e.cancelBubble=!0),this.targetObject=null,!1},out:function(e){return this.targetObject&&this.targetObject.out&&(this.targetObject.out(e,e.pageX,e.pageY),e.cancelBubble=!0),!1},move:function(e){return this.targetObject&&this.targetObject.move&&(this.targetObject.move(e,e.pageX,e.pageY),e.cancelBubble=!0),!1},over:function(e){return this.targetObject&&this.targetObject.over&&(this.targetObject.over(e,e.pageX,e.pageY),e.cancelBubble=!0),!1}}),function(){var e=document.createElement("link");e.rel="stylesheet",e.href=paella.baseUrl+"resources/bootstrap/css/bootstrap.min.css",e.type="text/css",e.media="screen",e.charset="utf-8",document.head.appendChild(e)}(),paella.utils={mouseManager:new paella.MouseManager,folders:{get:function(e){if(paella.player&&paella.player.config&&paella.player.config.folders&&paella.player.config.folders[e])return paella.player.config.folders[e]},profiles:function(){return paella.baseUrl+(paella.utils.folders.get("profiles")||"config/profiles")},resources:function(){return paella.baseUrl+(paella.utils.folders.get("resources")||"resources")},skins:function(){return paella.baseUrl+(paella.utils.folders.get("skins")||paella.utils.folders.get("resources")+"/style")}},styleSheet:{removeById:function(e){var t=$(document.head).find("#"+e)[0];t&&document.head.removeChild(t)},remove:function(e){for(var t=document.head.getElementsByTagName("link"),a=0;a<t.length;++a)if(t[a].href){document.head.removeChild(t[a]);break}},add:function(e,t){var a=document.createElement("link");a.rel="stylesheet",a.href=e,a.type="text/css",a.media="screen",a.charset="utf-8",t&&(a.id=t),document.head.appendChild(a)},swap:function(e,t){this.remove(e),this.add(t)}},skin:{set:function(e){paella.utils.styleSheet.removeById("paellaSkin"),paella.utils.styleSheet.add(paella.utils.folders.skins()+"/style_"+e+".css"),base.cookies.set("skin",e)},restore:function(e){var t=base.cookies.get("skin");t&&""!=t?this.set(t):this.set(e)}},timeParse:{timeToSeconds:function(e){var t=0,a=0,i=0;return/([0-9]+)h/i.test(e)&&(t=60*parseInt(RegExp.$1)*60),/([0-9]+)m/i.test(e)&&(a=60*parseInt(RegExp.$1)),/([0-9]+)s/i.test(e)&&(i=parseInt(RegExp.$1)),t+a+i},secondsToTime:function(e){var t=~~(e/3600);t<10&&(t="0"+t);var a=~~(e%3600/60);a<10&&(a="0"+a);var i=Math.floor(e%60);return i<10&&(i="0"+i),t+":"+a+":"+i},secondsToText:function(e){if(e<=1)return base.dictionary.translate("1 second ago");if(e<60)return base.dictionary.translate("{0} seconds ago").replace(/\{0\}/g,e);var t=Math.round(e/60);if(t<=1)return base.dictionary.translate("1 minute ago");if(t<60)return base.dictionary.translate("{0} minutes ago").replace(/\{0\}/g,t);var a=Math.round(e/3600);if(a<=1)return base.dictionary.translate("1 hour ago");if(a<24)return base.dictionary.translate("{0} hours ago").replace(/\{0\}/g,a);var i=Math.round(e/86400);if(i<=1)return base.dictionary.translate("1 day ago");if(i<24)return base.dictionary.translate("{0} days ago").replace(/\{0\}/g,i);var n=Math.round(e/2592e3);if(n<=1)return base.dictionary.translate("1 month ago");if(n<12)return base.dictionary.translate("{0} months ago").replace(/\{0\}/g,n);var r=Math.round(e/31536e3);return r<=1?base.dictionary.translate("1 year ago"):base.dictionary.translate("{0} years ago").replace(/\{0\}/g,r)},matterhornTextDateToDate:function(e){var t=new Date;return t.setFullYear(parseInt(e.substring(0,4),10)),t.setMonth(parseInt(e.substring(5,7),10)-1),t.setDate(parseInt(e.substring(8,10),10)),t.setHours(parseInt(e.substring(11,13),10)),t.setMinutes(parseInt(e.substring(14,16),10)),t.setSeconds(parseInt(e.substring(17,19),10)),t}}},Class("paella.DataDelegate",{read:function(e,t,a){"function"==typeof a&&a({},!0)},write:function(e,t,a,i){"function"==typeof i&&i({},!0)},remove:function(e,t,a){"function"==typeof a&&a({},!0)}}),paella.dataDelegates={},function(){let e={},t=[];paella.Data=class{get enabled(){return this._enabled}get dataDelegates(){return t}constructor(a){this._enabled=a.data.enabled;let i=[];for(let t in e){let n=e[t],r=null,s=null;i.some(e=>{if(e.callback==n)return s=e.delegateName,!0})||(r=e[t](),s=r.name,paella.dataDelegates[s]=r,i.push({callback:n,delegateName:s})),a.data.dataDelegates[t]||(a.data.dataDelegates[t]=s)}for(var n in a.data.dataDelegates)try{var r=a.data.dataDelegates[n],s=new(0,paella.dataDelegates[r]);t[n]=s}catch(e){console.warn("Warning: delegate not found - "+r)}this.dataDelegates.default||(this.dataDelegates.default=new paella.dataDelegates.DefaultDataDelegate)}read(e,t,a){this.getDelegate(e).read(e,t,a)}write(e,t,a,i){this.getDelegate(e).write(e,t,a,i)}remove(e,t,a){this.getDelegate(e).remove(e,t,a)}getDelegate(e){return this.dataDelegates[e]?this.dataDelegates[e]:this.dataDelegates.default}},paella.addDataDelegate=function(t,a){Array.isArray(t)?t.forEach(t=>{e[t]=a}):"string"==typeof t&&(e[t]=a)}}(),paella.addDataDelegate(["default","trimming"],()=>(paella.dataDelegates.DefaultDataDelegate=class extends paella.DataDelegate{serializeKey(e,t){return"object"==typeof t&&(t=JSON.stringify(t)),e+"|"+t}read(e,t,a){var i=this.serializeKey(e,t),n=base.cookies.get(i);try{n=unescape(n),n=JSON.parse(n)}catch(e){}"function"==typeof a&&a(n,!0)}write(e,t,a,i){var n=this.serializeKey(e,t);"object"==typeof a&&(a=JSON.stringify(a)),a=escape(a),base.cookies.set(n,a),"function"==typeof i&&i({},!0)}remove(e,t,a){var i=this.serializeKey(e,t);"object"==typeof value&&(value=JSON.stringify(value)),base.cookies.set(i,""),"function"==typeof a&&a({},!0)}},paella.dataDelegates.DefaultDataDelegate)),paella.data=null;let g_requiredScripts={};function paella_DeferredResolved(e){return new Promise(t=>{t(e)})}function paella_DeferredRejected(e){return new Promise((t,a)=>{a(e)})}function paella_DeferredNotImplemented(){return paella_DeferredRejected(new Error("not implemented"))}paella.require=function(e){return g_requiredScripts[e]||(g_requiredScripts[e]=new Promise((t,a)=>{let i=document.createElement("script");"js"==e.split(".").pop()?(i.src=e,i.async=!1,document.head.appendChild(i),setTimeout(()=>t(),100)):a(new Error("Unexpected file type"))})),g_requiredScripts[e]},Class("paella.MessageBox",{modalContainerClassName:"modalMessageContainer",frameClassName:"frameContainer",messageClassName:"messageContainer",errorClassName:"errorContainer",currentMessageBox:null,messageContainer:null,onClose:null,initialize:function(){var e=this;$(window).resize(function(t){e.adjustTop()})},showFrame:function(e,t){var a=!0,i="80%",n="80%",r=null;t&&(a=t.closeButton,i=t.width,n=t.height,r=t.onClose),this.doShowFrame(e,a,i,n,r)},doShowFrame:function(e,t,a,i,n){this.onClose=n,$("#playerContainer").addClass("modalVisible"),this.currentMessageBox&&this.close(),a||(a="80%"),i||(i="80%");var r=document.createElement("div");r.className=this.modalContainerClassName,r.style.position="fixed",r.style.top="0px",r.style.left="0px",r.style.right="0px",r.style.bottom="0px",r.style.zIndex=999999;var s=document.createElement("div");s.className=this.frameClassName,s.style.width=a,s.style.height=i,s.style.position="relative",r.appendChild(s);var l=document.createElement("iframe");l.src=e,l.setAttribute("frameborder","0"),l.style.width="100%",l.style.height="100%",s.appendChild(l),paella.player&&paella.player.isFullScreen()?paella.player.mainContainer.appendChild(r):$("body")[0].appendChild(r),this.currentMessageBox=r,this.messageContainer=s;this.adjustTop(),t&&this.createCloseButton()},showElement:function(e,t){var a=!0,i="60%",n="40%",r=null,s=this.messageClassName;t&&(s=t.className,a=t.closeButton,i=t.width,n=t.height,r=t.onClose),this.doShowElement(e,a,i,n,s,r)},showMessage:function(e,t){var a=!0,i="60%",n="40%",r=null,s=this.messageClassName;t&&(s=t.className,a=t.closeButton,i=t.width,n=t.height,r=t.onClose),this.doShowMessage(e,a,i,n,s,r)},doShowElement:function(e,t,a,i,n,r){this.onClose=r,$("#playerContainer").addClass("modalVisible"),this.currentMessageBox&&this.close(),n||(n=this.messageClassName),a||(a="80%"),i||(i="30%");var s=document.createElement("div");s.className=this.modalContainerClassName,s.style.position="fixed",s.style.top="0px",s.style.left="0px",s.style.right="0px",s.style.bottom="0px",s.style.zIndex=999999;var l=document.createElement("div");l.className=n,l.style.width=a,l.style.height=i,l.style.position="relative",l.appendChild(e),s.appendChild(l),$("body")[0].appendChild(s),this.currentMessageBox=s,this.messageContainer=l;this.adjustTop(),t&&this.createCloseButton()},doShowMessage:function(e,t,a,i,n,r){this.onClose=r,$("#playerContainer").addClass("modalVisible"),this.currentMessageBox&&this.close(),n||(n=this.messageClassName),a||(a="80%"),i||(i="30%");var s=document.createElement("div");s.className=this.modalContainerClassName,s.style.position="fixed",s.style.top="0px",s.style.left="0px",s.style.right="0px",s.style.bottom="0px",s.style.zIndex=999999;var l=document.createElement("div");l.className=n,l.style.width=a,l.style.height=i,l.style.position="relative",l.innerHTML=e,s.appendChild(l),paella.player&&paella.player.isFullScreen()?paella.player.mainContainer.appendChild(s):$("body")[0].appendChild(s),this.currentMessageBox=s,this.messageContainer=l;this.adjustTop(),t&&this.createCloseButton()},showError:function(e,t){var a=!1,i="60%",n="20%",r=null;t&&(a=t.closeButton,i=t.width,n=t.height,r=t.onClose),this.doShowError(e,a,i,n,r)},doShowError:function(e,t,a,i,n){this.doShowMessage(e,t,a,i,this.errorClassName,n)},createCloseButton:function(){if(this.messageContainer){var e=this,t=document.createElement("span");this.messageContainer.appendChild(t),t.className="paella_messageContainer_closeButton icon-cancel-circle",$(t).click(function(t){e.onCloseButtonClick()})}},adjustTop:function(){if(this.currentMessageBox){var e=$(this.messageContainer).outerHeight(),t=$(this.currentMessageBox).height()/2-e/2;this.messageContainer.style.marginTop=t+"px"}},close:function(){if(this.currentMessageBox&&this.currentMessageBox.parentNode){var e=this.currentMessageBox,t=e.parentNode;$("#playerContainer").removeClass("modalVisible"),$(e).animate({opacity:0},300,function(){t.removeChild(e)}),this.onClose&&this.onClose()}},onCloseButtonClick:function(){this.close()}}),paella.messageBox=new paella.MessageBox,paella.AntiXSS={htmlEscape:function(e){return String(e).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},htmlUnescape:function(e){return String(e).replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")}},Class("paella.Node",{identifier:"",nodeList:null,parent:null,initialize:function(e){this.nodeList={},this.identifier=e},addTo:function(e){e.addNode(this)},addNode:function(e){return e.parent=this,this.nodeList[e.identifier]=e,e},getNode:function(e){return this.nodeList[e]},removeNode:function(e){return!!this.nodeList[e.identifier]&&(delete this.nodeList[e.identifier],!0)}}),Class("paella.DomNode",paella.Node,{domElement:null,initialize:function(e,t,a){this.parent(t),this.domElement=document.createElement(e),this.domElement.id=t,a&&$(this.domElement).css(a)},addNode:function(e){var t=this.parent(e);return this.domElement.appendChild(e.domElement),t},onresize:function(){},removeNode:function(e){this.parent(e)&&this.domElement.removeChild(e.domElement)}}),Class("paella.Button",paella.DomNode,{isToggle:!1,initialize:function(e,t,a,i){this.isToggle=i;if(this.parent("div",e,{}),this.domElement.className=t,i){var n=this;$(this.domElement).click(function(e){n.toggleIcon()})}$(this.domElement).click("click",a)},isToggled:function(){if(this.isToggle){var e=this.domElement;return/([a-zA-Z0-9_]+)_active/.test(e.className)}return!1},toggle:function(){this.toggleIcon()},toggleIcon:function(){var e=this.domElement;/([a-zA-Z0-9_]+)_active/.test(e.className)?e.className=RegExp.$1:e.className=e.className+"_active"},show:function(){$(this.domElement).show()},hide:function(){$(this.domElement).hide()},visible:function(){return this.domElement.visible()}}),Class("paella.VideoQualityStrategy",{getParams:function(){return paella.player.config.player.videoQualityStrategyParams||{}},getQualityIndex:function(e){return e.length>0?e[e.length-1]:e}}),Class("paella.BestFitVideoQualityStrategy",paella.VideoQualityStrategy,{getQualityIndex:function(e){var t=e.length-1;if(e.length>0){var a=e[0],i=$(window).width()*$(window).height();if(a.res&&a.res.w&&a.res.h)for(var n=parseInt(a.res.w)*parseInt(a.res.h),r=Math.abs(i-n),s=0;s<e.length;++s){if(e[s].res){var l=parseInt(e[s].res.w)*parseInt(e[s].res.h),o=Math.abs(i-l);o<=r&&(r=o,t=s)}}}return t}}),Class("paella.LimitedBestFitVideoQualityStrategy",paella.VideoQualityStrategy,{getQualityIndex:function(e){var t=e.length-1,a=this.getParams();if(e.length>0){var i=$(window).height(),n=a.maxAutoQualityRes||720,r=Number.MAX_VALUE;e.forEach(function(e,a){e.res&&e.res.h<=n&&(Math.abs(i-e.res.h)<r&&(e,t=a))})}return t}}),Class("paella.VideoFactory",{isStreamCompatible:function(e){return!1},getVideoObject:function(e,t,a){return null}}),paella.videoFactory={_factoryList:[],initFactories:function(){if(paella.videoFactories){var e=this;paella.player.config.player.methods.forEach(function(t){t.enabled&&e.registerFactory(new paella.videoFactories[t.factory])}),this.registerFactory(new paella.videoFactories.EmptyVideoFactory)}},getVideoObject:function(e,t,a){0==this._factoryList.length&&this.initFactories();var i=null;return this._factoryList.some(function(e){if(e.isStreamCompatible(t))return i=e,!0})?i.getVideoObject(e,t,a):null},registerFactory:function(e){this._factoryList.push(e)}},function(){paella.AudioElementBase=class extends paella.DomNode{constructor(e,t){super("div",e),this._stream=t}get stream(){return this._stream}setAutoplay(){return Promise.reject(new Error("no such compatible video player"))}load(){return Promise.reject(new Error("no such compatible video player"))}play(){return Promise.reject(new Error("no such compatible video player"))}pause(){return Promise.reject(new Error("no such compatible video player"))}isPaused(){return Promise.reject(new Error("no such compatible video player"))}duration(){return Promise.reject(new Error("no such compatible video player"))}setCurrentTime(e){return Promise.reject(new Error("no such compatible video player"))}currentTime(){return Promise.reject(new Error("no such compatible video player"))}setVolume(e){return Promise.reject(new Error("no such compatible video player"))}volume(){return Promise.reject(new Error("no such compatible video player"))}setPlaybackRate(e){return Promise.reject(new Error("no such compatible video player"))}playbackRate(){return Promise.reject(new Error("no such compatible video player"))}unload(){return Promise.reject(new Error("no such compatible video player"))}supportAutoplay(){return!1}},paella.audioFactories={};paella.AudioFactory=class{isStreamCompatible(e){return!1}getAudioObject(e,t){return null}},paella.audioFactory={_factoryList:[],initFactories:function(){if(paella.audioFactories){var e=this;paella.player.config.player.audioMethods=paella.player.config.player.audioMethods||{},paella.player.config.player.audioMethods.forEach(function(t){t.enabled&&e.registerFactory(new paella.audioFactories[t.factory])})}},getAudioObject:function(e,t){0==this._factoryList.length&&this.initFactories();var a=null;return this._factoryList.some(function(e){if(e.isStreamCompatible(t))return a=e,!0})?a.getAudioObject(e,t):null},registerFactory:function(e){this._factoryList.push(e)}}}(),function(){function e(e){let t=this;return new Promise((a,i)=>{if(t._ready)a("function"!=typeof e||e());else{!function i(){t.audio.readyState>=t.audio.HAVE_CURRENT_DATA?(t._ready=!0,a("function"!=typeof e||e())):setTimeout(i,50)}()}})}paella.MultiformatAudioElement=class extends paella.AudioElementBase{constructor(e,t){super(e,t),this._streamName="audio",this._audio=document.createElement("audio"),this.domElement.appendChild(this._audio)}get audio(){return this._audio}setAutoplay(e){this.audio.autoplay=e}load(){var t=this._stream.sources[this._streamName],a=t.length>0?t[0]:null;if(this.audio.innerHTML="",a){var i=this.audio.querySelector("source");return i||(i=document.createElement("source"),this.audio.appendChild(i)),i.src=a.src,a.type&&(i.type=a.type),this.audio.load(),e.apply(this,[function(){return a}])}return Promise.reject(new Error("Could not load video: invalid quality stream index"))}play(){return e.apply(this,[()=>{this.audio.play()}])}pause(){return e.apply(this,[()=>{this.audio.pause()}])}isPaused(){return e.apply(this,[()=>this.audio.paused])}duration(){return e.apply(this,[()=>this.audio.duration])}setCurrentTime(t){return e.apply(this,[()=>{this.audio.currentTime=t}])}currentTime(){return e.apply(this,[()=>this.audio.currentTime])}setVolume(t){return e.apply(this,[()=>this.audio.volume=t])}volume(){return e.apply(this,[()=>this.audio.volume])}setPlaybackRate(t){return e.apply(this,[()=>{this.audio.playbackRate=t}])}playbackRate(){return e.apply(this,[()=>this.audio.playbackRate])}unload(){return Promise.resolve()}};paella.audioFactories.MultiformatAudioFactory=class{isStreamCompatible(e){return!0}getAudioObject(e,t){return new paella.MultiformatAudioElement(e,t)}}}(),paella.Profiles={profileList:null,getDefaultProfile:function(){return paella.player.videoContainer.masterVideo()&&paella.player.videoContainer.masterVideo().defaultProfile()?paella.player.videoContainer.masterVideo().defaultProfile():paella.player&&paella.player.config&&paella.player.config.defaultProfile?paella.player.config.defaultProfile:void 0},loadProfile:function(e,t){var a=this.getDefaultProfile();this.loadProfileList(function(i){var n;if(i[e])n=i[e];else{if(!i[a])return base.log.debug("Error loading the default profile. Check your Paella Player configuration"),!1;n=i[a]}t(n)})},loadProfileList:function(e){var t=this;if(null==this.profileList){var a={url:paella.utils.folders.profiles()+"/profiles.json"};base.ajax.get(a,function(a,i,n){"string"==typeof a&&(a=JSON.parse(a)),t.profileList=a,e(t.profileList)},function(e,t,a){base.log.debug("Error loading video profiles. Check your Paella Player configuration")})}else e(t.profileList)}},Class("paella.RelativeVideoSize",{w:1280,h:720,proportionalHeight:function(e){return Math.floor(this.h*e/this.w)},proportionalWidth:function(e){return Math.floor(this.w*e/this.h)},percentVSize:function(e){return 100*e/this.h},percentWSize:function(e){return 100*e/this.w},aspectRatio:function(){return this.w/this.h}}),Class("paella.VideoRect",paella.DomNode,{_rect:null,initialize:function(e,t,a,i,n,r){let s=paella.player.config.player.videoZoom||{},l=(void 0===s.enabled||s.enabled)&&this.allowZoom();this.parent(t,e,l?{width:this._zoom+"%",height:"100%",position:"absolute"}:{width:"100%",height:"100%"});let o=document.createElement("div");if(setTimeout(()=>this.domElement.parentElement.appendChild(o),10),o.style.position="absolute",o.style.top="0px",o.style.left="0px",o.style.right="0px",o.style.bottom="0px",this.eventCapture=o,l){function u(){let e=paella.player.config.player&&paella.player.config.player.videoZoom&&paella.player.config.player.videoZoom.minWindowSize||500,t=$(window).width()>=e;this._zoomAvailable!=t&&(this._zoomAvailable=t,paella.events.trigger(paella.events.zoomAvailabilityChanged,{available:t}))}function d(e){return{x:e.originalEvent.offsetX,y:e.originalEvent.offsetY}}function c(e,t){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))}function h(e){let t={x:this._mouseCenter.x-1.1*e.x,y:this._mouseCenter.y-1.1*e.y},a=$(this.domElement).width(),i=$(this.domElement).height(),n=this._zoom-100,r={x:t.x*n/a,y:t.y*n/i};r.x>n?r.x=n:r.x<0?r.x=0:this._mouseCenter.x=t.x,r.y>n?r.y=n:r.y<0?r.y=0:this._mouseCenter.y=t.y,$(this.domElement).css({left:"-"+r.x+"%",top:"-"+r.y+"%"}),this._zoomOffset={x:r.x,y:r.y},paella.events.trigger(paella.events.videoZoomChanged,{video:this})}this._zoomAvailable=!0,u.apply(this),$(window).resize(()=>{u.apply(this)}),this._zoom=100,this._mouseCenter={x:0,y:0},this._mouseDown={x:0,y:0},this._zoomOffset={x:0,y:0},this._maxZoom=s.max||400,$(this.domElement).css({width:"100%",height:"100%",left:"0%",top:"0%"}),Object.defineProperty(this,"zoom",{get:function(){return this._zoom}}),Object.defineProperty(this,"zoomOffset",{get:function(){return this._zoomOffset}});let e=[];$(o).on("touchstart",t=>{if(!this.allowZoom()||!this._zoomAvailable)return;e=[];let a=$(this.domElement).offset();for(let i=0;i<t.originalEvent.targetTouches.length;++i){let n=t.originalEvent.targetTouches[i];e.push({x:n.screenX-a.left,y:n.screenY-a.top})}e.length>1&&t.preventDefault()}),$(o).on("touchmove",t=>{if(!this.allowZoom()||!this._zoomAvailable)return;let a=[],i=$(this.domElement).offset();for(let e=0;e<t.originalEvent.targetTouches.length;++e){let n=t.originalEvent.targetTouches[e];a.push({x:n.screenX-i.left,y:n.screenY-i.top})}if(a.length>1&&e.length>1){let i=c(e[0],e[1]),n=c(a[0],a[1])-i,r=(p=e[0],{x:((m=e[1]).x-p.x)/2+p.x,y:(m.y-p.y)/2+p.y});this._mouseCenter=r,this._zoom+=n,this._zoom=this._zoom<100?100:this._zoom,this._zoom=this._zoom>this._maxZoom?this._maxZoom:this._zoom;let s={w:$(this.domElement).width(),h:$(this.domElement).height()},l=this._mouseCenter;$(this.domElement).css({width:this._zoom+"%",height:this._zoom+"%"});let o=this._zoom-100,u={x:l.x*o/s.w,y:l.y*o/s.h};u.x=u.x<o?u.x:o,u.y=u.y<o?u.y:o,$(this.domElement).css({left:"-"+u.x+"%",top:"-"+u.y+"%"}),this._zoomOffset={x:u.x,y:u.y},paella.events.trigger(paella.events.videoZoomChanged,{video:this}),e=a,t.preventDefault()}else if(a.length>0){let i={x:a[0].x-e[0].x,y:a[0].y-e[0].y};h.apply(this,[i]),e=a,t.preventDefault()}}),$(o).on("touchend",t=>{this.allowZoom()&&this._zoomAvailable&&e.length>1&&t.preventDefault()}),this.zoomIn=(()=>{if(this._zoom>=this._maxZoom||!this._zoomAvailable)return;this._mouseCenter||(this._mouseCenter={x:$(this.domElement).width()/2,y:$(this.domElement).height()/2}),this._zoom+=25,this._zoom=this._zoom<100?100:this._zoom,this._zoom=this._zoom>this._maxZoom?this._maxZoom:this._zoom;let e=$(this.domElement).width(),t=$(this.domElement).height(),a=this._mouseCenter;$(this.domElement).css({width:this._zoom+"%",height:this._zoom+"%"});let i=this._zoom-100,n={x:a.x*i/e,y:a.y*i/t};n.x=n.x<i?n.x:i,n.y=n.y<i?n.y:i,$(this.domElement).css({left:"-"+n.x+"%",top:"-"+n.y+"%"}),this._zoomOffset={x:n.x,y:n.y},paella.events.trigger(paella.events.videoZoomChanged,{video:this})}),this.zoomOut=(()=>{if(this._zoom<=100||!this._zoomAvailable)return;this._mouseCenter||(this._mouseCenter={x:$(this.domElement).width()/2,y:$(this.domElement).height()/2}),this._zoom-=25,this._zoom=this._zoom<100?100:this._zoom,this._zoom=this._zoom>this._maxZoom?this._maxZoom:this._zoom;let e=$(this.domElement).width(),t=$(this.domElement).height(),a=this._mouseCenter;$(this.domElement).css({width:this._zoom+"%",height:this._zoom+"%"});let i=this._zoom-100,n={x:a.x*i/e,y:a.y*i/t};n.x=n.x<i?n.x:i,n.y=n.y<i?n.y:i,$(this.domElement).css({left:"-"+n.x+"%",top:"-"+n.y+"%"}),this._zoomOffset={x:n.x,y:n.y},paella.events.trigger(paella.events.videoZoomChanged,{video:this})}),$(o).on("mousewheel wheel",e=>{if(!this.allowZoom()||!this._zoomAvailable)return;let t=d(e),a=function(e){let t=e.originalEvent.deltaY*(paella.utils.userAgent.Firefox?2:1);return-Math.abs(t)<6?t:6*Math.sign(t)}(e);if(this._zoom>=this._maxZoom&&a>0)return;this._zoom+=a,this._zoom=this._zoom<100?100:this._zoom,this._zoom=this._zoom>this._maxZoom?this._maxZoom:this._zoom;let i=$(this.domElement).width(),n=$(this.domElement).height();$(this.domElement).css({width:this._zoom+"%",height:this._zoom+"%"});let r=this._zoom-100,s={x:t.x*r/i,y:t.y*r/n};return s.x=s.x<r?s.x:r,s.y=s.y<r?s.y:r,$(this.domElement).css({left:"-"+s.x+"%",top:"-"+s.y+"%"}),this._zoomOffset={x:s.x,y:s.y},paella.events.trigger(paella.events.videoZoomChanged,{video:this}),this._mouseCenter=t,e.stopPropagation(),!1}),$(o).on("mousedown",e=>{this._mouseDown=d(e),this.drag=!0}),$(o).on("mousemove",e=>{if(this.allowZoom()&&this._zoomAvailable&&this.drag){paella.player.videoContainer.disablePlayOnClick();let t=d(e);h.apply(this,[{x:t.x-this._mouseDown.x,y:t.y-this._mouseDown.y}]),this._mouseDown=t}}),$(o).on("mouseup",e=>{this.allowZoom()&&this._zoomAvailable&&(this.drag=!1,setTimeout(()=>paella.player.videoContainer.enablePlayOnClick(),10))}),$(o).on("mouseleave",e=>{this.drag=!1})}var p,m},allowZoom:function(){return!0},setZoom:function(e,t,a,i=0){this.zoomAvailable()&&(this._zoomOffset.x=t,this._zoomOffset.y=a,this._zoom=e,0==i?$(this.domElement).css({width:this._zoom+"%",height:this._zoom+"%",left:"-"+this._zoomOffset.x+"%",top:"-"+this._zoomOffset.y+"%"}):$(this.domElement).stop(!0,!1).animate({width:this._zoom+"%",height:this._zoom+"%",left:"-"+this._zoomOffset.x+"%",top:"-"+this._zoomOffset.y+"%"},i,"linear"),paella.events.trigger(paella.events.videoZoomChanged,{video:this}))},captureFrame:function(){return Promise.resolve(null)},supportsCaptureFrame:function(){return Promise.resolve(!1)},zoomAvailable:function(){return this.allowZoom()&&this._zoomAvailable},disableEventCapture:function(){this.eventCapture.style.pointerEvents="none"},enableEventCapture:function(){this.eventCapture.style.pointerEvents=""}}),Class("paella.VideoElementBase",paella.VideoRect,{_ready:!1,_autoplay:!1,_stream:null,_videoQualityStrategy:null,initialize:function(e,t,a,i,n,r,s){this._stream=t,this.parent(e,a,i,n,r,s),Object.defineProperty(this,"ready",{get:function(){return this._ready}}),Object.defineProperty(this,"stream",{get:function(){return this._stream}}),this._stream.preview&&this.setPosterFrame(this._stream.preview)},defaultProfile:function(){return null},setVideoQualityStrategy:function(e){this._videoQualityStrategy=e},setPosterFrame:function(e){base.log.debug("TODO: implement setPosterFrame() function")},setAutoplay:function(e){this._autoplay=e},setMetadata:function(e){this._metadata=e},load:function(){return paella_DeferredNotImplemented()},supportAutoplay:function(){return!0},getVideoData:function(){return paella_DeferredNotImplemented()},play:function(){return base.log.debug("TODO: implement play() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()},pause:function(){return base.log.debug("TODO: implement pause() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()},isPaused:function(){return base.log.debug("TODO: implement isPaused() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()},duration:function(){return base.log.debug("TODO: implement duration() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()},setCurrentTime:function(e){return base.log.debug("TODO: implement setCurrentTime() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()},currentTime:function(){return base.log.debug("TODO: implement currentTime() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()},setVolume:function(e){return base.log.debug("TODO: implement setVolume() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()},volume:function(){return base.log.debug("TODO: implement volume() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()},setPlaybackRate:function(e){return base.log.debug("TODO: implement setPlaybackRate() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()},playbackRate:function(){return base.log.debug("TODO: implement playbackRate() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()},getQualities:function(){return paella_DeferredNotImplemented()},setQuality:function(e){return paella_DeferredNotImplemented()},getCurrentQuality:function(){return paella_DeferredNotImplemented()},unload:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()},getDimensions:function(){return paella_DeferredNotImplemented()},goFullScreen:function(){return paella_DeferredNotImplemented()},freeze:function(){return paella_DeferredNotImplemented()},unFreeze:function(){return paella_DeferredNotImplemented()},setClassName:function(e){this.domElement.className=e},_callReadyEvent:function(){paella.events.trigger(paella.events.singleVideoReady,{sender:this})},_callUnloadEvent:function(){paella.events.trigger(paella.events.singleVideoUnloaded,{sender:this})}}),Class("paella.EmptyVideo",paella.VideoElementBase,{initialize:function(e,t,a,i,n,r){this.parent(e,t,"div",a,i,n,r)},setPosterFrame:function(e){},setAutoplay:function(e){},load:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},play:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},pause:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},isPaused:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},duration:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},setCurrentTime:function(e){return paella_DeferredRejected(new Error("no such compatible video player"))},currentTime:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},setVolume:function(e){return paella_DeferredRejected(new Error("no such compatible video player"))},volume:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},setPlaybackRate:function(e){return paella_DeferredRejected(new Error("no such compatible video player"))},playbackRate:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},unFreeze:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},freeze:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},unload:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},getDimensions:function(){return paella_DeferredRejected(new Error("no such compatible video player"))}}),Class("paella.videoFactories.EmptyVideoFactory",paella.VideoFactory,{isStreamCompatible:function(e){return!0},getVideoObject:function(e,t,a){return new paella.EmptyVideo(e,t,a.x,a.y,a.w,a.h)}}),Class("paella.Html5Video",paella.VideoElementBase,{_posterFrame:null,_currentQuality:null,_autoplay:!1,_streamName:null,initialize:function(e,t,a,i,n,r,s){this.parent(e,t,"video",a,i,n,r),this._streamName=s||"mp4";var l=this;function o(e){(function(e){l._ready||4!=l.video.readyState||(l._ready=!0,void 0!==l._initialCurrentTipe&&(l.video.currentTime=l._initialCurrentTime,delete l._initialCurrentTime),l._callReadyEvent())}).apply(l,e)}this._playbackRate=1,this._stream.sources[this._streamName]&&this._stream.sources[this._streamName].sort(function(e,t){return e.res.h-t.res.h}),Object.defineProperty(this,"video",{get:function(){return l.domElement}}),this.video.preload="auto",this.video.setAttribute("playsinline",""),$(this.video).bind("progress",o),$(this.video).bind("loadstart",o),$(this.video).bind("loadedmetadata",o),$(this.video).bind("canplay",o),$(this.video).bind("oncanplay",o)},_deferredAction:function(e){return new Promise((t,a)=>{this.ready?t(e()):$(this.video).bind("canplay",()=>{this._ready=!0,t(e())})})},_getQualityObject:function(e,t){return{index:e,res:t.res,src:t.src,toString:function(){return this.res.w+"x"+this.res.h},shortLabel:function(){return this.res.h+"p"},compare:function(e){return this.res.w*this.res.h-e.res.w*e.res.h}}},captureFrame:function(){return new Promise(e=>{e({source:this.video,width:this.video.videoWidth,height:this.video.videoHeight})})},supportsCaptureFrame:function(){return Promise.resolve(!0)},getVideoData:function(){var e=this;return new Promise((t,a)=>{this._deferredAction(()=>{t({duration:e.video.duration,currentTime:e.video.currentTime,volume:e.video.volume,paused:e.video.paused,ended:e.video.ended,res:{w:e.video.videoWidth,h:e.video.videoHeight}})})})},setPosterFrame:function(e){this._posterFrame=e},setAutoplay:function(e){this._autoplay=e,e&&this.video&&this.video.setAttribute("autoplay",e)},load:function(){var e=this._stream.sources[this._streamName];null===this._currentQuality&&this._videoQualityStrategy&&(this._currentQuality=this._videoQualityStrategy.getQualityIndex(e));var t=this._currentQuality<e.length?e[this._currentQuality]:null;if(this.video.innerHTML="",t){var a=this.video.querySelector("source");return a||(a=document.createElement("source"),this.video.appendChild(a)),this._posterFrame&&this.video.setAttribute("poster",this._posterFrame),a.src=t.src,a.type=t.type,this.video.load(),this.video.playbackRate=this._playbackRate,this._deferredAction(function(){return t})}return paella_DeferredRejected(new Error("Could not load video: invalid quality stream index"))},getQualities:function(){return new Promise((e,t)=>{setTimeout(()=>{var t=[],a=-1;this._stream.sources[this._streamName].forEach(e=>{a++,t.push(this._getQualityObject(a,e))}),e(t)},10)})},setQuality:function(e){return new Promise(t=>{var a=this.video.paused,i=this._stream.sources[this._streamName];this._currentQuality=e<i.length?e:0;var n=this.video.currentTime;let r=this,s=function(){r.unFreeze().then(()=>{t(),r.video.removeEventListener("seeked",s,!1)})};this.freeze().then(()=>this.load()).then(()=>{a||this.play(),this.video.addEventListener("seeked",s),this.video.currentTime=n})})},getCurrentQuality:function(){return new Promise(e=>{e(this._getQualityObject(this._currentQuality,this._stream.sources[this._streamName][this._currentQuality]))})},play:function(){return this._deferredAction(()=>{this.video.play()})},pause:function(){return this._deferredAction(()=>{this.video.pause()})},isPaused:function(){return this._deferredAction(()=>this.video.paused)},duration:function(){return this._deferredAction(()=>this.video.duration)},setCurrentTime:function(e){return this._deferredAction(()=>{this.video.currentTime=e})},currentTime:function(){return this._deferredAction(()=>this.video.currentTime)},setVolume:function(e){return this._deferredAction(()=>{this.video.volume=e,0==e?(this.video.setAttribute("muted","muted"),this.video.muted=!0):(this.video.removeAttribute("muted"),this.video.muted=!1)})},volume:function(){return this._deferredAction(()=>this.video.volume)},setPlaybackRate:function(e){return this._deferredAction(()=>{this._playbackRate=e,this.video.playbackRate=e})},playbackRate:function(){return this._deferredAction(()=>this.video.playbackRate)},supportAutoplay:function(){let e=paella.utils.userAgent.system.MacOS&&paella.utils.userAgent.system.Version.minor>=12&&paella.utils.userAgent.browser.Safari,t=paella.utils.userAgent.system.iOS,a=paella.utils.userAgent.browser.Chrome&&paella.utils.userAgent.browser.Version.major>=64;return!(e||t||a)},goFullScreen:function(){return this._deferredAction(()=>{var e=this.video;e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitEnterFullscreen&&e.webkitEnterFullscreen()})},unFreeze:function(){return this._deferredAction(()=>{var e=document.getElementById(this.video.id+"canvas");e&&$(e).remove()})},freeze:function(){var e=this;return this._deferredAction(function(){var t=document.createElement("canvas");t.id=e.video.id+"canvas",t.className="freezeFrame",t.width=e.video.videoWidth,t.height=e.video.videoHeight,t.style.cssText=e.video.style.cssText,t.style.zIndex=2,t.getContext("2d").drawImage(e.video,0,0,16*Math.ceil(t.width/16),16*Math.ceil(t.height/16)),e.video.parentElement.appendChild(t)})},unload:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()},getDimensions:function(){return paella_DeferredNotImplemented()}}),Class("paella.videoFactories.Html5VideoFactory",{isStreamCompatible:function(e){try{if(paella.videoFactories.Html5VideoFactory.s_instances>0&&base.userAgent.system.iOS&&paella.utils.userAgent.system.Version.major<=10&&paella.utils.userAgent.system.Version.minor<3)return!1;for(var t in e.sources)if("mp4"==t)return!0}catch(e){}return!1},getVideoObject:function(e,t,a){return++paella.videoFactories.Html5VideoFactory.s_instances,new paella.Html5Video(e,t,a.x,a.y,a.w,a.h)}}),paella.videoFactories.Html5VideoFactory.s_instances=0,Class("paella.ImageVideo",paella.VideoElementBase,{_posterFrame:null,_currentQuality:null,_currentTime:0,_duration:0,_ended:!1,_playTimer:null,_playbackRate:1,_frameArray:null,initialize:function(e,t,a,i,n,r){this.parent(e,t,"img",a,i,n,r);var s=this;this._stream.sources.image.sort(function(e,t){return e.res.h-t.res.h}),Object.defineProperty(this,"img",{get:function(){return s.domElement}}),Object.defineProperty(this,"imgStream",{get:function(){return this._stream.sources.image[this._currentQuality]}}),Object.defineProperty(this,"_paused",{get:function(){return null==this._playTimer}})},_deferredAction:function(e){return new Promise(t=>{if(this.ready)t(e());else{t=(()=>{this._ready=!0,t(e())});$(this.video).bind("paella:imagevideoready",t)}})},_getQualityObject:function(e,t){return{index:e,res:t.res,src:t.src,toString:function(){return this.res.w+"x"+this.res.h},shortLabel:function(){return this.res.h+"p"},compare:function(e){return this.res.w*this.res.h-e.res.w*e.res.h}}},_loadCurrentFrame:function(){var e=this;if(this._frameArray){var t=this._frameArray[0];this._frameArray.some(function(a){if(e._currentTime<a.time)return!0;t=a.src}),this.img.src=t}},allowZoom:function(){return!1},getVideoData:function(){let e=this;return new Promise(t=>{this._deferredAction(function(){var a={duration:e._duration,currentTime:e._currentTime,volume:0,paused:e._paused,ended:e._ended,res:{w:e.imgStream.res.w,h:e.imgStream.res.h}};t(a)})})},setPosterFrame:function(e){this._posterFrame=e},setAutoplay:function(e){this._autoplay=e,e&&this.video&&this.video.setAttribute("autoplay",e)},load:function(){var e=this._stream.sources.image;null===this._currentQuality&&this._videoQualityStrategy&&(this._currentQuality=this._videoQualityStrategy.getQualityIndex(e));var t=this._currentQuality<e.length?e[this._currentQuality]:null;if(t){for(var a in this._frameArray=[],t.frames){var i=Math.floor(Number(a.replace("frame_","")));this._frameArray.push({src:t.frames[a],time:i})}return this._frameArray.sort(function(e,t){return e.time-t.time}),this._ready=!0,this._currentTime=0,this._duration=t.duration,this._loadCurrentFrame(),paella.events.trigger("paella:imagevideoready"),this._deferredAction(function(){return t})}return paella_DeferredRejected(new Error("Could not load video: invalid quality stream index"))},supportAutoplay:function(){return!0},getQualities:function(){return new Promise(e=>{setTimeout(()=>{var t=[],a=-1;this._stream.sources[this._streamName].forEach(e=>{a++,t.push(this._getQualityObject(a,e))}),e(t)},10)})},setQuality:function(e){return new Promise(t=>{this._paused;let a=this._stream.sources.image;this._currentQuality=e<a.length?e:0;this._currentTime;this.load().then(function(){this._loadCurrentFrame(),t()})})},getCurrentQuality:function(){return new Promise(e=>{e(this._getQualityObject(this._currentQuality,this._stream.sources.image[this._currentQuality]))})},play:function(){let e=this;return this._deferredAction(()=>{e._playTimer=new base.Timer(function(){e._currentTime+=.25*e._playbackRate,e._loadCurrentFrame()},250),e._playTimer.repeat=!0})},pause:function(){let e=this;return this._deferredAction(()=>{e._playTimer.repeat=!1,e._playTimer=null})},isPaused:function(){return this._deferredAction(()=>this._paused)},duration:function(){return this._deferredAction(()=>this._duration)},setCurrentTime:function(e){return this._deferredAction(()=>{this._currentTime=e,this._loadCurrentFrame()})},currentTime:function(){return this._deferredAction(()=>this._currentTime)},setVolume:function(e){return this._deferredAction(function(){})},volume:function(){return this._deferredAction(function(){return 0})},setPlaybackRate:function(e){return this._deferredAction(()=>{this._playbackRate=e})},playbackRate:function(){return this._deferredAction(()=>this._playbackRate)},goFullScreen:function(){return this._deferredAction(()=>{var e=this.img;e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitEnterFullscreen&&e.webkitEnterFullscreen()})},unFreeze:function(){return this._deferredAction(function(){})},freeze:function(){return this._deferredAction(function(){})},unload:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()},getDimensions:function(){return paella_DeferredNotImplemented()}}),Class("paella.videoFactories.ImageVideoFactory",{isStreamCompatible:function(e){try{for(var t in e.sources)if("image"==t)return!0}catch(e){}return!1},getVideoObject:function(e,t,a){return new paella.ImageVideo(e,t,a.x,a.y,a.w,a.h)}}),Class("paella.BackgroundContainer",paella.DomNode,{initialize:function(e,t){this.parent("img",e,{position:"relative",top:"0px",left:"0px",right:"0px",bottom:"0px",zIndex:GlobalParams.background.zIndex}),this.domElement.setAttribute("src",t),this.domElement.setAttribute("alt",""),this.domElement.setAttribute("width","100%"),this.domElement.setAttribute("height","100%")},setImage:function(e){this.domElement.setAttribute("src",e)}}),Class("paella.VideoOverlay",paella.DomNode,{size:{w:1280,h:720},initialize:function(){this.parent("div","overlayContainer",{position:"absolute",left:"0px",right:"0px",top:"0px",bottom:"0px",overflow:"hidden",zIndex:10}),this.domElement.setAttribute("role","main")},_generateId:function(){return Math.ceil(Date.now()*Math.random())},enableBackgroundMode:function(){this.domElement.className="overlayContainer background"},disableBackgroundMode:function(){this.domElement.className="overlayContainer"},clear:function(){this.domElement.innerHTML=""},getMasterRect:function(){return paella.player.videoContainer.getMasterVideoRect()},getSlaveRect:function(){return paella.player.videoContainer.getSlaveVideoRect()},addText:function(e,t,a){var i=document.createElement("div");return i.innerHTML=e,i.className="videoOverlayText",a&&(i.style.backgroundColor="red"),this.addElement(i,t)},addElement:function(e,t){return this.domElement.appendChild(e),e.style.position="absolute",e.style.left=this.getHSize(t.left)+"%",e.style.top=this.getVSize(t.top)+"%",e.style.width=this.getHSize(t.width)+"%",e.style.height=this.getVSize(t.height)+"%",e},getLayer:function(e,t){return e=e||this._generateId(),$(this.domElement).find("#"+e)[0]||this.addLayer(e,t)},addLayer:function(e,t){t=t||10;var a=document.createElement("div");return a.className="row",a.id=e||this._generateId(),this.addElement(a,{left:0,top:0,width:1280,height:720})},removeLayer:function(e){var t=$(this.domElement).find("#"+e)[0];t&&this.domElement.removeChild(t)},removeElement:function(e){if(e)try{this.domElement.removeChild(e)}catch(e){}},getVSize:function(e){return 100*e/this.size.h},getHSize:function(e){return 100*e/this.size.w}}),function(){paella.VideoWrapper=class extends paella.DomNode{constructor(e,t,a,i,n){var r=new paella.RelativeVideoSize;super("div",e,{top:r.percentVSize(a)+"%",left:r.percentWSize(t)+"%",width:r.percentWSize(i)+"%",height:r.percentVSize(n)+"%",position:"absolute",zIndex:GlobalParams.video.zIndex,overflow:"hidden"}),this._rect={left:t,top:a,width:i,height:n},this.domElement.className="videoWrapper"}setRect(e,t){this._rect=JSON.parse(JSON.stringify(e));var a=new paella.RelativeVideoSize,i={top:a.percentVSize(e.top)+"%",left:a.percentWSize(e.left)+"%",width:a.percentWSize(e.width)+"%",height:a.percentVSize(e.height)+"%",position:"absolute"};if(t){this.disableClassName();var n=this;$(this.domElement).animate(i,400,function(){n.enableClassName(),paella.events.trigger(paella.events.setComposition,{video:n})}),this.enableClassNameAfter(400)}else $(this.domElement).css(i),paella.events.trigger(paella.events.setComposition,{video:this})}getRect(){return this._rect}disableClassName(){this.classNameBackup=this.domElement.className,this.domElement.className=""}enableClassName(){this.domElement.className=this.classNameBackup}enableClassNameAfter(e){setTimeout("$('#"+this.domElement.id+"')[0].className = '"+this.classNameBackup+"'",e)}setVisible(e,t){"true"==e&&t?($(this.domElement).show(),$(this.domElement).animate({opacity:1},300)):"true"!=e||t?"false"==e&&t?$(this.domElement).animate({opacity:0},300):"false"!=e||t||$(this.domElement).hide():$(this.domElement).show()}setLayer(e){this.domElement.style.zIndex=e}}}(),Class("paella.VideoContainerBase",paella.DomNode,{_trimming:{enabled:!1,start:0,end:0},timeupdateEventTimer:null,timeupdateInterval:250,masterVideoData:null,slaveVideoData:null,currentMasterVideoData:null,currentSlaveVideoData:null,_force:!1,_playOnClickEnabled:!0,initialize:function(e){var t=this;this.parent("div",e,{position:"absolute",left:"0px",right:"0px",top:"0px",bottom:"0px",overflow:"hidden"}),$(this.domElement).click(function(e){t.firstClick&&base.userAgent.browser.IsMobileVersion||t.firstClick&&!t._playOnClickEnabled||paella.player.videoContainer.paused().then(function(e){t.firstClick=!0,e?paella.player.play():paella.player.pause()})}),this.domElement.addEventListener("touchstart",function(e){paella.player.controls&&paella.player.controls.restartHideTimer()})},triggerTimeupdate:function(){var e=this,t=0,a=0;this.paused().then(function(a){return t=a,e.duration()}).then(function(t){return a=t,e.currentTime()}).then(function(i){t&&!e._force||(e._force=!1,paella.events.trigger(paella.events.timeupdate,{videoContainer:e,currentTime:i,duration:a}))})},startTimeupdate:function(){var e=this;this.timeupdateEventTimer=new Timer(function(t){e.triggerTimeupdate()},this.timeupdateInterval),this.timeupdateEventTimer.repeat=!0},stopTimeupdate:function(){this.timeupdateEventTimer&&(this.timeupdateEventTimer.repeat=!1),this.timeupdateEventTimer=null},enablePlayOnClick:function(){this._playOnClickEnabled=!0},disablePlayOnClick:function(){this._playOnClickEnabled=!1},isPlayOnClickEnabled:function(){return this._playOnClickEnabled},play:function(){paella.events.trigger(paella.events.play),this.startTimeupdate()},pause:function(){paella.events.trigger(paella.events.pause),this.stopTimeupdate()},seekTo:function(e){var t=this;this.setCurrentPercent(e).then(a=>{t._force=!0,this.triggerTimeupdate(),paella.events.trigger(paella.events.seekToTime,{newPosition:a.time}),paella.events.trigger(paella.events.seekTo,{newPositionPercent:e})})},seekToTime:function(e){this.setCurrentTime(e).then(e=>{this._force=!0,this.triggerTimeupdate();let t=100*e.time/e.duration;paella.events.trigger(paella.events.seekToTime,{newPosition:e.time}),paella.events.trigger(paella.events.seekTo,{newPositionPercent:t})})},setPlaybackRate:function(e){paella.events.trigger(paella.events.setPlaybackRate,{rate:e})},setVolume:function(e){},volume:function(){return 1},trimStart:function(){return new Promise(e=>{e(this._trimming.start)})},trimEnd:function(){return new Promise(e=>{e(this._trimming.end)})},trimEnabled:function(){return new Promise(e=>{e(this._trimming.enabled)})},trimming:function(){return new Promise(e=>{e(this._trimming)})},enableTrimming:function(){this._trimming.enabled=!0;let e=paella.captions.getActiveCaptions();void 0!==e&&paella.plugins.captionsPlugin.buildBodyContent(e._captions,"list"),paella.events.trigger(paella.events.setTrim,{trimEnabled:this._trimming.enabled,trimStart:this._trimming.start,trimEnd:this._trimming.end})},disableTrimming:function(){this._trimming.enabled=!1;let e=paella.captions.getActiveCaptions();void 0!==e&&paella.plugins.captionsPlugin.buildBodyContent(e._captions,"list"),paella.events.trigger(paella.events.setTrim,{trimEnabled:this._trimming.enabled,trimStart:this._trimming.start,trimEnd:this._trimming.end})},setTrimming:function(e,t){return new Promise(a=>{let i=0,n=0;this.currentTime().then(e=>(i=e,this.duration())).then(r=>{if(n=r,this._trimming.start=Math.floor(e),this._trimming.end=Math.floor(t),i<this._trimming.start&&this.setCurrentTime(this._trimming.start),i>this._trimming.end&&this.setCurrentTime(this._trimming.end),this._trimming.enabled){let e=paella.captions.getActiveCaptions();void 0!==e&&paella.plugins.captionsPlugin.buildBodyContent(e._captions,"list")}paella.events.trigger(paella.events.setTrim,{trimEnabled:this._trimming.enabled,trimStart:this._trimming.start,trimEnd:this._trimming.end}),a()})})},setTrimmingStart:function(e){return this.setTrimming(e,this._trimming.end)},setTrimmingEnd:function(e){return this.setTrimming(this._trimming.start,e)},setCurrentPercent:function(e){var t=this,a=0;return new Promise(i=>{this.duration().then(function(e){return a=e,t.trimming()}).then(function(i){var n=0;if(i.enabled){var r=i.start,s=i.end;a=s-r,n=parseFloat(e*a/100)}else n=e*a/100;return t.setCurrentTime(n)}).then(function(e){i(e)})})},setCurrentTime:function(e){base.log.debug("VideoContainerBase.setCurrentTime("+e+")")},currentTime:function(){return base.log.debug("VideoContainerBase.currentTime()"),0},duration:function(){return base.log.debug("VideoContainerBase.duration()"),0},paused:function(){return base.log.debug("VideoContainerBase.paused()"),!0},setupVideo:function(e){base.log.debug("VideoContainerBase.setupVide()")},isReady:function(){return base.log.debug("VideoContainerBase.isReady()"),!0},onresize:function(){this.parent(onresize)}}),Class("paella.ProfileFrameStrategy",{valid:function(){return!0},adaptFrame:function(e,t){return t}}),Class("paella.LimitedSizeProfileFrameStrategy",paella.ProfileFrameStrategy,{adaptFrame:function(e,t){if(e.width<t.width||e.height<t.height){var a=JSON.parse(JSON.stringify(t));a.width=e.width,a.height=e.height;var i={w:t.width-e.width,h:t.height-e.height};return a.top=a.top+i.h/2,a.left=a.left+i.w/2,a}return t}}),function(){function e(e,t){let a=new paella.VideoWrapper(e);return a.addNode(t),this.videoWrappers.push(a),this.container.addNode(a),a}paella.StreamProvider=class{constructor(e){this._masterVideo=null,this._slaveVideos=[],this._videoStreams=[],this._audioStreams=[]}init(e){if(0==e.length)throw Error("Empty video data.");if(this._videoData=e,this._videoData.some(e=>"master"==e.role)||(this._videoData[0].role="master"),this._videoData.forEach((e,t)=>{e.type=e.type||"video","master"==e.role?this._masterVideo=e:"video"==e.type&&this._slaveVideos.push(e),"video"==e.type?this._videoStreams.push(e):"audio"==e.type&&this._audioStreams.push(e)}),0==this._videoStreams.length)throw new Error("No video streams found. Paella Player requires at least one video stream.")}get masterVideo(){return this._masterVideo}get slaveVideos(){return this._slaveVideos}get mainSlaveVideo(){return this._slaveVideos.length>0?this._slaveVideos[0]:null}get audioStreams(){return this._audioStreams}get isLiveStreaming(){return paella.player.isLiveStream()}};paella.VideoContainer=class extends paella.VideoContainerBase{constructor(e){super(e),this.containerId="",this.video1Id="",this.videoSlaveId="",this.backgroundId="",this.container=null,this.profileFrameStrategy=null,this.videoWrappers=[],this._players=[],this._videoPlayers=[],this._audioPlayers=[],this._audioPlayer=null,this._audioLanguage=paella.dictionary.currentLanguage(),this._volume=1,this.videoClasses={master:"video masterVideo",slave:"video slaveVideo"},this.isHidden=!1,this.logos=null,this.overlayContainer=null,this.videoSyncTimeMillis=5e3,this.currentMasterVideoRect={},this.currentSlaveVideoRect={},this._maxSyncDelay=.5,this._isMonostream=!1,this._videoQualityStrategy=null,this._sourceData=null,this._isMasterReady=!1,this._isSlaveReady=!1,this._firstLoad=!1,this._playOnLoad=!1,this._seekToOnLoad=0,this._showPosterFrame=!0,this._currentProfile=null;var t=this;this._sourceData=[],this.containerId=e+"_container",this.video1Id=e+"_master",this.videoSlaveId=e+"_slave_",this.audioId=e+"_audio_",this.backgroundId=e+"_bkg",this.logos=[],this._videoQualityStrategy=this._getQualityStrategyObject(),this.container=new paella.DomNode("div",this.containerId,{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",width:"1024px",height:"567px"}),this.container.domElement.setAttribute("role","main"),this.addNode(this.container),this.overlayContainer=new paella.VideoOverlay(this.domElement),this.container.addNode(this.overlayContainer),this.container.addNode(new paella.BackgroundContainer(this.backgroundId,paella.utils.folders.profiles()+"/resources/default_background_paella.jpg")),Object.defineProperty(this,"sourceData",{get:function(){return this._sourceData}}),new base.Timer(function(e){t.syncVideos()},t.videoSyncTimeMillis).repeat=!0;var a=paella.player.config;try{var i=a.player.profileFrameStrategy,n=new(Class.fromString(i));dynamic_cast("paella.ProfileFrameStrategy",n)&&this.setProfileFrameStrategy(n)}catch(e){}this._streamProvider=new paella.StreamProvider,Object.defineProperty(this,"ready",{get:function(){return this._isMasterReady&&this._isSlaveReady}}),Object.defineProperty(this,"isMonostream",{get:function(){return this._isMonostream}})}_getQualityStrategyObject(){var e=null;return paella.player.config.player.videoQualityStrategy.split(".").forEach(function(t,a,i){e=0==a&&i.length>1?window[t]:e[t]}),new(e=e||paella.VideoQualityStrategy())}getVideoData(){return new Promise(e=>{let t={master:null,slaves:[]},a=[];this.masterVideo()&&a.push(this.masterVideo().getVideoData().then(e=>(t.master=e,Promise.resolve(e)))),this.slaveVideo()&&a.push(this.slaveVideo().getVideoData().then(e=>(t.slaves.push(e),Promise.resolve(e)))),Promise.all(a).then(()=>{e(t)})})}setVideoQualityStrategy(e){this._videoQualityStrategy=e,this.masterVideo()&&this.masterVideo().setVideoQualityStrategy(this._videoQualityStrategy),this.slaveVideo()&&slaveVideo.setVideoQualityStrategy(this._videoQualityStrategy)}setProfileFrameStrategy(e){this.profileFrameStrategy=e}getMasterVideoRect(){return this.currentMasterVideoRect}getSlaveVideoRect(){return this.currentSlaveVideoRect}setHidden(e){this.isHidden=e}hideVideo(){this.setHidden(!0)}publishVideo(){this.setHidden(!1)}syncVideos(){var e=this,t=this.masterVideo(),a=this.slaveVideo(),i=0,n=0;!this._isMonostream&&t&&t.currentTime().then(function(e){return i=e,a?a.currentTime():Promise.resolve(-1)}).then(function(t){if(t>=-1){n=t;var r=Math.abs(i-n);r>e._maxSyncDelay&&(base.log.debug("Sync videos performed, diff="+r),a.setCurrentTime(i))}let s=[];return e._audioPlayers.forEach(e=>{s.push(e.currentTime())}),Promise.all(s)}).then(function(t){t.forEach(function(t,a){let n=e._audioPlayers[a],r=Math.abs(i-t);r>e._maxSyncDelay&&(base.log.debug("Sync audio performed, diff="+r),n.setCurrentTime(t))})})}checkVideoBounds(e,t,a,i){var n=e.start,r=e.end,s=e.enabled;paella.events.bind(paella.events.endVideo,()=>{this.setCurrentTime(0)}),s?t>=Math.floor(r)&&!a?(paella.events.trigger(paella.events.endVideo,{videoContainer:this}),this.pause()):t<n&&this.setCurrentTime(n+1):t>=i&&(paella.events.trigger(paella.events.endVideo,{videoContainer:this}),this.pause())}play(){return new Promise(e=>{this._firstLoad?this._playOnLoad=!0:this._firstLoad=!0;let t=this.masterVideo(),a=this.slaveVideo();t?t.play().then(()=>{a&&a.play(),this._audioPlayers.forEach(e=>{e.play()}),super.play(),e()}):reject(new Error("Invalid master video"))})}pause(){return new Promise((e,t)=>{var a=this.masterVideo(),i=this.slaveVideo();a?a.pause().then(()=>{i&&i.pause(),this._audioPlayers.forEach(e=>{e.pause()}),super.pause(),e()}):t(new Error("invalid master video"))})}next(){0!==this._trimming.end?this.setCurrentTime(this._trimming.end):this.duration(!0).then(function(e){this.setCurrentTime(e)}),super.next()}previous(){this.setCurrentTime(this._trimming.start),super.previous()}setCurrentTime(e){return new Promise(t=>{let a=[];this._trimming.enabled&&((e+=this._trimming.start)<this._trimming.start&&(e=this._trimming.start),e>this._trimming.end&&(e=this._trimming.end)),a.push(this.masterVideo().setCurrentTime(e)),this.slaveVideo()&&a.push(this.slaveVideo().setCurrentTime(e)),this._audioPlayers.forEach(t=>{a.push(t.setCurrentTime(e))}),Promise.all(a).then(()=>this.duration(!1)).then(a=>{t({time:e,duration:a})})})}currentTime(e=!1){if(this._trimming.enabled&&!e){var t=this._trimming.start;return new Promise(e=>{this.masterVideo().currentTime().then(function(a){e(a-t)})})}return this.masterVideo().currentTime()}setPlaybackRate(e){var t=this.masterVideo(),a=this.slaveVideo();t&&t.setPlaybackRate(e),a&&a.setPlaybackRate(e),super.setPlaybackRate(e)}setVolume(e){return new Promise(t=>{"object"==typeof e&&(e=void 0!==e.master?e.master:1),this.mainAudioPlayer().setVolume(e).then(()=>{paella.events.trigger(paella.events.setVolume,{master:e}),this._volume=e,t(e)})})}volume(){return new Promise(e=>{this.mainAudioPlayer().volume().then(t=>{e(t)})})}masterVideo(){return this.videoWrappers.length>0?this.videoWrappers[0].getNode(this.video1Id):null}slaveVideo(){return this.videoWrappers.length>1?this.videoWrappers[1].getNode(this.videoSlaveId+1):null}mainAudioPlayer(){return this._audioPlayer}players(){let e=this;return new Promise(t=>{!function a(){e.masterVideo()?t(e._players):setTimeout(()=>a(),10)}()})}videoPlayers(){let e=this;return new Promise(t=>{!function a(){e.masterVideo()?t(e._videoPlayers):setTimeout(()=>a(),10)}()})}audioPlayers(){let e=this;return new Promise(t=>{!function a(){e.masterVideo()?t(e._audioPlayers):setTimeout(()=>a(),10)}()})}duration(e){var t=this;return this.masterVideo().duration().then(function(a){return t._trimming.enabled&&!e&&(a=t._trimming.end-t._trimming.start),a})}paused(){return this.masterVideo().isPaused()}trimEnabled(){return this._trimming.enabled}trimStart(){return this._trimming.enabled?this._trimming.start:0}trimEnd(){return this._trimming.enabled?this._trimming.end:this.duration()}getQualities(){return new Promise(e=>{this.masterVideo().getQualities().then(function(t){e(t)})})}setQuality(e){var t,a,i=[],n=[],r=this;return new Promise(s=>{this.masterVideo().getQualities().then(e=>(i=e,this.slaveVideo()?this.slaveVideo().getQualities():paella_DeferredResolved())).then(l=>{n=l||[],t=e<i.length?e:i.length-1,a=e<n.length?e:n.length-1,r.masterVideo().setQuality(t).then(()=>r.slaveVideo()?r.slaveVideo().setQuality(a):paella_DeferredResolved()).then(()=>{paella.events.trigger(paella.events.qualityChanged),s()})})})}getCurrentQuality(){return this.masterVideo().getCurrentQuality()}setStartTime(e){this.seekToTime(e)}get audioLanguage(){return this._audioLanguage}getAudioLanguages(){return new Promise(e=>{let t=[];this.players().then(a=>{a.forEach(e=>{e.stream.language&&t.push(e.stream.language)}),e(t)})})}setAudioLanguage(e){return new Promise(t=>{let a=!1;this.players().then(t=>{let i=[];return t.forEach(t=>{a||t.stream.language!=e||(a=!0,this._audioPlayer=t),i.push(t.setVolume(0))}),Promise.all(i)}).then(()=>(a||(this._audioPlayer=this.masterVideo()),this.mainAudioPlayer().setVolume(this._volume))).then(()=>{this._audioLanguage=this.mainAudioPlayer().stream.language,paella.events.trigger(paella.events.audioLanguageChanged),t()})})}setStreamData(t){var a=this;this._sourceData=t;var i=document.createElement("div");i.className="videoLoaderOverlay",this.overlayContainer.addElement(i,{left:0,top:0,width:1280,height:720}),this._streamProvider.init(t);var n=this._streamProvider.slaveVideos.length>0?{x:850,y:140,w:360,h:550}:{x:0,y:0,w:1280,h:720};this._isMonostream=0==this._streamProvider.slaveVideos.length;var r=this._streamProvider.masterVideo,s=this._streamProvider.audioStreams;this._players=[],this._videoPlayers=[],this._audioPlayers=[];var l=this._streamProvider.mainSlaveVideo,o=paella.videoFactory.getVideoObject(this.video1Id,r,n);this._audioPlayer=o,this._players.push(o),this._videoPlayers.push(o);var u=l?paella.videoFactory.getVideoObject(this.videoSlaveId+1,l,{x:10,y:40,w:800,h:600}):null;u&&(u.setVolume(0),this._players.push(u),this._videoPlayers.push(u)),s.forEach((e,t)=>{let a=paella.audioFactory.getAudioObject(this.audioId+t,e);a&&(this._audioPlayers.push(a),this._players.push(a),this.container.addNode(a))}),o.setVideoQualityStrategy(this._videoQualityStrategy),u&&u.setVideoQualityStrategy(this._videoQualityStrategy),e.apply(this,["masterVideoWrapper",o]),this._streamProvider.slaveVideos.length>0&&e.apply(this,["slaveVideoWrapper",u]);var d=this.autoplay();return o.setAutoplay(d),u&&u.setAutoplay(d),o.load().then(()=>this._streamProvider.slaveVideos.length>0?u.load():paella_DeferredResolved(!0)).then(function(){if(a._audioPlayers.length>0){let e=[];return a._audioPlayers.forEach(function(t){e.push(t.load())}),Promise.all(e)}return paella_DeferredResolved(!0)}).then(function(){$(o.video).bind("timeupdate",function(e){var t=a._trimming,i=e.currentTarget.currentTime,n=e.currentTarget.duration;t.enabled&&(i-=t.start,n=t.end-t.start),paella.events.trigger(paella.events.timeupdate,{videoContainer:a,currentTime:i,duration:n}),a.checkVideoBounds(t,e.currentTarget.currentTime,e.currentTarget.paused,n)}),a.overlayContainer.removeElement(i),a._isMasterReady=!0,a._isSlaveReady=!0;var e=paella.player.config,t=e.player.audio&&void 0!=e.player.audio.master?e.player.audio.master:1;return o.setVolume(t),a.setAudioLanguage(a._audioLanguage)}).then(function(){paella.events.trigger(paella.events.videoReady);var e=base.parameters.get("profile"),t=base.cookies.get("lastProfile");return e?a.setProfile(e,!1):t?a.setProfile(t,!1):a.setProfile(paella.Profiles.getDefaultProfile(),!1)})}setAutoplay(e=!0){return!!this.supportAutoplay()&&(this._autoplay=e,this.masterVideo()&&this.masterVideo().setAutoplay(e),this.slaveVideo()&&this.slaveVideo().setAutoplay(e),this._audioPlayers.length>0&&this._audioPlayers.forEach(t=>{t.setAutoplay(e)}),!0)}autoplay(){return this.supportAutoplay()&&("true"==base.parameters.get("autoplay")||this._streamProvider.isLiveStreaming)&&!base.userAgent.browser.IsMobileVersion}supportAutoplay(){let e=!1;return this.masterVideo()&&(e=this.masterVideo().supportAutoplay()),this.slaveVideo()&&e&&(e=e&&this.slaveVideo().supportAutoplay()),this._audioPlayers.length>0&&e&&this._audioPlayers.forEach(t=>{e=e&&t.supportAutoplay()}),e}numberOfStreams(){return this._sourceData.length}getMonostreamMasterProfile(){return this.masterVideo(),{content:"presenter",visible:!0,layer:1,rect:[{aspectRatio:"1/1",left:280,top:0,width:720,height:720},{aspectRatio:"6/5",left:208,top:0,width:864,height:720},{aspectRatio:"5/4",left:190,top:0,width:900,height:720},{aspectRatio:"4/3",left:160,top:0,width:960,height:720},{aspectRatio:"11/8",left:145,top:0,width:990,height:720},{aspectRatio:"1.41/1",left:132,top:0,width:1015,height:720},{aspectRatio:"1.43/1",left:125,top:0,width:1029,height:720},{aspectRatio:"3/2",left:100,top:0,width:1080,height:720},{aspectRatio:"16/10",left:64,top:0,width:1152,height:720},{aspectRatio:"5/3",left:40,top:0,width:1200,height:720},{aspectRatio:"16/9",left:0,top:0,width:1280,height:720},{aspectRatio:"1.85/1",left:0,top:14,width:1280,height:692},{aspectRatio:"2.35/1",left:0,top:87,width:1280,height:544},{aspectRatio:"2.41/1",left:0,top:94,width:1280,height:531},{aspectRatio:"2.76/1",left:0,top:128,width:1280,height:463}]}}getMonostreamSlaveProfile(){return{content:"slides",visible:!1,layer:0,rect:[{aspectRatio:"16/9",left:0,top:0,width:0,height:0},{aspectRatio:"4/3",left:0,top:0,width:0,height:0}]}}getCurrentProfileName(){return this._currentProfile}setProfile(e,t){return new Promise(a=>{t=!base.userAgent.browser.Explorer&&t,this.masterVideo()?paella.Profiles.loadProfile(e,i=>{this._currentProfile=e,0==this._streamProvider.slaveVideos.length&&(i.masterVideo=this.getMonostreamMasterProfile(),i.slaveVideo=this.getMonostreamSlaveProfile()),this.applyProfileWithJson(i,t),a(e)}):a()})}getProfile(e){return new Promise((t,a)=>{paella.Profiles.loadProfile(e,e=>{t(e)})})}hideAllLogos(){for(var e=0;e<this.logos.length;++e){var t=this.logos[e],a=this.container.getNode(t);$(a.domElement).hide()}}showLogos(e){if(void 0!=e)for(var t=new paella.RelativeVideoSize,a=0;a<e.length;++a){var i=e[a],n=i.content,r=this.container.getNode(n),s=i.rect;r?$(r.domElement).show():(l={},(r=this.container.addNode(new paella.DomNode("img",n,l))).domElement.setAttribute("src",paella.utils.folders.profiles()+"/resources/"+n),r.domElement.setAttribute("src",paella.utils.folders.profiles()+"/resources/"+n));var l={top:t.percentVSize(s.top)+"%",left:t.percentWSize(s.left)+"%",width:t.percentWSize(s.width)+"%",height:t.percentVSize(s.height)+"%",position:"absolute",zIndex:i.zIndex};$(r.domElement).css(l)}}getClosestRect(e,t){var a=10,i=/([0-9\.]+)\/([0-9\.]+)/,n=e.rect[0],r=0==t.h?1.777777:t.w/t.h,s=1,l=!1;return e.rect.forEach(function(e){(l=i.exec(e.aspectRatio))&&(s=Number(l[1])/Number(l[2]));var t=Math.abs(s-r);a>t&&(a=t,n=e)}),n}applyProfileWithJson(e,t){var a=function(a,i){void 0==t&&(t=!0);let n=this.videoWrappers[0],r=this.videoWrappers.length>1?this.videoWrappers[1]:null,s=(this.masterVideo(),this.slaveVideo(),this.container.getNode(this.backgroundId)),l=a.res,o=i&&i.res,u=this.getClosestRect(e.masterVideo,a.res),d=i&&this.getClosestRect(e.slaveVideo,i.res);if(this.hideAllLogos(),this.showLogos(e.logos),dynamic_cast("paella.ProfileFrameStrategy",this.profileFrameStrategy)){var c={width:$(this.domElement).width(),height:$(this.domElement).height()},h=u.width/c.width,p={width:l.w*h,height:l.h*h};if(u.left=Number(u.left),u.top=Number(u.top),u.width=Number(u.width),u.height=Number(u.height),u=this.profileFrameStrategy.adaptFrame(p,u),r){var m={width:o.w*h,height:o.h*h};d.left=Number(d.left),d.top=Number(d.top),d.width=Number(d.width),d.height=Number(d.height),d=this.profileFrameStrategy.adaptFrame(m,d)}}n.setRect(u,t),this.currentMasterVideoRect=u,n.setVisible(e.masterVideo.visible,t),this.currentMasterVideoRect.visible=!!/true/i.test(e.masterVideo.visible),this.currentMasterVideoRect.layer=parseInt(e.masterVideo.layer),r&&(r.setRect(d,t),this.currentSlaveVideoRect=d,this.currentSlaveVideoRect.visible=!!/true/i.test(e.slaveVideo.visible),this.currentSlaveVideoRect.layer=parseInt(e.slaveVideo.layer),r.setVisible(e.slaveVideo.visible,t),r.setLayer(e.slaveVideo.layer)),n.setLayer(e.masterVideo.layer),s.setImage(paella.utils.folders.profiles()+"/resources/"+e.background.content)},i=this;if(this.masterVideo())if(this.slaveVideo()){var n={};this.masterVideo().getVideoData().then(function(e){return n=e,i.slaveVideo().getVideoData()}).then(function(e){a.apply(i,[n,e])})}else this.masterVideo().getVideoData().then(function(e){a.apply(i,[e])})}resizePortrail(){var e=1==paella.player.isFullScreen()?$(window).width():$(this.domElement).width(),t=(new paella.RelativeVideoSize).proportionalHeight(e);this.container.domElement.style.width=e+"px",this.container.domElement.style.height=t+"px";var a=(1==paella.player.isFullScreen()?$(window).height():$(this.domElement).height())/2-t/2;this.container.domElement.style.top=a+"px"}resizeLandscape(){var e=1==paella.player.isFullScreen()?$(window).height():$(this.domElement).height(),t=(new paella.RelativeVideoSize).proportionalWidth(e);this.container.domElement.style.width=t+"px",this.container.domElement.style.height=e+"px",this.container.domElement.style.top="0px"}onresize(){super.onresize();var e=(new paella.RelativeVideoSize).aspectRatio();(1==paella.player.isFullScreen()?$(window).width():$(this.domElement).width())/(1==paella.player.isFullScreen()?$(window).height():$(this.domElement).height())>e?this.resizeLandscape():this.resizePortrail()}}}(),function(){Class("paella.PluginManager",{targets:null,pluginList:[],eventDrivenPlugins:[],enabledPlugins:[],doResize:!0,setupPlugin:function(e){e.setup(),this.enabledPlugins.push(e),dynamic_cast("paella.UIPlugin",e)&&e.checkVisibility()},checkPluginsVisibility:function(){this.enabledPlugins.forEach(function(e){dynamic_cast("paella.UIPlugin",e)&&e.checkVisibility()})},initialize:function(){this.targets={};var e=this;paella.events.bind(paella.events.loadPlugins,function(t){e.loadPlugins("paella.DeferredLoadPlugin")}),new base.Timer(function(){paella.player&&paella.player.controls&&e.doResize&&paella.player.controls.onresize()},1e3).repeat=!0},setTarget:function(e,t){t.addPlugin&&(this.targets[e]=t)},getTarget:function(e){return"eventDriven"==e?this:this.targets[e]},registerPlugin:function(e){this.importLibraries(e),this.pluginList.push(e),this.pluginList.sort(function(e,t){return e.getIndex()-t.getIndex()})},importLibraries:function(e){e.getDependencies().forEach(function(e){var t=document.createElement("script");t.type="text/javascript",t.src="javascript/"+e+".js",document.head.appendChild(t)})},loadPlugins:function(e){if(void 0!=e){var t=this;this.foreach(function(a,i){a.isLoaded()||null!=dynamic_cast(e,a)&&i.enabled&&(base.log.debug("Load plugin ("+e+"): "+a.getName()),a.config=i,a.load(t))})}},foreach:function(e){var t=!1,a={};try{t=paella.player.config.plugins.enablePluginsByDefault}catch(e){}try{a=paella.player.config.plugins.list}catch(e){}this.pluginList.forEach(function(i){var n=i.getName(),r=a[n];r||(r={enabled:t}),e(i,r)})},addPlugin:function(e){var t=this;e.__added__||(e.__added__=!0,e.checkEnabled(function(a){if("eventDriven"==e.type&&a){paella.pluginManager.setupPlugin(e),t.eventDrivenPlugins.push(e);for(var i=e.getEvents(),n=function(t,a){e.onEvent(t.type,a)},r=0;r<i.length;++r){var s=i[r];paella.events.bind(s,n)}}}))},getPlugin:function(e){for(var t=0;t<this.pluginList.length;++t)if(this.pluginList[t].getName()==e)return this.pluginList[t];return null},registerPlugins:function(){e.forEach(e=>{let t=new(e());t.getInstanceName()&&(paella.plugins=paella.plugins||{},paella.plugins[t.getInstanceName()]=t),paella.pluginManager.registerPlugin(t)})}}),paella.pluginManager=new paella.PluginManager;let e=[];paella.addPlugin=function(t){e.push(t)},Class("paella.Plugin",{type:"",isLoaded:function(){return this.__loaded__},initialize:function(){},getDependencies:function(){return[]},load:function(e){if(!this.__loaded__){this.__loaded__=!0;var t=e.getTarget(this.type);t&&t.addPlugin&&t.addPlugin(this)}},getInstanceName:function(){return null},getRootNode:function(e){return null},checkEnabled:function(e){e(!0)},setup:function(){},getIndex:function(){return 0},getName:function(){return""}}),Class("paella.FastLoadPlugin",paella.Plugin,{}),Class("paella.EarlyLoadPlugin",paella.Plugin,{}),Class("paella.DeferredLoadPlugin",paella.Plugin,{}),Class("paella.PopUpContainer",paella.DomNode,{containers:null,currentContainerId:-1,initialize:function(e,t){this.parent("div",e,{}),this.domElement.className=t,this.containers={}},hideContainer:function(e,t){var a=this.containers[e];a&&this.currentContainerId==e&&(a.identifier=e,paella.events.trigger(paella.events.hidePopUp,{container:a}),a.plugin.willHideContent(),$(a.element).hide(),a.button.className=a.button.className.replace(" selected",""),$(this.domElement).css({width:"0px"}),this.currentContainerId=-1,a.plugin.didHideContent())},showContainer:function(e,t){var a=this,i=0;function n(e){paella.events.trigger(paella.events.hidePopUp,{container:e}),e.plugin.willHideContent(),$(e.element).hide(),$(a.domElement).css({width:"0px"}),e.button.className=e.button.className.replace(" selected",""),a.currentContainerId=-1,e.plugin.didHideContent()}function r(n){if(paella.events.trigger(paella.events.showPopUp,{container:n}),n.plugin.willShowContent(),n.button.className=n.button.className+" selected",$(n.element).show(),i=$(n.element).width(),"right"==n.plugin.getAlignment()){var r=$(t.parentElement).width()-$(t).position().left-$(t).width();$(a.domElement).css({width:i+"px",right:r+"px",left:""})}else{var s=$(t).position().left;$(a.domElement).css({width:i+"px",left:s+"px",right:""})}a.currentContainerId=e,n.plugin.didShowContent()}var s=this.containers[e];s&&this.currentContainerId!=e&&-1!=this.currentContainerId?(n(this.containers[this.currentContainerId]),r(s)):s&&this.currentContainerId==e?n(s):s&&r(s)},registerContainer:function(e,t,a,i){var n={identifier:e,button:a,element:t,plugin:i};if(this.containers[e]=n,i.closeOnMouseOut&&i.closeOnMouseOut()){let i=e,n=a;$(t).mouseleave(function(e){paella.player.controls.playbackControl().hidePopUp(i,n)})}$(t).hide(),a.popUpIdentifier=e,a.sourcePlugin=i,$(a).click(function(e){this.plugin.isPopUpOpen()?paella.player.controls.playbackControl().hidePopUp(this.popUpIdentifier,this):paella.player.controls.playbackControl().showPopUp(this.popUpIdentifier,this)}),$(a).keyup(function(e){13!=e.keyCode||this.plugin.isPopUpOpen()?27==e.keyCode&&paella.player.controls.playbackControl().hidePopUp(this.popUpIdentifier,this):paella.player.controls.playbackControl().showPopUp(this.popUpIdentifier,this)}),i.containerManager=this}}),Class("paella.TimelineContainer",paella.PopUpContainer,{hideContainer:function(e,t){var a=this.containers[e];a&&this.currentContainerId==e&&(paella.events.trigger(paella.events.hidePopUp,{container:a}),a.plugin.willHideContent(),$(a.element).hide(),a.button.className=a.button.className.replace(" selected",""),this.currentContainerId=-1,$(this.domElement).css({height:"0px"}),a.plugin.didHideContent())},showContainer:function(e,t){var a=0,i=this.containers[e];if(i&&this.currentContainerId!=e&&-1!=this.currentContainerId){var n=this.containers[this.currentContainerId];n.button.className=n.button.className.replace(" selected",""),i.button.className=i.button.className+" selected",paella.events.trigger(paella.events.hidePopUp,{container:n}),n.plugin.willHideContent(),$(n.element).hide(),n.plugin.didHideContent(),paella.events.trigger(paella.events.showPopUp,{container:i}),i.plugin.willShowContent(),$(i.element).show(),this.currentContainerId=e,a=$(i.element).height(),$(this.domElement).css({height:a+"px"}),i.plugin.didShowContent()}else i&&this.currentContainerId==e?(paella.events.trigger(paella.events.hidePopUp,{container:i}),i.plugin.willHideContent(),$(i.element).hide(),i.button.className=i.button.className.replace(" selected",""),$(this.domElement).css({height:"0px"}),this.currentContainerId=-1,i.plugin.didHideContent()):i&&(paella.events.trigger(paella.events.showPopUp,{container:i}),i.plugin.willShowContent(),i.button.className=i.button.className+" selected",$(i.element).show(),this.currentContainerId=e,a=$(i.element).height(),$(this.domElement).css({height:a+"px"}),i.plugin.didShowContent())}}),Class("paella.UIPlugin",paella.DeferredLoadPlugin,{ui:null,checkVisibility:function(){var e=!1;(this.config.visibleOn||[paella.PaellaPlayer.mode.standard,paella.PaellaPlayer.mode.fullscreen,paella.PaellaPlayer.mode.embed]).forEach(function(t){t==paella.player.getPlayerMode()&&(e=!0)}),e?this.showUI():this.hideUI()},hideUI:function(){this.ui.setAttribute("aria-hidden","true"),$(this.ui).hide()},showUI:function(){var e=this;paella.pluginManager.enabledPlugins.forEach(function(t){t==e&&(e.ui.setAttribute("aria-hidden","false"),$(e.ui).show())})}}),Class("paella.ButtonPlugin",paella.UIPlugin,{type:"button",subclass:"",container:null,containerManager:null,getAlignment:function(){return"left"},getSubclass:function(){return"myButtonPlugin"},getIconClass:function(){return""},addSubclass:function(e){$(this.container).addClass(e)},removeSubclass:function(e){$(this.container).removeClass(e)},action:function(e){},getName:function(){return"ButtonPlugin"},getMinWindowSize:function(){return 0},buildContent:function(e){},willShowContent:function(){base.log.debug(this.getName()+" willDisplayContent")},didShowContent:function(){base.log.debug(this.getName()+" didDisplayContent")},willHideContent:function(){base.log.debug(this.getName()+" willHideContent")},didHideContent:function(){base.log.debug(this.getName()+" didHideContent")},getButtonType:function(){return paella.ButtonPlugin.type.actionButton},getText:function(){return""},setText:function(e){this.container.innerHTML='<span class="button-text">'+e+"</span>",this._i&&this.container.appendChild(this._i)},hideButton:function(){this.hideUI()},showButton:function(){this.showUI()},changeSubclass:function(e){this.subclass=e,this.container.className=this.getClassName()},changeIconClass:function(e){this._i.className="button-icon "+e},getClassName:function(){return paella.ButtonPlugin.kClassName+" "+this.getAlignment()+" "+this.subclass},getContainerClassName:function(){return this.getButtonType()==paella.ButtonPlugin.type.timeLineButton?paella.ButtonPlugin.kTimeLineClassName+" "+this.getSubclass():this.getButtonType()==paella.ButtonPlugin.type.popUpButton?paella.ButtonPlugin.kPopUpClassName+" "+this.getSubclass():void 0},setToolTip:function(e){this.button.setAttribute("title",e),this.button.setAttribute("aria-label",e)},getDefaultToolTip:function(){return""},isPopUpOpen:function(){return this.button.popUpIdentifier==this.containerManager.currentContainerId}}),paella.ButtonPlugin.alignment={left:"left",right:"right"},paella.ButtonPlugin.kClassName="buttonPlugin",paella.ButtonPlugin.kPopUpClassName="buttonPluginPopUp",paella.ButtonPlugin.kTimeLineClassName="buttonTimeLine",paella.ButtonPlugin.type={actionButton:1,popUpButton:2,timeLineButton:3},paella.ButtonPlugin.buildPluginButton=function(e,t){e.subclass=e.getSubclass();var a=document.createElement("div");a.className=e.getClassName(),a.id=t,a.innerHTML='<span class="button-text">'+e.getText()+"</span>",a.setAttribute("tabindex",1e3+e.getIndex()),a.setAttribute("alt",""),a.setAttribute("role","button"),a.plugin=e,e.button=a,e.container=a,e.ui=a,e.setToolTip(e.getDefaultToolTip());let i=document.createElement("i");function n(e){paella.userTracking.log("paella:button:action",e.plugin.getName()),e.plugin.action(e)}return i.className="button-icon "+e.getIconClass(),a.appendChild(i),e._i=i,$(a).click(function(e){n(this)}),$(a).keyup(function(e){13==e.keyCode&&n(this)}),a},paella.ButtonPlugin.buildPluginPopUp=function(e,t,a){t.subclass=t.getSubclass();var i=document.createElement("div");return e.appendChild(i),i.className=t.getContainerClassName(),i.id=a,i.plugin=t,t.buildContent(i),i},Class("paella.VideoOverlayButtonPlugin",paella.ButtonPlugin,{type:"videoOverlayButton",getSubclass:function(){return"myVideoOverlayButtonPlugin "+this.getAlignment()},action:function(e){},getName:function(){return"VideoOverlayButtonPlugin"}}),Class("paella.EventDrivenPlugin",paella.EarlyLoadPlugin,{type:"eventDriven",initialize:function(){this.parent();for(var e=this.getEvents(),t=0;t<e.length;++t){e[t]==paella.events.loadStarted&&this.onEvent(paella.events.loadStarted)}},getEvents:function(){return[]},onEvent:function(e,t){},getName:function(){return"EventDrivenPlugin"}})}(),function(){var e=new(Class({_formats:{},addPlugin:function(e){var t=this,a=e.ext;0==(Array.isArray&&Array.isArray(a)||a instanceof Array)&&(a=[a]),0==a.length?base.log.debug("No extension provided by the plugin "+e.getName()):(base.log.debug("New captionParser added: "+e.getName()),a.forEach(function(a){t._formats[a]=e}))},initialize:function(){paella.pluginManager.setTarget("captionParser",this)}})),t=Class(base.AsyncLoaderCallback,{initialize:function(e,t){this.name="captionSearchCallback",this.caption=e,this.text=t},load:function(e,t){var a=this;this.caption.search(this.text,function(i,n){i?t():(a.result=n,e())})}});paella.captions={parsers:{},_captions:{},_activeCaption:void 0,addCaptions:function(e){var t=e._captionsProvider+":"+e._id;this._captions[t]=e,paella.events.trigger(paella.events.captionAdded,t)},getAvailableLangs:function(){var e=[],t=this;return Object.keys(this._captions).forEach(function(a){var i=t._captions[a];e.push({id:a,lang:i._lang})}),e},getCaptions:function(e){if(e&&this._captions[e])return this._captions[e]},getActiveCaptions:function(e){return this._activeCaption},setActiveCaptions:function(e){return this._activeCaption=this.getCaptions(e),void 0!=this._activeCaption?paella.events.trigger(paella.events.captionsEnabled,e):paella.events.trigger(paella.events.captionsDisabled),this._activeCaption},getCaptionAtTime:function(e,t){var a=this.getCaptions(e);if(void 0!=a)return a.getCaptionAtTime(t)},search:function(e,a){var i=this,n=new base.AsyncLoader;this.getAvailableLangs().forEach(function(a){n.addCallback(new t(i.getCaptions(a.id),e))}),n.load(function(){var e=[];Object.keys(n.callbackArray).forEach(function(t){e=e.concat(n.getCallback(t).result)}),a&&a(!1,e)},function(){a&&a(!0)})}},Class("paella.captions.Caption",{initialize:function(e,t,a,i,n){this._id=e,this._format=t,this._url=a,this._captions=void 0,this._index=lunr(function(){this.ref("id"),this.field("content",{boost:10})}),"string"==typeof i&&(i={code:i,txt:i}),this._lang=i,this._captionsProvider="downloadCaptionsProvider",this.reloadCaptions(n)},canEdit:function(e){e(!1,!1)},goToEdit:function(){},reloadCaptions:function(t){var a=this;jQuery.ajax({url:a._url,cache:!1,type:"get",dataType:"text"}).then(function(i){var n=e._formats[a._format];void 0==n?(base.log.debug("Error adding captions: Format not supported!"),paella.player.videoContainer.duration(!0).then(e=>{a._captions=[{id:0,begin:0,end:e,content:base.dictionary.translate("Error! Captions format not supported.")}],t&&t(!0)})):n.parse(i,a._lang.code,function(e,i){e||(a._captions=i,a._captions.forEach(function(e){a._index.add({id:e.id,content:e.content})})),t&&t(e)})}).fail(function(e){base.log.debug("Error loading captions: "+a._url),t&&t(!0)})},getCaptions:function(){return this._captions},getCaptionAtTime:function(e){if(void 0!=this._captions)for(var t=0;t<this._captions.length;++t){var a=this._captions[t];if(a.begin<=e&&a.end>=e)return a}},getCaptionById:function(e){if(void 0!=this._captions)for(var t=0;t<this._captions.length;++t){let a=this._captions[t];if(a.id==e)return a}},search:function(e,t){var a=this;if(void 0==this._index)t&&t(!0,"Error. No captions found.");else{var i=[];paella.player.videoContainer.trimming().then(n=>{this._index.search(e).forEach(function(e){var t=a.getCaptionById(e.ref);n.enabled&&(t.end<n.start||t.begin>n.end)||i.push({time:t.begin,content:t.content,score:e.score})}),t&&t(!1,i)})}}}),Class("paella.CaptionParserPlugIn",paella.FastLoadPlugin,{type:"captionParser",getIndex:function(){return-1},ext:[],parse:function(e,t,a){throw new Error("paella.CaptionParserPlugIn#parse must be overridden by subclass")}})}(),function(){var e=new(Class({_plugins:[],addPlugin:function(e){this._plugins.push(e)},initialize:function(){paella.pluginManager.setTarget("SearchServicePlugIn",this)}})),t=Class(base.AsyncLoaderCallback,{initialize:function(e,t){this.name="searchCallback",this.plugin=e,this.text=t},load:function(e,t){var a=this;this.plugin.search(this.text,function(i,n){i?t():(a.result=n,e())})}});paella.searchService={search:function(a,i){var n=new base.AsyncLoader;paella.userTracking.log("paella:searchService:search",a),e._plugins.forEach(function(e){n.addCallback(new t(e,a))}),n.load(function(){var e=[];Object.keys(n.callbackArray).forEach(function(t){e=e.concat(n.getCallback(t).result)}),i&&i(!1,e)},function(){i&&i(!0)})}},Class("paella.SearchServicePlugIn",paella.FastLoadPlugin,{type:"SearchServicePlugIn",getIndex:function(){return-1},search:function(e,t){throw new Error("paella.SearchServicePlugIn#search must be overridden by subclass")}})}(),function(){var e=new(Class({_plugins:[],addPlugin:function(e){var t=this;e.checkEnabled(function(a){a&&(e.setup(),t._plugins.push(e))})},initialize:function(){paella.pluginManager.setTarget("userTrackingSaverPlugIn",this)}}));paella.userTracking={},Class("paella.userTracking.SaverPlugIn",paella.FastLoadPlugin,{type:"userTrackingSaverPlugIn",getIndex:function(){return-1},checkEnabled:function(e){e(!0)},log:function(e,t){throw new Error("paella.userTracking.SaverPlugIn#log must be overridden by subclass")}});var t={};paella.userTracking.log=function(a,i){void 0!=t[a]&&t[a].cancel(),t[a]=new base.Timer(function(n){e._plugins.forEach(function(e){e.log(a,i)}),delete t[a]},500)},[paella.events.play,paella.events.pause,paella.events.endVideo,paella.events.showEditor,paella.events.hideEditor,paella.events.enterFullscreen,paella.events.exitFullscreen,paella.events.loadComplete].forEach(function(e){paella.events.bind(e,function(t,a){paella.userTracking.log(e)})}),[paella.events.showPopUp,paella.events.hidePopUp].forEach(function(e){paella.events.bind(e,function(t,a){paella.userTracking.log(e,a.identifier)})}),[paella.events.captionsEnabled,paella.events.captionsDisabled].forEach(function(e){paella.events.bind(e,function(t,a){var i;if(void 0!=a){var n=paella.captions.getCaptions(a);i={id:a,lang:n._lang,url:n._url}}paella.userTracking.log(e,i)})}),[paella.events.setProfile].forEach(function(e){paella.events.bind(e,function(t,a){paella.userTracking.log(e,a.profileName)})}),[paella.events.seekTo,paella.events.seekToTime].forEach(function(e){paella.events.bind(e,function(t,a){var i;try{JSON.stringify(a),i=a}catch(e){}paella.userTracking.log(e,i)})}),[paella.events.setVolume,paella.events.resize,paella.events.setPlaybackRate,paella.events.qualityChanged].forEach(function(e){paella.events.bind(e,function(t,a){var i;try{JSON.stringify(a),i=a}catch(e){}paella.userTracking.log(e,i)})})}(),Class("paella.TimeControl",paella.DomNode,{initialize:function(e){this.parent("div",e,{left:"0%"}),this.domElement.className="timeControlOld",this.domElement.className="timeControl";var t=this;paella.events.bind(paella.events.timeupdate,function(e,a){t.onTimeUpdate(a)})},onTimeUpdate:function(e){e.videoContainer,e.currentTime,e.duration;this.domElement.innerHTML=this.secondsToHours(parseInt(e.currentTime))},secondsToHours:function(e){var t=Math.floor(e/3600),a=Math.floor((e-3600*t)/60),i=e-3600*t-60*a;return t<10&&(t="0"+t),a<10&&(a="0"+a),i<10&&(i="0"+i),t+":"+a+":"+i}}),Class("paella.PlaybackBar",paella.DomNode,{playbackFullId:"",updatePlayBar:!0,timeControlId:"",_images:null,_keys:null,_prev:null,_next:null,_videoLength:null,_lastSrc:null,_aspectRatio:1.777777778,_hasSlides:null,_imgNode:null,_canvas:null,initialize:function(e){this.parent("div",e,{}),this.domElement.className="playbackBar",this.domElement.setAttribute("alt",""),this.domElement.setAttribute("aria-label","Timeline Slider"),this.domElement.setAttribute("role","slider"),this.domElement.setAttribute("aria-valuemin","0"),this.domElement.setAttribute("aria-valuemax","100"),this.domElement.setAttribute("aria-valuenow","0"),this.domElement.setAttribute("tabindex","1100"),$(this.domElement).keyup(function(e){var t=0,a=0;paella.player.videoContainer.currentTime().then(function(e){return t=e,paella.player.videoContainer.duration()}).then(function(i){var n;switch(a=i,e.keyCode){case 37:n=100*t/a-5,paella.player.videoContainer.seekTo(n);break;case 39:n=100*t/a+5,paella.player.videoContainer.seekTo(n)}})}),this.playbackFullId=e+"_full",this.timeControlId=e+"_timeControl";var t=new paella.DomNode("div",this.playbackFullId,{width:"0%"});t.domElement.className="playbackBarFull",this.addNode(t),this.addNode(new paella.TimeControl(this.timeControlId));var a=this;paella.events.bind(paella.events.timeupdate,function(e,t){a.onTimeUpdate(t)}),$(this.domElement).bind("mousedown",function(e){paella.utils.mouseManager.down(a,e),e.stopPropagation()}),$(t.domElement).bind("mousedown",function(e){paella.utils.mouseManager.down(a,e),e.stopPropagation()}),base.userAgent.browser.IsMobileVersion||($(this.domElement).bind("mousemove",function(e){a.movePassive(e),paella.utils.mouseManager.move(e)}),$(t.domElement).bind("mousemove",function(e){paella.utils.mouseManager.move(e)}),$(this.domElement).bind("mouseout",function(e){a.mouseOut(e)})),$(this.domElement).bind("mouseup",function(e){paella.utils.mouseManager.up(e)}),$(t.domElement).bind("mouseup",function(e){paella.utils.mouseManager.up(e)}),paella.player.isLiveStream()&&$(this.domElement).hide()},mouseOut:function(e){this._hasSlides?$("#divTimeImageOverlay").remove():$("#divTimeOverlay").remove()},drawTimeMarks:function(){let e={};paella.player.videoContainer.trimming().then(t=>(e=t,this.imageSetup())).then(()=>{let t=this,a=(e.enabled?(e.end,e.start):this._videoLength,$("#playerContainer_controls_playback_playbackBar"));this.clearCanvas(),this._keys&&paella.player.config.player.slidesMarks.enabled&&this._keys.forEach(function(i){let n=parseInt(i)-e.start;if(n>0){var r=n*a.width()/t._videoLength;t.drawTimeMark(r)}})})},drawTimeMark:function(e){var t=this.getCanvasContext();t.fillStyle=paella.player.config.player.slidesMarks.color,t.fillRect(e,0,1,12)},clearCanvas:function(){this._canvas&&this.getCanvasContext().clearRect(0,0,this._canvas.width,this._canvas.height)},getCanvas:function(){if(!this._canvas){var e=$("#playerContainer_controls_playback_playbackBar"),t=document.createElement("canvas");t.className="playerContainer_controls_playback_playbackBar_canvas",t.id="playerContainer_controls_playback_playbackBar_canvas",t.width=e.width();t.height=e.height();e.prepend(t),this._canvas=document.getElementById("playerContainer_controls_playback_playbackBar_canvas")}return this._canvas},getCanvasContext:function(){return this.getCanvas().getContext("2d")},movePassive:function(e){var t=this;paella.player.videoContainer.duration();let a=0;paella.player.videoContainer.duration().then(function(e){return a=e,paella.player.videoContainer.trimming()}).then(function(i){!function(a,i){var n=$(t.domElement),r=n.offset(),s=n.width(),l=e.clientX-r.left,o=100*(l=l<0?0:l)/s*a/100;i.enabled&&(o+=i.start);var u=Math.floor((o-i.start)/3600)%24;u=("00"+u).slice(u.toString().length);var d=Math.floor((o-i.start)/60)%60;d=("00"+d).slice(d.toString().length);var c=Math.floor((o-i.start)%60),h=u+":"+d+":"+(c=("00"+c).slice(c.toString().length));if(t._hasSlides?(0==$("#divTimeImageOverlay").length?t.setupTimeImageOverlay(h,r.top,s):$("#divTimeOverlay")[0].innerHTML=h,t.imageUpdate(o)):0==$("#divTimeOverlay").length?t.setupTimeOnly(h,r.top,s):$("#divTimeOverlay")[0].innerHTML=h,t._hasSlides){var p=$("#divTimeImageOverlay").width(),m=e.clientX-p/2;e.clientX>p/2+r.left&&e.clientX<r.left+s-p/2?$("#divTimeImageOverlay").css("left",m):e.clientX<s/2?$("#divTimeImageOverlay").css("left",r.left):$("#divTimeImageOverlay").css("left",r.left+s-p)}var g=$("#divTimeOverlay").width(),v=e.clientX-g/2;e.clientX>g/2+r.left&&e.clientX<r.left+s-g/2?$("#divTimeOverlay").css("left",v):e.clientX<s/2?$("#divTimeOverlay").css("left",r.left):$("#divTimeOverlay").css("left",r.left+s-g-2),t._hasSlides&&$("#divTimeImageOverlay").css("bottom",$(".playbackControls").height())}(a,i)})},imageSetup:function(){var e=this;return new Promise(t=>{paella.player.videoContainer.duration().then(function(a){e._images={};var i=paella.initDelegate.initParams.videoLoader.frameList;i&&0!==Object.keys(i).length?(e._hasSlides=!0,e._images=i,e._videoLength=a,e._keys=Object.keys(e._images),e._keys=e._keys.sort(function(e,t){return parseInt(e)-parseInt(t)}),e._next=0,e._prev=0,t()):e._hasSlides=!1})})},imageUpdate:function(e){var t=$("#imgOverlay").attr("src");if($(this._imgNode).show(),e>this._next||e<this._prev)(t=this.getPreviewImageSrc(e))?(this._lastSrc=t,$("#imgOverlay").attr("src",t)):this.hideImg();else{if(void 0!=t)return;$("#imgOverlay").attr("src",this._lastSrc)}},hideImg:function(){$(this._imgNode).hide()},getPreviewImageSrc:function(e){var t=Object.keys(this._images);t.push(e),t.sort(function(e,t){return parseInt(e)-parseInt(t)});var a=t.indexOf(e)-1,i=t[a=a>0?a:0],n=t[a+2],r=t[a];return n=void 0==n?t.length-1:parseInt(n),this._next=n,r=void 0==r?0:parseInt(r),this._prev=r,i=parseInt(i),!!this._images[i]&&(this._images[i].url||this._images[i].url)},setupTimeImageOverlay:function(e,t,a){var i=document.createElement("div");i.className="divTimeImageOverlay",i.id="divTimeImageOverlay";var n=Math.round(a/10);if(i.style.width=Math.round(n*this._aspectRatio)+"px",this._hasSlides){var r=document.createElement("img");r.className="imgOverlay",r.id="imgOverlay",this._imgNode=r,i.appendChild(r)}var s=document.createElement("div");s.className="divTimeOverlay",s.style.top=t-20+"px",s.id="divTimeOverlay",s.innerHTML=e,i.appendChild(s),$(this.domElement).parent().append(i)},setupTimeOnly:function(e,t,a){var i=document.createElement("div");i.className="divTimeOverlay",i.style.top=t-20+"px",i.id="divTimeOverlay",i.innerHTML=e,$(this.domElement).parent().append(i)},playbackFull:function(){return this.getNode(this.playbackFullId)},timeControl:function(){return this.getNode(this.timeControlId)},setPlaybackPosition:function(e){this.playbackFull().domElement.style.width=e+"%"},isSeeking:function(){return!this.updatePlayBar},onTimeUpdate:function(e){if(this.updatePlayBar){var t=e.currentTime,a=e.duration;this.setPlaybackPosition(100*t/a)}},down:function(e,t,a){this.updatePlayBar=!1,this.move(e,t,a)},move:function(e,t,a){var i=$(this.domElement).width(),n=t-$(this.domElement).offset().left;n=n<0?0:n>i?100:100*n/i,this.setPlaybackPosition(n)},up:function(e,t,a){var i=$(this.domElement).width(),n=t-$(this.domElement).offset().left;n=n<0?0:n>i?100:100*n/i,paella.player.videoContainer.seekTo(n),this.updatePlayBar=!0},onresize:function(){this.drawTimeMarks()}}),Class("paella.PlaybackControl",paella.DomNode,{playbackBarId:"",pluginsContainer:null,_popUpPluginContainer:null,_timeLinePluginContainer:null,playbackPluginsWidth:0,popupPluginsWidth:0,minPlaybackBarSize:120,playbackBarInstance:null,buttonPlugins:[],addPlugin:function(e){var t=this,a="buttonPlugin"+this.buttonPlugins.length;this.buttonPlugins.push(e);var i=paella.ButtonPlugin.buildPluginButton(e,a);e.button=i,this.pluginsContainer.domElement.appendChild(i),$(i).hide(),e.checkEnabled(function(a){var n;if(a){$(e.button).show(),paella.pluginManager.setupPlugin(e);var r="buttonPlugin"+t.buttonPlugins.length;if(e.getButtonType()==paella.ButtonPlugin.type.popUpButton){n=t.popUpPluginContainer.domElement;var s=paella.ButtonPlugin.buildPluginPopUp(n,e,r+"_container");t.popUpPluginContainer.registerContainer(e.getName(),s,i,e)}else if(e.getButtonType()==paella.ButtonPlugin.type.timeLineButton){n=t.timeLinePluginContainer.domElement;var l=paella.ButtonPlugin.buildPluginPopUp(n,e,r+"_timeline");t.timeLinePluginContainer.registerContainer(e.getName(),l,i,e)}}else t.pluginsContainer.domElement.removeChild(e.button)})},initialize:function(e){this.parent("div",e,{}),this.domElement.className="playbackControls",this.playbackBarId=e+"_playbackBar";this.pluginsContainer=new paella.DomNode("div",e+"_playbackBarPlugins"),this.pluginsContainer.domElement.className="playbackBarPlugins",this.pluginsContainer.domElement.setAttribute("role","toolbar"),this.addNode(this.pluginsContainer),this.addNode(new paella.PlaybackBar(this.playbackBarId)),paella.pluginManager.setTarget("button",this),Object.defineProperty(this,"popUpPluginContainer",{get:function(){return this._popUpPluginContainer||(this._popUpPluginContainer=new paella.PopUpContainer(e+"_popUpPluginContainer","popUpPluginContainer"),this.addNode(this._popUpPluginContainer)),this._popUpPluginContainer}}),Object.defineProperty(this,"timeLinePluginContainer",{get:function(){return this._timeLinePluginContainer||(this._timeLinePluginContainer=new paella.TimelineContainer(e+"_timelinePluginContainer","timelinePluginContainer"),this.addNode(this._timeLinePluginContainer)),this._timeLinePluginContainer}})},showPopUp:function(e,t){this.popUpPluginContainer.showContainer(e,t),this.timeLinePluginContainer.showContainer(e,t)},hidePopUp:function(e,t){this.popUpPluginContainer.hideContainer(e,t),this.timeLinePluginContainer.hideContainer(e,t)},playbackBar:function(){return null==this.playbackBarInstance&&(this.playbackBarInstance=this.getNode(this.playbackBarId)),this.playbackBarInstance},onresize:function(){var e=$(this.domElement).width();base.log.debug("resize playback bar (width="+e+")");for(var t=0;t<this.buttonPlugins.length;++t){var a=this.buttonPlugins[t],i=a.getMinWindowSize();i>0&&e<i?a.hideUI():a.checkVisibility()}this.getNode(this.playbackBarId).onresize()}}),Class("paella.ControlsContainer",paella.DomNode,{playbackControlId:"",editControlId:"",isEnabled:!0,autohideTimer:null,hideControlsTimeMillis:3e3,playbackControlInstance:null,videoOverlayButtons:null,buttonPlugins:[],_hidden:!1,_over:!1,addPlugin:function(e){var t="videoOverlayButtonPlugin"+this.buttonPlugins.length;this.buttonPlugins.push(e);var a=paella.ButtonPlugin.buildPluginButton(e,t);this.videoOverlayButtons.domElement.appendChild(a),e.button=a,$(a).hide(),e.checkEnabled(function(t){t&&($(e.button).show(),paella.pluginManager.setupPlugin(e))})},initialize:function(e){this.parent("div",e),this.viewControlId=e+"_view",this.playbackControlId=e+"_playback",this.editControlId=e+"_editor",this.addNode(new paella.PlaybackControl(this.playbackControlId));var t=this;paella.events.bind(paella.events.showEditor,function(e){t.onShowEditor()}),paella.events.bind(paella.events.hideEditor,function(e){t.onHideEditor()}),paella.events.bind(paella.events.play,function(e){t.onPlayEvent()}),paella.events.bind(paella.events.pause,function(e){t.onPauseEvent()}),$(document).mousemove(function(e){paella.player.controls.restartHideTimer()}),$(this.domElement).bind("mousemove",function(e){t._over=!0}),$(this.domElement).bind("mouseout",function(e){t._over=!1}),paella.events.bind(paella.events.endVideo,function(e){t.onEndVideoEvent()}),paella.events.bind("keydown",function(e){t.onKeyEvent()}),this.videoOverlayButtons=new paella.DomNode("div",e+"_videoOverlayButtonPlugins"),this.videoOverlayButtons.domElement.className="videoOverlayButtonPlugins",this.videoOverlayButtons.domElement.setAttribute("role","toolbar"),this.addNode(this.videoOverlayButtons),paella.pluginManager.setTarget("videoOverlayButton",this)},onShowEditor:function(){var e=this.editControl();e&&$(e.domElement).hide()},onHideEditor:function(){var e=this.editControl();e&&$(e.domElement).show()},enterEditMode:function(){var e=this.playbackControl(),t=this.editControl();e&&t&&$(e.domElement).hide()},exitEditMode:function(){var e=this.playbackControl(),t=this.editControl();e&&t&&$(e.domElement).show()},playbackControl:function(){return null==this.playbackControlInstance&&(this.playbackControlInstance=this.getNode(this.playbackControlId)),this.playbackControlInstance},editControl:function(){return this.getNode(this.editControlId)},disable:function(){this.isEnabled=!1,this.hide()},enable:function(){this.isEnabled=!0,this.show()},isHidden:function(){return this._hidden},hide:function(){var e=this;function t(){e._doHide&&($(e.domElement).css({opacity:0}),$(e.domElement).hide(),e.domElement.setAttribute("aria-hidden","true"),e._hidden=!0,paella.events.trigger(paella.events.controlBarDidHide))}this._doHide=!0,paella.events.trigger(paella.events.controlBarWillHide),e._doHide&&(base.userAgent.browser.IsMobileVersion||base.userAgent.browser.Explorer?t():$(this.domElement).animate({opacity:0},{duration:300,complete:t}))},showPopUp:function(e){this.playbackControl().showPopUp(e)},hidePopUp:function(e){this.playbackControl().hidePopUp(e)},show:function(){this.isEnabled&&($(this.domElement).stop(),this._doHide=!1,this.domElement.style.opacity=1,this.domElement.setAttribute("aria-hidden","false"),this._hidden=!1,$(this.domElement).show(),paella.events.trigger(paella.events.controlBarDidShow))},autohideTimeout:function(){this.playbackControl().playbackBar().isSeeking()||this._over?paella.player.controls.restartHideTimer():paella.player.controls.hideControls()},hideControls:function(){var e=this;paella.player.videoContainer.paused().then(function(t){t?e.show():e.hide()})},showControls:function(){this.show()},onPlayEvent:function(){this.restartHideTimer()},onPauseEvent:function(){this.clearAutohideTimer()},onEndVideoEvent:function(){this.show(),this.clearAutohideTimer()},onKeyEvent:function(){this.restartHideTimer(),paella.player.videoContainer.paused().then(function(e){e||paella.player.controls.restartHideTimer()})},cancelHideBar:function(){this.restartTimerEvent()},restartTimerEvent:function(){var e=this;this.isHidden()&&this.showControls(),this._doHide=!1,paella.player.videoContainer.paused(function(t){t||e.restartHideTimer()})},clearAutohideTimer:function(){null!=this.autohideTimer&&(this.autohideTimer.cancel(),this.autohideTimer=null)},restartHideTimer:function(){this.showControls(),this.clearAutohideTimer();var e=this;this.autohideTimer=new base.Timer(function(t){e.autohideTimeout()},this.hideControlsTimeMillis)},onresize:function(){this.playbackControl().onresize()}}),Class("paella.LoaderContainer",paella.DomNode,{timer:null,loader:null,loaderPosition:0,initialize:function(e){this.parent("div",e,{position:"fixed",backgroundColor:"white",opacity:"0.7",top:"0px",left:"0px",right:"0px",bottom:"0px",zIndex:1e4}),this.loader=this.addNode(new paella.DomNode("div","",{position:"fixed",width:"128px",height:"128px",top:"50%",left:"50%",marginLeft:"-64px",marginTop:"-64px",backgroundImage:"url("+paella.utils.folders.resources()+"/images/loader.png)"}));var t=this;paella.events.bind(paella.events.loadComplete,function(e,a){t.loadComplete(a)}),this.timer=new base.Timer(function(e){t.loaderPosition-=128,t.loader.domElement.style.backgroundPosition=t.loaderPosition+"px"},1e3),this.timer.repeat=!0},loadComplete:function(e){$(this.domElement).hide(),this.timer.repeat=!1}}),Class("paella.KeyManager",{isPlaying:!1,Keys:{Space:32,Left:37,Up:38,Right:39,Down:40,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90},enabled:!0,initialize:function(){var e=this;paella.events.bind(paella.events.loadComplete,function(t,a){e.loadComplete(t,a)}),paella.events.bind(paella.events.play,function(t){e.onPlay()}),paella.events.bind(paella.events.pause,function(t){e.onPause()})},loadComplete:function(e,t){var a=this;paella.events.bind("keyup",function(e){a.keyUp(e)})},onPlay:function(){this.isPlaying=!0},onPause:function(){this.isPlaying=!1},keyUp:function(e){this.enabled&&(e.altKey&&e.ctrlKey?e.which==this.Keys.P?this.togglePlayPause():e.which==this.Keys.S?this.pause():e.which==this.Keys.M?this.mute():e.which==this.Keys.U?this.volumeUp():e.which==this.Keys.D&&this.volumeDown():e.which==this.Keys.Space?this.togglePlayPause():e.which==this.Keys.Up?this.volumeUp():e.which==this.Keys.Down?this.volumeDown():e.which==this.Keys.M&&this.mute())},togglePlayPause:function(){this.isPlaying?paella.player.pause():paella.player.play()},pause:function(){paella.player.pause()},mute:function(){paella.player.videoContainer.volume().then(function(e){var t=0;0==e&&(t=1),paella.player.videoContainer.setVolume({master:t,slave:0})})},volumeUp:function(){paella.player.videoContainer.volume().then(function(e){e=(e+=.1)>1?1:e,paella.player.videoContainer.setVolume({master:e,slave:0})})},volumeDown:function(){paella.player.videoContainer.volume().then(function(e){e=(e-=.1)<0?0:e,paella.player.videoContainer.setVolume({master:e,slave:0})})}}),paella.keyManager=new paella.KeyManager,Class("paella.VideoLoader",{metadata:{title:"",duration:0},streams:[],frameList:[],loadStatus:!1,codecStatus:!1,getMetadata:function(){return this.metadata},getVideoId:function(){return paella.initDelegate.getId()},getVideoUrl:function(){return""},getDataUrl:function(){},loadVideo:function(e){e()}}),Class("paella.AccessControl",{canRead:function(){return paella_DeferredResolved(!0)},canWrite:function(){return paella_DeferredResolved(!1)},userData:function(){return paella_DeferredResolved({username:"anonymous",name:"Anonymous",avatar:paella.utils.folders.resources()+"/images/default_avatar.png",isAnonymous:!0})},getAuthenticationUrl:function(e){var t=this._authParams.authCallbackName&&window[this._authParams.authCallbackName];return!t&&paella.player.config.auth&&(t=paella.player.config.auth.authCallbackName&&window[paella.player.config.auth.authCallbackName]),"function"==typeof t?t(e):""}}),Class("paella.PlayerBase",{config:null,playerId:"",mainContainer:null,videoContainer:null,controls:null,accessControl:null,checkCompatibility:function(){var e="";if(base.parameters.get("ignoreBrowserCheck"))return!0;if(base.userAgent.browser.IsMobileVersion)return!0;if(base.userAgent.browser.Chrome||base.userAgent.browser.Safari||base.userAgent.browser.Firefox||base.userAgent.browser.Opera||base.userAgent.browser.Edge||base.userAgent.browser.Explorer&&base.userAgent.browser.Version.major>=9)return!0;var t=base.dictionary.translate("It seems that your browser is not HTML 5 compatible");return paella.events.trigger(paella.events.error,{error:t}),e=t+'<div style="display:block;width:470px;height:140px;margin-left:auto;margin-right:auto;font-family:Verdana,sans-sherif;font-size:12px;"><a href="http://www.google.es/chrome" style="color:#004488;float:left;margin-right:20px;"><img src="'+paella.utils.folders.resources()+'images/chrome.png" style="width:80px;height:80px" alt="Google Chrome"></img><p>Google Chrome</p></a><a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home" style="color:#004488;float:left;margin-right:20px;"><img src="'+paella.utils.folders.resources()+'images/explorer.png" style="width:80px;height:80px" alt="Internet Explorer 9"></img><p>Internet Explorer 9</p></a><a href="http://www.apple.com/safari/" style="float:left;margin-right:20px;color:#004488"><img src="'+paella.utils.folders.resources()+'images/safari.png" style="width:80px;height:80px" alt="Safari"></img><p>Safari 5</p></a><a href="http://www.mozilla.org/firefox/" style="float:left;color:#004488"><img src="'+paella.utils.folders.resources()+'images/firefox.png" style="width:80px;height:80px" alt="Firefox"></img><p>Firefox 12</p></a></div>',e+='<div style="margin-top:30px;"><a id="ignoreBrowserCheckLink" href="#" onclick="window.location = window.location + \'&ignoreBrowserCheck=true\'">'+base.dictionary.translate("Continue anyway")+"</a></div>",paella.messageBox.showError(e,{height:"40%"}),!1},initialize:function(e){if(Object.defineProperty(this,"repoUrl",{get:function(){return paella.player.videoLoader._url||""}}),Object.defineProperty(this,"videoUrl",{get:function(){return paella.player.videoLoader.getVideoUrl()}}),Object.defineProperty(this,"dataUrl",{get:function(){return paella.player.videoLoader.getDataUrl()}}),Object.defineProperty(this,"videoId",{get:function(){return paella.initDelegate.getId()}}),void 0!=base.parameters.get("log")){var t=0;switch(base.parameters.get("log")){case"error":t=base.Log.kLevelError;break;case"warn":t=base.Log.kLevelWarning;break;case"debug":t=base.Log.kLevelDebug;break;case"log":case"true":t=base.Log.kLevelLog}base.log.setLevel(t)}if(this.checkCompatibility()){paella.player=this,this.playerId=e,this.mainContainer=$("#"+this.playerId)[0];var a=this;paella.events.bind(paella.events.loadComplete,function(e,t){a.loadComplete(e,t)})}else base.log.debug("It seems that your browser is not HTML 5 compatible")},loadComplete:function(e,t){},auth:{login:function(e){e=e||window.location.href;var t=paella.initDelegate.initParams.accessControl.getAuthenticationUrl(e);t&&(window.location.href=t)},canRead:function(){return paella.initDelegate.initParams.accessControl.canRead()},canWrite:function(){return paella.initDelegate.initParams.accessControl.canWrite()},userData:function(){return paella.initDelegate.initParams.accessControl.userData()}}}),Class("paella.InitDelegate",{initParams:{configUrl:paella.baseUrl+"config/config.json",dictionaryUrl:paella.baseUrl+"localization/paella",accessControl:null,videoLoader:null},initialize:function(e){if(2==arguments.length&&(this._config=arguments[0]),e)for(var t in e)this.initParams[t]=e[t]},getId:function(){return base.parameters.get("id")||"noid"},loadDictionary:function(){return new Promise(e=>{base.ajax.get({url:this.initParams.dictionaryUrl+"_"+base.dictionary.currentLanguage()+".json"},function(t,a,i){base.dictionary.addDictionary(t),e(t)},function(t,a,i){e()})})},loadConfig:function(){let e=e=>{var t=Class.fromString(e.player.accessControlClass||"paella.AccessControl");this.initParams.accessControl=new t};return this.initParams.config?new Promise(t=>{e(this.initParams.config),t(this.initParams.config)}):this.initParams.loadConfig?new Promise((t,a)=>{this.initParams.loadConfig(this.initParams.configUrl).then(a=>{e(a),t(a)}).catch(e=>{a(e)})}):new Promise((t,a)=>{var i=this.initParams.configUrl,n={};n.url=i,base.ajax.get(n,(a,i,n)=>{try{a=JSON.parse(a)}catch(e){}e(a),t(a)},function(e,t,a){paella.messageBox.showError(base.dictionary.translate("Error! Config file not found. Please configure paella!"))})})}});var paellaPlayer=null;paella.plugins={},paella.plugins.events={},paella.initDelegate=null,Class("paella.PaellaPlayer",paella.PlayerBase,{player:null,videoIdentifier:"",loader:null,videoData:null,getPlayerMode:function(){return paella.player.isFullScreen()?paella.PaellaPlayer.mode.fullscreen:window.self!==window.top?paella.PaellaPlayer.mode.embed:paella.PaellaPlayer.mode.standard},checkFullScreenCapability:function(){var e=document.getElementById(paella.player.mainContainer.id);return!!(e.webkitRequestFullScreen||e.mozRequestFullScreen||e.msRequestFullscreen||e.requestFullScreen)||!(!base.userAgent.browser.IsMobileVersion||!paella.player.videoContainer.isMonostream)},addFullScreenListeners:function(){var e=this,t=function(){setTimeout(function(){paella.pluginManager.checkPluginsVisibility()},1e3);var t=document.getElementById(paella.player.mainContainer.id);paella.player.isFullScreen()?(t.style.width="100%",t.style.height="100%"):(t.style.width="",t.style.height=""),e.isFullScreen()?paella.events.trigger(paella.events.enterFullscreen):paella.events.trigger(paella.events.exitFullscreen)};this.eventFullScreenListenerAdded||(this.eventFullScreenListenerAdded=!0,document.addEventListener("fullscreenchange",t,!1),document.addEventListener("webkitfullscreenchange",t,!1),document.addEventListener("mozfullscreenchange",t,!1),document.addEventListener("MSFullscreenChange",t,!1),document.addEventListener("webkitendfullscreen",t,!1))},isFullScreen:function(){var e=!0===document.webkitIsFullScreen,t=void 0!==document.msFullscreenElement&&null!==document.msFullscreenElement,a=!0===document.mozFullScreen,i=void 0!==document.fullScreenElement&&null!==document.fullScreenElement;return e||t||a||i},goFullScreen:function(){if(!this.isFullScreen())if(base.userAgent.system.iOS)paella.player.videoContainer.masterVideo().goFullScreen();else{var e=document.getElementById(paella.player.mainContainer.id);e.webkitRequestFullScreen?e.webkitRequestFullScreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():e.requestFullScreen&&e.requestFullScreen()}},exitFullScreen:function(){this.isFullScreen()&&(document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen()?document.msExitFullscreen():document.cancelFullScreen&&document.cancelFullScreen())},setProfile:function(e,t){this.videoContainer.setProfile(e,t).then(e=>paella.player.getProfile(e)).then(t=>{paella.player.videoContainer.isMonostream||base.cookies.set("lastProfile",e),paella.events.trigger(paella.events.setProfile,{profileName:e})})},getProfile:function(e){return this.videoContainer.getProfile(e)},initialize:function(e){if(this.parent(e),this.playerId==e){this.loadPaellaPlayer()}Object.defineProperty(this,"selectedProfile",{get:function(){return this.videoContainer.getCurrentProfileName()}})},loadPaellaPlayer:function(){var e=this;this.loader=new paella.LoaderContainer("paellaPlayer_loader"),$("body")[0].appendChild(this.loader.domElement),paella.events.trigger(paella.events.loadStarted),paella.initDelegate.loadDictionary().then(function(){return paella.initDelegate.loadConfig()}).then(function(t){if(e.accessControl=paella.initDelegate.initParams.accessControl,e.videoLoader=paella.initDelegate.initParams.videoLoader,e.onLoadConfig(t),t.skin){var a=t.skin.default||"dark";paella.utils.skin.restore(a)}})},onLoadConfig:function(e){if(paella.data=new paella.Data(e),paella.pluginManager.registerPlugins(),this.config=e,this.videoIdentifier=paella.initDelegate.getId(),this.videoIdentifier){if(this.mainContainer){this.videoContainer=new paella.VideoContainer(this.playerId+"_videoContainer");var t=new paella.BestFitVideoQualityStrategy;try{var a=this.config.player.videoQualityStrategy;t=new(Class.fromString(a))}catch(e){base.log.warning("Error selecting video quality strategy: strategy not found")}this.videoContainer.setVideoQualityStrategy(t),this.mainContainer.appendChild(this.videoContainer.domElement)}$(window).resize(function(e){paella.player.onresize()}),this.onload()}paella.pluginManager.loadPlugins("paella.FastLoadPlugin")},onload:function(){var e=this,t=(this.accessControl,!1),a={};this.accessControl.canRead().then(function(a){return t=a,e.accessControl.userData()}).then(function(i){if(a=i,t)e.loadVideo(),e.videoContainer.publishVideo();else if(a.isAnonymous){var n=paella.initDelegate.initParams.accessControl.getAuthenticationUrl("player/?id="+paella.player.videoIdentifier),r="<div>"+base.dictionary.translate("You are not authorized to view this resource")+"</div>";n&&(r+='<div class="login-link"><a href="'+n+'">'+base.dictionary.translate("Login")+"</a></div>"),e.unloadAll(r)}else{let t=base.dictionary.translate("You are not authorized to view this resource");e.unloadAll(t),paella.events.trigger(paella.events.error,{error:t})}}).catch(t=>{let a=base.dictionary.translate(t);e.unloadAll(a),paella.events.trigger(paella.events.error,{error:a})})},onresize:function(){this.videoContainer.onresize(),this.controls&&this.controls.onresize();var e=paella.utils.cookies.get("lastProfile");e?this.setProfile(e,!1):this.setProfile(paella.Profiles.getDefaultProfile(),!1),paella.events.trigger(paella.events.resize,{width:$(this.videoContainer.domElement).width(),height:$(this.videoContainer.domElement).height()})},unloadAll:function(e){$("#paellaPlayer_loader")[0];this.mainContainer.innerHTML="",paella.messageBox.showError(e)},reloadVideos:function(e,t){this.videoContainer&&(this.videoContainer.reloadVideos(e,t),this.onresize())},loadVideo:function(){if(this.videoIdentifier){var e=this,t=paella.player.videoLoader;this.onresize(),t.loadVideo(()=>{e.videoContainer.setStreamData(t.streams).then(function(){paella.events.trigger(paella.events.loadComplete),e.addFullScreenListeners(),e.onresize(),e.videoContainer.autoplay()&&e.play()}).catch(e=>{console.log(e)})})}},showPlaybackBar:function(){this.controls||(this.controls=new paella.ControlsContainer(this.playerId+"_controls"),this.mainContainer.appendChild(this.controls.domElement),this.controls.onresize(),paella.events.trigger(paella.events.loadPlugins,{pluginManager:paella.pluginManager}))},isLiveStream:function(){if(void 0===this._isLiveStream){var e=paella.initDelegate.initParams.videoLoader,t=function(e,t){if(e.length>t){var a=e[t];for(var i in a.sources)if("object"==typeof a.sources[i])for(var n=0;n<a.sources[i].length;++n){if(a.sources[i][n].isLiveStream)return!0}}return!1};this._isLiveStream=t(e.streams,0)||t(e.streams,1)}return this._isLiveStream},loadPreviews:function(){var e=paella.initDelegate.initParams.videoLoader.streams,t=null,a=e[0].preview;if(e.length>=2&&(t=e[1].preview),a){var i=paella.player.videoContainer.overlayContainer.getMasterRect();this.masterPreviewElem=document.createElement("img"),this.masterPreviewElem.src=a,paella.player.videoContainer.overlayContainer.addElement(this.masterPreviewElem,i)}if(t){var n=paella.player.videoContainer.overlayContainer.getSlaveRect();this.slavePreviewElem=document.createElement("img"),this.slavePreviewElem.src=t,paella.player.videoContainer.overlayContainer.addElement(this.slavePreviewElem,n)}paella.events.bind(paella.events.timeUpdate,function(e){paella.player.unloadPreviews()})},unloadPreviews:function(){this.masterPreviewElem&&(paella.player.videoContainer.overlayContainer.removeElement(this.masterPreviewElem),this.masterPreviewElem=null),this.slavePreviewElem&&(paella.player.videoContainer.overlayContainer.removeElement(this.slavePreviewElem),this.slavePreviewElem=null)},loadComplete:function(e,t){paella.pluginManager.loadPlugins("paella.EarlyLoadPlugin"),paella.player.videoContainer._autoplay&&this.play()},play:function(){if(!this.controls){this.showPlaybackBar();var e=base.parameters.get("time"),t=base.hashParams.get("time"),a=t||(e||"0s"),i=paella.utils.timeParse.timeToSeconds(a);i&&paella.player.videoContainer.setStartTime(i),paella.events.trigger(paella.events.controlBarLoaded),this.controls.onresize()}return this.videoContainer.play()},pause:function(){return this.videoContainer.pause()},playing:function(){return new Promise(e=>{this.paused().then(t=>{e(!t)})})},paused:function(){return this.videoContainer.paused()}});var PaellaPlayer=paella.PaellaPlayer;function initPaellaEngage(e,t){t||(t=new paella.InitDelegate),paella.initDelegate=t;navigator.language||window.navigator.userLanguage;paellaPlayer=new PaellaPlayer(e,paella.initDelegate)}function DeprecatedClass(e,t,a){Class(e,a,{initialize:function(){base.log.warning(e+" is deprecated, use "+t+" instead."),this.parent.apply(this,arguments)}})}function DeprecatedFunc(e,t,a){return function(){base.log.warning(e+" is deprecated, use "+t+" instead."),a.apply(this,arguments)}}function buildChromaVideoCanvas(e,t){let a=new class extends bg.app.WindowController{constructor(e){super(),this.stream=e,this._chroma=bg.Color.White(),this._crop=new bg.Vector4(.3,.01,.3,.01),this._transform=bg.Matrix4.Identity().translate(.6,-.04,0),this._bias=.01}get chroma(){return this._chroma}get bias(){return this._bias}get crop(){return this._crop}get transform(){return this._transform}set chroma(e){this._chroma=e}set bias(e){this._bias=e}set crop(e){this._crop=e}set transform(e){this._transform=e}get video(){return this.texture?this.texture.video:null}loaded(){return new Promise(e=>{let t=()=>{this.video?e(this):setTimeout(t,100)};t()})}buildShape(){this.plist=new bg.base.PolyList(this.gl),this.plist.vertex=[-1,-1,0,1,-1,0,1,1,0,-1,1,0],this.plist.texCoord0=[0,0,1,0,1,1,0,1],this.plist.index=[0,1,2,2,3,0],this.plist.build()}buildShader(){this.shader=new bg.base.Shader(this.gl),this.shader.addShaderSource(bg.base.ShaderType.VERTEX,"\n\t\t\t\t\tattribute vec4 position;\n\t\t\t\t\tattribute vec2 texCoord;\n\t\t\t\t\tuniform mat4 inTransform;\n\t\t\t\t\tvarying vec2 vTexCoord;\n\t\t\t\t\tvoid main() {\n\t\t\t\t\t\tgl_Position = inTransform * position;\n\t\t\t\t\t\tvTexCoord = texCoord;\n\t\t\t\t\t}\n\t\t\t\t"),this.shader.addShaderSource(bg.base.ShaderType.FRAGMENT,"\n\t\t\t\t\tprecision mediump float;\n\t\t\t\t\tvarying vec2 vTexCoord;\n\t\t\t\t\tuniform sampler2D inTexture;\n\t\t\t\t\tuniform vec4 inChroma;\n\t\t\t\t\tuniform float inBias;\n\t\t\t\t\tuniform vec4 inCrop;\n\t\t\t\t\tvoid main() {\n\t\t\t\t\t\tvec4 result = texture2D(inTexture,vTexCoord);\n\t\t\t\t\t\t\n\t\t\t\t\t\tif ((result.r>=inChroma.r-inBias && result.r<=inChroma.r+inBias &&\n\t\t\t\t\t\t\tresult.g>=inChroma.g-inBias && result.g<=inChroma.g+inBias &&\n\t\t\t\t\t\t\tresult.b>=inChroma.b-inBias && result.b<=inChroma.b+inBias) ||\n\t\t\t\t\t\t\t(vTexCoord.x<inCrop.x || vTexCoord.x>inCrop.z || vTexCoord.y<inCrop.w || vTexCoord.y>inCrop.y)\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdiscard;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tgl_FragColor = result;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t"),status=this.shader.link(),this.shader.status||(console.log(this.shader.compileError),console.log(this.shader.linkError)),this.shader.initVars(["position","texCoord"],["inTransform","inTexture","inChroma","inBias","inCrop"])}init(){bg.Engine.Set(new bg.webgl1.Engine(this.gl)),bg.base.Loader.RegisterPlugin(new bg.base.VideoTextureLoaderPlugin),this.buildShape(),this.buildShader(),this.pipeline=new bg.base.Pipeline(this.gl),bg.base.Pipeline.SetCurrent(this.pipeline),this.pipeline.clearColor=bg.Color.Transparent(),bg.base.Loader.Load(this.gl,this.stream.src).then(e=>{this.texture=e})}frame(e){this.texture&&this.texture.update()}display(){this.pipeline.clearBuffers(bg.base.ClearBuffers.COLOR|bg.base.ClearBuffers.DEPTH),this.texture&&(this.shader.setActive(),this.shader.setInputBuffer("position",this.plist.vertexBuffer,3),this.shader.setInputBuffer("texCoord",this.plist.texCoord0Buffer,2),this.shader.setMatrix4("inTransform",this.transform),this.shader.setTexture("inTexture",this.texture||bg.base.TextureCache.WhiteTexture(this.gl),bg.base.TextureUnit.TEXTURE_0),this.shader.setVector4("inChroma",this.chroma),this.shader.setValueFloat("inBias",this.bias),this.shader.setVector4("inCrop",new bg.Vector4(this.crop.x,1-this.crop.y,1-this.crop.z,this.crop.w)),this.plist.draw(),this.shader.disableInputBuffer("position"),this.shader.disableInputBuffer("texCoord"),this.shader.clearActive())}reshape(e,t){let a=this.canvas.domElement;a.width=e,a.height=t,this.pipeline.viewport=new bg.Viewport(0,0,e,t)}mouseMove(e){this.postRedisplay()}}(e),i=bg.app.MainLoop.singleton;return i.updateMode=bg.app.FrameUpdate.AUTO,i.canvas=t,i.run(a),a.loaded()}paella.PaellaPlayer.mode={standard:"standard",fullscreen:"fullscreen",embed:"embed"},Class("paella.DefaultVideoLoader",paella.VideoLoader,{_url:null,initialize:function(e){if("object"==typeof e)this._data=e;else try{this._data=JSON.parse(e)}catch(t){this._url=e}},getVideoUrl:function(){return paella.initDelegate.initParams.videoUrl?"function"==typeof paella.initDelegate.initParams.videoUrl?paella.initDelegate.initParams.videoUrl():paella.initDelegate.initParams.videoUrl:(/\/$/.test(this._url)?this._url:this._url+"/")+paella.initDelegate.getId()+"/"},getDataUrl:function(){return paella.initDelegate.initParams.dataUrl?"function"==typeof paella.initDelegate.initParams.dataUrl?paella.initDelegate.initParams.dataUrl():paella.initDelegate.initParams.dataUrl:this.getVideoUrl()+"data.json"},loadVideo:function(e){let t=paella.initDelegate.initParams.loadVideo;if(this._data)this.loadVideoData(this._data,e);else if(t)t().then(t=>{this._data=t,this.loadVideoData(this._data,e)});else if(this._url){var a=this;base.ajax.get({url:this.getDataUrl()},function(t,i,n){if("string"==typeof t)try{t=JSON.parse(t)}catch(e){}a._data=t,a.loadVideoData(a._data,e)},function(e,t,a){switch(a){case 401:paella.messageBox.showError(base.dictionary.translate("You are not logged in"));break;case 403:paella.messageBox.showError(base.dictionary.translate("You are not authorized to view this resource"));break;case 404:paella.messageBox.showError(base.dictionary.translate("The specified video identifier does not exist"));break;default:paella.messageBox.showError(base.dictionary.translate("Could not load the video"))}})}},loadVideoData:function(e,t){var a=this;e.metadata&&(this.metadata=e.metadata),e.streams&&e.streams.forEach(function(e){a.loadStream(e)}),e.frameList&&this.loadFrameData(e),e.captions&&this.loadCaptions(e.captions),e.blackboard&&this.loadBlackboard(e.streams[0],e.blackboard),this.streams=e.streams,this.frameList=e.frameList,this.loadStatus=this.streams.length>0,t()},loadFrameData:function(e){var t=this;if(e.frameList&&e.frameList.forEach){var a={};e.frameList.forEach(function(e){/^[a-zA-Z]+:\/\//.test(e.url)||/^data:/.test(e.url)||(e.url=t.getVideoUrl()+e.url),!e.thumb||/^[a-zA-Z]+:\/\//.test(e.thumb)||/^data:/.test(e.thumb)||(e.thumb=t.getVideoUrl()+e.thumb);var i=e.time;a[i]=e}),e.frameList=a}},loadStream:function(e){var t=this;for(var a in!e.preview||/^[a-zA-Z]+:\/\//.test(e.preview)||/^data:/.test(e.preview)||(e.preview=t.getVideoUrl()+e.preview),e.sources.image&&e.sources.image.forEach(function(e){if(e.frames.forEach){var a={};e.frames.forEach(function(e){!e.src||/^[a-zA-Z]+:\/\//.test(e.src)||/^data:/.test(e.src)||(e.src=t.getVideoUrl()+e.src),!e.thumb||/^[a-zA-Z]+:\/\//.test(e.thumb)||/^data:/.test(e.thumb)||(e.thumb=t.getVideoUrl()+e.thumb);var i="frame_"+e.time;a[i]=e.src}),e.frames=a}}),e.sources){if(e.sources[a]){if("image"!=a)e.sources[a].forEach(function(e){"string"==typeof e.src&&null==e.src.match(/^[a-zA-Z\:]+\:\/\//gi)&&(e.src=t.getVideoUrl()+e.src),e.type=e.mimetype})}else delete e.sources[a]}},loadCaptions:function(e){if(e)for(var t=0;t<e.length;++t){var a=e[t].url;/^[a-zA-Z]+:\/\//.test(a)||(a=this.getVideoUrl()+a);var i=new paella.captions.Caption(t,e[t].format,a,{code:e[t].lang,txt:e[t].text});paella.captions.addCaptions(i)}},loadBlackboard:function(e,t){var a=this;e.sources.image||(e.sources.image=[]);var i={count:t.frames.length,duration:t.duration,mimetype:t.mimetype,res:t.res,frames:{}};t.frames.forEach(function(e){var t="frame_"+Math.round(e.time);/^[a-zA-Z]+:\/\//.test(e.src)||(e.src=a.getVideoUrl()+e.src),i.frames[t]=e.src}),e.sources.image.push(i)}}),Class("paella.DefaultInitDelegate",paella.InitDelegate,{}),paella.load=function(e,t){t&&t.auth;let a=null;if(a=paella.utils.parameters.get("video")){let e=paella.utils.parameters.get("videoSlave");e=e&&decodeURIComponent(e);let i=paella.utils.parameters.get("preview");i=i&&decodeURIComponent(i);let n=paella.utils.parameters.get("previewSlave");n=n&&decodeURIComponent(n);let r={metadata:{title:paella.utils.parameters.get("preview")||"Untitled Video"},streams:[{sources:{mp4:[{src:decodeURIComponent(a),mimetype:"video/mp4",res:{w:0,h:0}}]},preview:i}]};e&&r.streams.push({sources:{mp4:[{src:e,mimetype:"video/mp4",res:{w:0,h:0}}]},preview:n}),t.data=r}var i=t;i.videoLoader=new paella.DefaultVideoLoader(t.data||t.url),paella.initDelegate=new paella.DefaultInitDelegate(i),new PaellaPlayer(e,paella.initDelegate)},Class("paella.RightBarPlugin",paella.DeferredLoadPlugin,{type:"rightBarPlugin",getName:function(){return"es.upv.paella.RightBarPlugin"},buildContent:function(e){}}),Class("paella.TabBarPlugin",paella.DeferredLoadPlugin,{type:"tabBarPlugin",getName:function(){return"es.upv.paella.TabBarPlugin"},getTabName:function(){return"New Tab"},action:function(e){},buildContent:function(e){},setToolTip:function(e){this.button.setAttribute("title",e),this.button.setAttribute("aria-label",e)},getDefaultToolTip:function(){return""}}),Class("paella.ExtendedAdapter",{rightContainer:null,bottomContainer:null,rightBarPlugins:[],tabBarPlugins:[],currentTabIndex:0,bottomContainerTabs:null,bottomContainerContent:null,initialize:function(){this.rightContainer=document.createElement("div"),this.rightContainer.className="rightPluginContainer",this.bottomContainer=document.createElement("div"),this.bottomContainer.className="tabsPluginContainer";var e=document.createElement("div");e.className="tabsLabelContainer",this.bottomContainerTabs=e,this.bottomContainer.appendChild(e);var t=document.createElement("div");t.className="tabsContentContainer",this.bottomContainerContent=t,this.bottomContainer.appendChild(t),this.initPlugins()},initPlugins:function(){paella.pluginManager.setTarget("rightBarPlugin",this),paella.pluginManager.setTarget("tabBarPlugin",this)},addPlugin:function(e){var t=this;e.checkEnabled(function(a){a&&(paella.pluginManager.setupPlugin(e),"rightBarPlugin"==e.type&&(t.rightBarPlugins.push(e),t.addRightBarPlugin(e)),"tabBarPlugin"==e.type&&(t.tabBarPlugins.push(e),t.addTabPlugin(e)))})},showTab:function(e){var t=0,a=this.bottomContainer.getElementsByClassName("tabLabel"),i=this.bottomContainer.getElementsByClassName("tabContent");for(t=0;t<a.length;++t)a[t].getAttribute("tab")==e?a[t].className="tabLabel enabled":a[t].className="tabLabel disabled";for(t=0;t<i.length;++t)i[t].getAttribute("tab")==e?i[t].className="tabContent enabled":i[t].className="tabContent disabled"},addTabPlugin:function(e){var t=this,a=this.currentTabIndex,i=document.createElement("div");i.setAttribute("tab",a),i.className="tabLabel disabled",i.innerHTML=e.getTabName(),i.plugin=e,$(i).click(function(e){/disabled/.test(this.className)&&(t.showTab(a),this.plugin.action(this))}),$(i).keyup(function(e){13==e.keyCode&&/disabledTabItem/.test(this.className)&&(t.showTab(a),this.plugin.action(this))}),this.bottomContainerTabs.appendChild(i);var n=document.createElement("div");n.setAttribute("tab",a),n.className="tabContent disabled "+e.getSubclass(),this.bottomContainerContent.appendChild(n),e.buildContent(n),e.button=i,e.container=n,e.button.setAttribute("tabindex",3e3+e.getIndex()),e.button.setAttribute("alt",""),e.setToolTip(e.getDefaultToolTip()),void 0===this.firstTabShown&&(this.showTab(a),this.firstTabShown=!0),++this.currentTabIndex},addRightBarPlugin:function(e){var t=document.createElement("div");t.className="rightBarPluginContainer "+e.getSubclass(),this.rightContainer.appendChild(t),e.buildContent(t)}}),paella.extendedAdapter=new paella.ExtendedAdapter,Class("paella.editor.EmbedPlayer",base.AsyncLoaderCallback,{editar:null,initialize:function(){this.editor=paella.editor.instance},load:function(e,t){var a=this.editor.bottomBar.getHeight()+20,i=this.editor.rightBar.getWidth()+20;$(paella.player.mainContainer).css({position:"fixed",width:"",bottom:a+"px",right:i+"px",left:"20px",top:"20px"}),paella.player.mainContainer.className="paellaMainContainerEditorMode",new Timer(function(t){paella.player.controls.disable(),paella.player.onresize(),e&&e()},500)},restorePlayer:function(){$("body")[0].appendChild(paella.player.mainContainer),paella.player.controls.enable(),paella.player.mainContainer.className="",$(paella.player.mainContainer).css({position:"",width:"",bottom:"",left:"",right:"",top:""}),paella.player.onresize()},onresize:function(){var e=this.editor.bottomBar.getHeight()+20,t=this.editor.rightBar.getWidth()+20;$(paella.player.mainContainer).css({position:"fixed",width:"",bottom:e+"px",right:t+"px",left:"20px",top:"20px"})}}),DeprecatedClass("paella.Dictionary","base.Dictionary",base.Dictionary),paella.dictionary=base.dictionary,DeprecatedClass("paella.AsyncLoaderCallback","base.AsyncLoaderCallback",base.AsyncLoaderCallback),DeprecatedClass("paella.AjaxCallback","base.AjaxCallback",base.AjaxCallback),DeprecatedClass("paella.JSONCallback","base.JSONCallback",base.JSONCallback),DeprecatedClass("paella.DictionaryCallback","base.DictionaryCallback",base.DictionaryCallback),DeprecatedClass("paella.AsyncLoader","base.AsyncLoader",base.AsyncLoader),DeprecatedClass("paella.Timer","base.Timer",base.Timer),DeprecatedClass("paella.utils.Timer","base.Timer",base.Timer),paella.ajax={},paella.ajax.send=DeprecatedFunc("paella.ajax.send","base.ajax.send",base.ajax.send),paella.ajax.get=DeprecatedFunc("paella.ajax.get","base.ajax.get",base.ajax.get),paella.ajax.put=DeprecatedFunc("paella.ajax.put","base.ajax.put",base.ajax.put),paella.ajax.post=DeprecatedFunc("paella.ajax.post","base.ajax.post",base.ajax.post),paella.ajax.delete=DeprecatedFunc("paella.ajax.delete","base.ajax.delete",base.ajax.send),paella.ui={},paella.ui.Container=function(e){var t=document.createElement("div");return e.id&&(t.id=e.id),e.className&&(t.className=e.className),e.style&&$(t).css(e.style),t},paella.utils.ajax=base.ajax,paella.utils.cookies=base.cookies,paella.utils.parameters=base.parameters,paella.utils.require=base.require,paella.utils.importStylesheet=base.importStylesheet,paella.utils.language=base.dictionary.currentLanguage,paella.utils.uuid=base.uuid,paella.utils.userAgent=base.userAgent,paella.debug={log:function(e){base.log.warning("paella.debug.log is deprecated, use base.debug.[error/warning/debug/log] instead."),base.log.log(e)}},paella.debugReady=!0,paella.addPlugin(function(){class e extends paella.ButtonPlugin{getAlignment(){return"left"}getName(){return"edu.harvard.dce.paella.flexSkipPlugin"}getIndex(){return 121}getSubclass(){return"flexSkip_Rewind_10"}getIconClass(){return"icon-back-10-s"}formatMessage(){return"Rewind 10 seconds"}getDefaultToolTip(){return base.dictionary.translate(this.formatMessage())}getMinWindowSize(){return 510}checkEnabled(e){e(!paella.player.isLiveStream())}action(e){paella.player.videoContainer.currentTime().then(function(e){paella.player.videoContainer.seekToTime(e-10)})}}return paella.plugins.FlexSkipPlugin=e,e}),paella.addPlugin(function(){return class extends paella.plugins.FlexSkipPlugin{getIndex(){return 122}getName(){return"edu.harvard.dce.paella.flexSkipForwardPlugin"}getSubclass(){return"flexSkip_Forward_30"}getIconClass(){return"icon-forward-30-s"}formatMessage(){return"Forward 30 seconds"}action(e){paella.player.videoContainer.currentTime().then(function(e){paella.player.videoContainer.seekToTime(e+30)})}}}),paella.addPlugin(function(){return class extends paella.CaptionParserPlugIn{get ext(){return["vtt"]}getName(){return"es.teltek.paella.captions.WebVTTParserPlugin"}parse(e,t,a){for(var i,n=[],r=e.split("\n"),s=0,l=!1,o=0;o<r.length;++o){var u=r[o].trim();/^WEBVTT/.test(u)&&void 0===i||0===u.length||((/^[0-9]+$/.test(u)||/^[0-9]+ -/.test(u))&&0===r[o-1].trim().length||(/^NOTE/.test(u)||/^STYLE/.test(u)?l=!0:/^(([0-9]{2}:)?[0-9]{2}:[0-9]{2}.[0-9]{3} --> ([0-9]{2}:)?[0-9]{2}:[0-9]{2}.[0-9]{3})/.test(u)?(l=!1,void 0!=i&&(n.push(i),s++),i={id:s,begin:this.parseTimeTextToSeg(u.split("--\x3e")[0]),end:this.parseTimeTextToSeg(u.split("--\x3e")[1])}):void 0===i||l||(u=(u=u.replace(/^- /,"")).replace(/<[^>]*>/g,""),void 0===i.content?i.content=u:i.content+="<br/>"+u)))}n.push(i),n.length>0?a(!1,n):a(!0)}parseTimeTextToSeg(e){for(var t=0,a=1,i=(e=/(([0-9]{2}:)?[0-9]{2}:[0-9]{2}.[0-9]{3})/.exec(e))[0].split(":"),n=i.length-1;n>=0;n--)a=Math.pow(60,i.length-1-n),t+=i[n]*a;return t}}}),Class("paella.plugins.xAPISaverPlugin",paella.userTracking.SaverPlugIn,{getName:function(){return"es.teltek.paella.usertracking.xAPISaverPlugin"},setup:function(){this.endpoint=this.config.endpoint,this.auth=this.config.auth,this.user_info={},this.paused=!0,this.played_segments="",this.played_segments_segment_start=null,this.played_segments_segment_end=null,this.progress=0,this.duration=0,this.current_time=[],this.completed=!1,this.volume=null,this.speed=null,this.language="us-US",this.quality=null,this.fullscreen=!1,this.title="No title available",this.description="",this.user_agent="",this.total_time=0,this.total_time_start=0,this.total_time_end=0,this.session_id="";let e=this;this._loadDeps().then(function(){let t={endpoint:e.endpoint,auth:"Basic "+toBase64(e.auth)};ADL.XAPIWrapper.changeConfig(t)}),paella.events.bind(paella.events.timeUpdate,function(t,a){e.current_time.push(a.currentTime),e.current_time.length>=10&&(e.current_time=e.current_time.slice(-10));var i=Math.round(e.current_time[0]),n=Math.round(e.current_time[9]);0!==a.currentTime&&i+1>=n&&n-1>=i&&(e.progress=e.get_progress(a.currentTime,a.duration),e.progress>=.95&&!1===e.completed&&(e.completed=!0,e.end_played_segment(a.currentTime),e.start_played_segment(a.currentTime),e.send_completed(a.currentTime,e.progress)))})},get_session_data:function(){var e=ADL.XAPIWrapper.searchParams(),t=JSON.stringify({mbox:this.user_info.email}),a=new Date;a.setDate(a.getDate()-1),a=a.toISOString(),e.activity=window.location.href,e.verb="http://adlnet.gov/expapi/verbs/terminated",e.since=a,e.limit=1,e.agent=t;var i=ADL.XAPIWrapper.getStatements(e);1===i.statements.length?(this.played_segments=i.statements[0].result.extensions["https://w3id.org/xapi/video/extensions/played-segments"],this.progress=i.statements[0].result.extensions["https://w3id.org/xapi/video/extensions/progress"],ADL.XAPIWrapper.lrs.registration=i.statements[0].context.registration):ADL.XAPIWrapper.lrs.registration=ADL.ruuid()},getCookie:function(e){for(var t=e+"=",a=decodeURIComponent(document.cookie).split(";"),i=0;i<a.length;i++){for(var n=a[i];" "==n.charAt(0);)n=n.substring(1);if(0==n.indexOf(t))return n.substring(t.length,n.length)}return""},setCookie:function(e,t,a){var i=new Date;i.setTime(i.getTime()+24*a*60*60*1e3);var n="expires="+i.toUTCString();document.cookie=e+"="+t+";"+n+";path=/"},checkCookie:function(){var e=this.getCookie("user_info");return""===e&&(e=JSON.stringify(generateName())),this.setCookie("user_info",e),JSON.parse(e)},checkEnabled:function(e){this._url=this.config.url,this._index=this.config.index||"paellaplayer",this._type=this.config.type||"usertracking",e(!0)},_loadDeps:function(){return new Promise((e,t)=>{window.$paella_mpd?defer.resolve(window.$paella_mpd):require(["resources/deps/xapiwrapper.min.js"],function(){require(["resources/deps/random_name_generator.js"],function(){window.$paella_bg2e=!0,e(window.$paella_bg2e)})})})},log:function(e,t){let a=this;switch(e){case"paella:loadComplete":this.user_agent=navigator.userAgent.toString(),this.get_title(),this.get_description(),paella.player.videoContainer.duration().then(function(e){return paella.player.videoContainer.mainAudioPlayer().volume().then(function(t){return paella.player.videoContainer.getCurrentQuality().then(function(i){return paella.player.auth.userData().then(function(n){a.duration=e,a.volume=t,a.speed=1,paella.player.videoContainer.mainAudioPlayer().stream.language&&(a.language=paella.player.videoContainer.mainAudioPlayer().stream.language.replace("_","-")),a.quality=i.shortLabel(),n.email&&n.name?a.user_info=n:a.user_info=a.checkCookie(),a.get_session_data(),a.send_initialized()})})})}),window.onbeforeunload=function(e){a.paused||a.send_pause(a),a.send_terminated(a)};break;case"paella:play":this.send_play(a);break;case"paella:pause":this.send_pause(a);break;case"paella:seektotime":this.send_seek(a,t);break;case"paella:setVolume":paella.player.videoContainer.currentTime().then(function(e){var i=a.format_float(e);a.volume=t.master;var n={"https://w3id.org/xapi/video/extensions/volume":a.format_float(t.master)};a.send_interacted(i,n)});break;case"paella:setplaybackrate":paella.player.videoContainer.currentTime().then(function(e){var i=a.format_float(e);a.speed=t.rate;var n={"https://w3id.org/xapi/video/extensions/speed":t.rate+"x"};a.send_interacted(i,n)});break;case"paella:qualityChanged":paella.player.videoContainer.currentTime().then(function(e){return paella.player.videoContainer.getCurrentQuality().then(function(t){a.quality=t.shortLabel();var i=a.format_float(e),n={"https://w3id.org/xapi/video/extensions/quality":t.shortLabel()};a.send_interacted(i,n)})});break;case"paella:enterFullscreen":case"paella:exitFullscreen":paella.player.videoContainer.currentTime().then(function(e){var t=a.format_float(e);a.fullscreen?a.fullscreen=!1:a.fullscreen=!0;var i={"https://w3id.org/xapi/video/extensions/full-screen":a.fullscreen};a.send_interacted(t,i)})}},send:function(e){var t=new ADL.XAPIStatement.Agent(this.user_info.email,this.user_info.name),a=new ADL.XAPIStatement.Verb(e.verb.id,e.verb.description),i=new ADL.XAPIStatement.Activity(window.location.href,this.title,this.description);i.definition.type="https://w3id.org/xapi/video/activity-type/video",paella.player.videoContainer.mainAudioPlayer().volume().then(function(e){});var n=new ADL.XAPIStatement(t,a,i);n.result=e.result,"http://adlnet.gov/expapi/verbs/initialized"===e.verb.id&&(n.generateId(),this.session_id=n.id);var r={"https://w3id.org/xapi/video/extensions/session-id":this.session_id,"https://w3id.org/xapi/video/extensions/length":Math.floor(this.duration),"https://w3id.org/xapi/video/extensions/user-agent":this.user_agent},s={"https://w3id.org/xapi/video/extensions/volume":this.format_float(this.volume),"https://w3id.org/xapi/video/extensions/speed":this.speed+"x","https://w3id.org/xapi/video/extensions/quality":this.quality,"https://w3id.org/xapi/video/extensions/full-screen":this.fullscreen},l={};l=e.interacted?$.extend({},r,e.interacted):$.extend({},r,s),n.context={language:this.language,extensions:l,contextActivities:{category:[{objectType:"Activity",id:"https://w3id.org/xapi/video"}]}};ADL.XAPIWrapper.sendStatement(n)},send_initialized:function(){this.send({verb:{id:"http://adlnet.gov/expapi/verbs/initialized",description:"initalized"}})},send_terminated:function(e){paella.player.videoContainer.currentTime().then(function(t){var a={verb:{id:"http://adlnet.gov/expapi/verbs/terminated",description:"terminated"},result:{extensions:{"https://w3id.org/xapi/video/extensions/time":t,"https://w3id.org/xapi/video/extensions/progress":e.progress,"https://w3id.org/xapi/video/extensions/played-segments":e.played_segments}}};e.send(a)})},send_play:function(e){this.paused=!1,this.total_time_start=(new Date).getTime()/1e3,paella.player.videoContainer.currentTime().then(function(t){var a=e.format_float(t);a<=1&&(a=0),e.start_played_segment(a);var i={verb:{id:"https://w3id.org/xapi/video/verbs/played",description:"played"},result:{extensions:{"https://w3id.org/xapi/video/extensions/time":a}}};e.send(i)})},send_pause:function(e){this.paused=!0,this.total_time_end=(new Date).getTime()/1e3,this.total_time+=this.total_time_end-this.total_time_start,paella.player.videoContainer.currentTime().then(function(t){var a=e.format_float(t);0===a&&(a=e.duration),e.end_played_segment(a);var i={verb:{id:"https://w3id.org/xapi/video/verbs/paused",description:"paused"},result:{extensions:{"https://w3id.org/xapi/video/extensions/time":a,"https://w3id.org/xapi/video/extensions/progress":e.progress,"https://w3id.org/xapi/video/extensions/played-segments":e.played_segments}}};e.send(i)})},send_seek:function(e,t){var a=this.format_float(t.newPosition),i=this.current_time.filter(function(e){return e<=a-1});0===i.length&&(i=this.current_time.filter(function(e){return e>=a+1}));var n=i.filter(Number).pop();this.current_time=[],this.current_time.push(a),e.progress=e.get_progress(n,e.duration),this.paused||(this.end_played_segment(n),this.start_played_segment(a));var r={verb:{id:"https://w3id.org/xapi/video/verbs/seeked",description:"seeked"},result:{extensions:{"https://w3id.org/xapi/video/extensions/time-from":n,"https://w3id.org/xapi/video/extensions/time-to":a,"https://w3id.org/xapi/video/extensions/progress":e.progress,"https://w3id.org/xapi/video/extensions/played-segments":e.played_segments}}};e.send(r)},send_completed:function(e,t){var a={verb:{id:"http://adlnet.gov/xapi/verbs/completed",description:"completed"},result:{completion:!0,success:!0,duration:"PT"+this.total_time+"S",extensions:{"https://w3id.org/xapi/video/extensions/time":e,"https://w3id.org/xapi/video/extensions/progress":t,"https://w3id.org/xapi/video/extensions/played-segments":this.played_segments}}};this.send(a)},send_interacted:function(e,t){var a={verb:{id:"http://adlnet.gov/expapi/verbs/interacted",description:"interacted"},result:{extensions:{"https://w3id.org/xapi/video/extensions/time":e}},interacted:t};this.send(a)},start_played_segment:function(e){this.played_segments_segment_start=e},end_played_segment:function(e){var t;(t=""===this.played_segments?[]:this.played_segments.split("[,]")).push(this.played_segments_segment_start+"[.]"+e),this.played_segments=t.join("[,]"),this.played_segments_segment_end=e},format_float:function(e){return e=parseFloat(e),parseFloat(e.toFixed(3))},get_title:function(){paella.player.videoLoader.getMetadata().i18nTitle?this.title=paella.player.videoLoader.getMetadata().i18nTitle:paella.player.videoLoader.getMetadata().title&&(this.title=paella.player.videoLoader.getMetadata().title)},get_description:function(){paella.player.videoLoader.getMetadata().i18nTitle?this.description=paella.player.videoLoader.getMetadata().i18nDescription:this.description=paella.player.videoLoader.getMetadata().description},get_progress:function(e,t){var a,i;a=""===this.played_segments?[]:this.played_segments.split("[,]"),null!=this.played_segments_segment_start&&a.push(this.played_segments_segment_start+"[.]"+e),i=[],a.forEach(function(e,t){i[t]=e.split("[.]"),i[t][0]*=1,i[t][1]*=1}),i.sort(function(e,t){return e[0]-t[0]}),i.forEach(function(e,t){t>0&&i[t][0]<i[t-1][1]&&(i[t][0]=i[t-1][1],i[t][0]>i[t][1]&&(i[t][1]=i[t][0]))});var n=0;return i.forEach(function(e,t){e[1]>e[0]&&(n+=e[1]-e[0])}),1*(n/t).toFixed(2)}}),paella.plugins.xAPISaverPlugin=new paella.plugins.xAPISaverPlugin,paella.plugins.TrimmingTrackPlugin=Class.create(paella.editor.MainTrackPlugin,{trimmingTrack:null,trimmingData:{s:0,e:0},getTrackItems:function(){null==this.trimmingTrack&&(this.trimmingTrack={id:1,s:0,e:0},this.trimmingTrack.s=paella.player.videoContainer.trimStart(),this.trimmingTrack.e=paella.player.videoContainer.trimEnd(),this.trimmingData.s=this.trimmingTrack.s,this.trimmingData.e=this.trimmingTrack.e);var e=[];return e.push(this.trimmingTrack),e},getName:function(){return"es.upv.paella.editor.trimmingTrackPlugin"},getTools:function(){if(this.config.enableResetButton)return[{name:"reset",label:base.dictionary.translate("Reset"),hint:base.dictionary.translate("Resets the trimming bar to the default length of the video.")}]},onToolSelected:function(e){if(this.config.enableResetButton&&"reset"==e)return this.trimmingTrack={id:1,s:0,e:0},this.trimmingTrack.s=0,this.trimmingTrack.e=paella.player.videoContainer.duration(!0),!0},getTrackName:function(){return base.dictionary.translate("Trimming")},getColor:function(){return"rgb(0, 51, 107)"},onSave:function(e){paella.player.videoContainer.enableTrimming(),paella.player.videoContainer.setTrimmingStart(this.trimmingTrack.s),paella.player.videoContainer.setTrimmingEnd(this.trimmingTrack.e),this.trimmingData.s=this.trimmingTrack.s,this.trimmingData.e=this.trimmingTrack.e,paella.data.write("trimming",{id:paella.initDelegate.getId()},{start:this.trimmingTrack.s,end:this.trimmingTrack.e},function(t,a){e(a)})},onDiscard:function(e){this.trimmingTrack.s=this.trimmingData.s,this.trimmingTrack.e=this.trimmingData.e,e(!0)},allowDrag:function(){return!1},onTrackChanged:function(e,t,a){playerEnd=paella.player.videoContainer.duration(!0),t=t<0?0:t,a=a>playerEnd?playerEnd:a,this.trimmingTrack.s=t,this.trimmingTrack.e=a,this.parent(e,t,a)},contextHelpString:function(){return"es"==base.dictionary.currentLanguage()?'Utiliza la herramienta de recorte para definir el instante inicial y el instante final de la clase. Para cambiar la duracin solo hay que arrastrar el inicio o el final de la pista "Recorte", en la linea de tiempo.':"Use this tool to define the start and finish time."}}),paella.plugins.trimmingTrackPlugin=new paella.plugins.TrimmingTrackPlugin,paella.addPlugin(function(){return class extends paella.EventDrivenPlugin{getName(){return"es.upv.paella.trimmingPlayerPlugin"}getEvents(){return[paella.events.controlBarLoaded,paella.events.showEditor,paella.events.hideEditor]}onEvent(e,t){switch(e){case paella.events.controlBarLoaded:this.loadTrimming();break;case paella.events.showEditor:paella.player.videoContainer.disableTrimming();break;case paella.events.hideEditor:paella.player.config.trimming&&paella.player.config.trimming.enabled&&paella.player.videoContainer.enableTrimming()}}loadTrimming(){var e=paella.initDelegate.getId();paella.data.read("trimming",{id:e},function(e,t){if(e&&t&&e.end>0)paella.player.videoContainer.setTrimming(e.start,e.end).then(()=>paella.player.videoContainer.enableTrimming());else{var a=base.parameters.get("start"),i=base.parameters.get("end");a&&i&&paella.player.videoContainer.setTrimming(a,i).then(()=>paella.player.videoContainer.enableTrimming())}})}}}),paella.addPlugin(function(){return class extends paella.ButtonPlugin{getIndex(){return 552}getAlignment(){return"right"}getSubclass(){return"AirPlayButton"}getIconClass(){return"icon-airplay"}getName(){return"es.upv.paella.airPlayPlugin"}checkEnabled(e){this._visible=!1,e(window.WebKitPlaybackTargetAvailabilityEvent)}getDefaultToolTip(){return base.dictionary.translate("Emit to AirPlay.")}setup(){let e=paella.player.videoContainer.masterVideo().video;window.WebKitPlaybackTargetAvailabilityEvent&&e.addEventListener("webkitplaybacktargetavailabilitychanged",e=>{switch(e.availability){case"available":this._visible=!0;break;case"not-available":this._visible=!1}this.updateClassName()})}action(e){paella.player.videoContainer.masterVideo().video.webkitShowPlaybackTargetPicker()}updateClassName(){this.button.className=this.getButtonItemClass(!0)}getButtonItemClass(e){return"buttonPlugin "+this.getSubclass()+" "+this.getAlignment()+" "+(this._visible?"available":"not-available")}}}),paella.addPlugin(function(){return class extends paella.EventDrivenPlugin{getName(){return"es.upv.paella.arrowSlidesNavigatorPlugin"}checkEnabled(e){!paella.initDelegate.initParams.videoLoader.frameList||0==Object.keys(paella.initDelegate.initParams.videoLoader.frameList).length&&paella.player.videoContainer.isMonostream?e(!1):e(!0)}setup(){var e=this;this._showArrowsIn=this.config.showArrowsIn||"slave",this.createOverlay(),e._frames=[];var t=paella.initDelegate.initParams.videoLoader.frameList;if(t){var a=Object.keys(t);a.length,a.map(function(e){return Number(e,10)}).sort(function(e,t){return e-t}).forEach(function(a){e._frames.push(t[a])})}}createOverlay(){var e=this;let t=paella.player.videoContainer.overlayContainer;if(!this.arrows){this.arrows=document.createElement("div"),this.arrows.id="arrows",this.arrows.style.marginTop="25%";let t=document.createElement("div");t.className="buttonPlugin arrowSlideNavidator nextButton right icon-arrow-right",this.arrows.appendChild(t);let a=document.createElement("div");a.className="buttonPlugin arrowSlideNavidator prevButton left icon-arrow-left",this.arrows.appendChild(a),$(t).click(function(t){e.goNextSlide(),t.stopPropagation()}),$(a).click(function(t){e.goPrevSlide(),t.stopPropagation()})}switch(this.container&&t.removeElement(this.container),e._showArrowsIn){case"full":this.container=t.addLayer(),this.container.style.marginRight="0",this.container.style.marginLeft="0",this.arrows.style.marginTop="25%";break;case"master":var a=document.createElement("div");this.container=t.addElement(a,t.getMasterRect()),this.arrows.style.marginTop="23%";break;case"slave":a=document.createElement("div");this.container=t.addElement(a,t.getSlaveRect()),this.arrows.style.marginTop="35%"}this.container.appendChild(this.arrows),this.hideArrows()}getCurrentRange(){return new Promise(e=>{if(this._frames.length<1)e(null);else{let t=null,a=0;paella.player.videoContainer.duration().then(e=>(a=e,paella.player.videoContainer.trimming())).then(e=>(t=e,paella.player.videoContainer.currentTime())).then(a=>{if(!this._frames.some((i,n,r)=>{if(n+1==r.length)return;let s=0==n?i:this._frames[n-1],l=this._frames[n+1],o=t.enabled?s.time-t.start:s.time,u=t.enabled?i.time-t.start:i.time,d=t.enabled?l.time-t.start:l.time;if(u<a&&d>a){let t={prev:o,next:d};return o<0&&(t.prev=u>0?u:0),e(t),!0}})){let a=this._frames[this._frames.length-2].time,i=this._frames[this._frames.length-1].time;e({prev:t.enabled?a-t.start:a,next:t.enabled?i-t.start:i})}})}})}goNextSlide(){this.getCurrentRange().then(e=>{paella.player.videoContainer.seekToTime(e.next)})}goPrevSlide(){this.getCurrentRange().then(e=>{paella.player.videoContainer.seekToTime(e.prev)})}showArrows(){$(this.arrows).show()}hideArrows(){$(this.arrows).hide()}getEvents(){return[paella.events.controlBarDidShow,paella.events.controlBarDidHide,paella.events.setComposition]}onEvent(e,t){switch(e){case paella.events.controlBarDidShow:this.showArrows();break;case paella.events.controlBarDidHide:this.hideArrows();break;case paella.events.setComposition:this.createOverlay()}}}}),paella.addPlugin(function(){return class extends paella.ButtonPlugin{getAlignment(){return"right"}getSubclass(){return"audioLanguages"}getIconClass(){return"icon-headphone"}getIndex(){return 2040}getMinWindowSize(){return 400}getName(){return"es.upv.paella.audioLanguage"}getDefaultToolTip(){return base.dictionary.translate("Set audio language")}closeOnMouseOut(){return!0}checkEnabled(e){paella.player.videoContainer.getAudioLanguages().then(t=>{this._languages=t,e(t.length>1)})}setup(){this.setLanguageLabel(),paella.events.bind(paella.events.audioLanguageChanged,()=>{this.setLanguageLabel()})}getButtonType(){return paella.ButtonPlugin.type.popUpButton}buildContent(e){this._languages.forEach(t=>{e.appendChild(this.getItemButton(t))})}getItemButton(e){var t=document.createElement("div");let a=paella.player.videoContainer.mainAudioPlayer().stream.language,i=paella.dictionary.translate(e);return t.className=this.getButtonItemClass(i,e==a),t.id="laguageSelectorItem_"+e,t.innerHTML=i,t.data=e,$(t).click(function(e){$(".videoAudioTrackItem").removeClass("selected"),$(".videoAudioTrackItem."+this.data).addClass("selected"),paella.player.videoContainer.setAudioLanguage(this.data)}),t}setQualityLabel(){var e=this;paella.player.videoContainer.getCurrentQuality().then(function(t){e.setText(t.shortLabel())})}getButtonItemClass(e,t){return"videoAudioTrackItem "+e+(t?" selected":"")}setLanguageLabel(){this.setText(paella.player.videoContainer.audioLanguage)}}}),paella.addPlugin(function(){return class extends paella.EventDrivenPlugin{getName(){return"es.upv.paella.blackBoardPlugin"}getIndex(){return 10}getAlignment(){return"right"}getSubclass(){return"blackBoardButton2"}getDefaultToolTip(){return base.dictionary.translate("BlackBoard")}checkEnabled(e){this._blackBoardProfile="s_p_blackboard2",this._blackBoardDIV=null,this._hasImages=null,this._active=!1,this._creationTimer=500,this._zImages=null,this._videoLength=null,this._keys=null,this._currentImage=null,this._next=null,this._prev=null,this._lensDIV=null,this._lensContainer=null,this._lensWidth=null,this._lensHeight=null,this._conImg=null,this._zoom=250,this._currentZoom=null,this._maxZoom=500,this._mousePos=null,this._containerRect=null,e(!0)}getEvents(){return[paella.events.setProfile,paella.events.timeUpdate]}onEvent(e,t){switch(e){case paella.events.setProfile:if(t.profileName!=this._blackBoardProfile){this._active&&(this.destroyOverlay(),this._active=!1);break}this._hasImages||paella.player.setProfile("slide_professor"),this._hasImages&&!this._active&&(this.createOverlay(),this._active=!0);break;case paella.events.timeUpdate:this._active&&this._hasImages&&this.imageUpdate(e,t)}}setup(){var e=this;if(paella.player.videoContainer.sourceData[0].sources.hasOwnProperty("image"))e._hasImages=!0,e._zImages={},e._zImages=paella.player.videoContainer.sourceData[0].sources.image[0].frames,e._videoLength=paella.player.videoContainer.sourceData[0].sources.image[0].duration,e._keys=Object.keys(e._zImages),e._keys=e._keys.sort(function(e,t){return e=e.slice(6),t=t.slice(6),parseInt(e)-parseInt(t)});else if(e._hasImages=!1,paella.player.selectedProfile==e._blackBoardProfile){let e=paella.player.config.defaultProfile;paella.player.setProfile(e)}this._next=0,this._prev=0,paella.player.selectedProfile==e._blackBoardProfile&&(e.createOverlay(),e._active=!0),e._mousePos={},paella.Profiles.loadProfile(e._blackBoardProfile,function(t){e._containerRect=t.blackBoardImages})}createLens(){var e=this;null==e._currentZoom&&(e._currentZoom=e._zoom);var t=document.createElement("div");t.className="lensClass",e._lensDIV=t;var a=$(".conImg").offset(),i=$(".conImg").width(),n=$(".conImg").height();t.style.width=i/(e._currentZoom/100)+"px",t.style.height=n/(e._currentZoom/100)+"px",e._lensWidth=parseInt(t.style.width),e._lensHeight=parseInt(t.style.height),$(e._lensContainer).append(t),$(e._lensContainer).mousemove(function(t){let r=t.pageX-a.left,s=t.pageY-a.top;e._mousePos.x=r,e._mousePos.y=s;let l=s-e._lensHeight/2;l=(l=l<0?0:l)>n-e._lensHeight?n-e._lensHeight:l;let o=r-e._lensWidth/2;if(o=(o=o<0?0:o)>i-e._lensWidth?i-e._lensWidth:o,e._lensDIV.style.left=o+"px",e._lensDIV.style.top=l+"px",100!=e._currentZoom){let t=100*o/(i-e._lensWidth),a=100*l/(n-e._lensHeight);e._blackBoardDIV.style.backgroundPosition=t.toString()+"% "+a.toString()+"%"}else if(100==e._currentZoom){var u=100*r/i,d=100*s/n;e._blackBoardDIV.style.backgroundPosition=u.toString()+"% "+d.toString()+"%"}e._blackBoardDIV.style.backgroundSize=e._currentZoom+"%"}),$(e._lensContainer).bind("wheel mousewheel",function(t){let a;(a=void 0!==t.originalEvent.wheelDelta?t.originalEvent.wheelDelta:-1*t.originalEvent.deltaY)>0&&e._currentZoom<e._maxZoom?e.reBuildLens(10):e._currentZoom>100?e.reBuildLens(-10):100==e._currentZoom&&(e._lensDIV.style.left="0px",e._lensDIV.style.top="0px"),e._blackBoardDIV.style.backgroundSize=e._currentZoom+"%"})}reBuildLens(e){this._currentZoom+=e;$(".conImg").offset();var t=$(".conImg").width(),a=$(".conImg").height();if(this._lensDIV.style.width=t/(this._currentZoom/100)+"px",this._lensDIV.style.height=a/(this._currentZoom/100)+"px",this._lensWidth=parseInt(this._lensDIV.style.width),this._lensHeight=parseInt(this._lensDIV.style.height),100!=this._currentZoom){let e=this._mousePos.x,i=this._mousePos.y-this._lensHeight/2;i=(i=i<0?0:i)>a-this._lensHeight?a-this._lensHeight:i;let n=e-this._lensWidth/2;n=(n=n<0?0:n)>t-this._lensWidth?t-this._lensWidth:n,this._lensDIV.style.left=n+"px",this._lensDIV.style.top=i+"px";let r=100*n/(t-this._lensWidth),s=100*i/(a-this._lensHeight);this._blackBoardDIV.style.backgroundPosition=r.toString()+"% "+s.toString()+"%"}}destroyLens(){this._lensDIV&&($(this._lensDIV).remove(),this._blackBoardDIV.style.backgroundSize="100%",this._blackBoardDIV.style.opacity=0)}createOverlay(){var e=this,t=document.createElement("div");t.className="blackBoardDiv",e._blackBoardDIV=t,e._blackBoardDIV.style.opacity=0;var a=document.createElement("div");a.className="lensContainer",e._lensContainer=a;var i=document.createElement("img");i.className="conImg",e._conImg=i,e._currentImage&&(e._conImg.src=e._currentImage,$(e._blackBoardDIV).css("background-image","url("+e._currentImage+")")),$(a).append(i),$(e._lensContainer).mouseenter(function(){e.createLens(),e._blackBoardDIV.style.opacity=1}),$(e._lensContainer).mouseleave(function(){e.destroyLens()}),setTimeout(function(){let i=paella.player.videoContainer.overlayContainer;i.addElement(t,i.getMasterRect()),i.addElement(a,e._containerRect)},e._creationTimer)}destroyOverlay(){this._blackBoardDIV&&$(this._blackBoardDIV).remove(),this._lensContainer&&$(this._lensContainer).remove()}imageUpdate(e,t){var a=this,i=Math.round(t.currentTime),n=$(a._blackBoardDIV).css("background-image");if($(a._blackBoardDIV).length>0){if(a._zImages.hasOwnProperty("frame_"+i)){if(n==a._zImages["frame_"+i])return;n=a._zImages["frame_"+i]}else{if(!(i>a._next||i<a._prev))return;n=a.returnSrc(i)}var r=new Image;r.onload=function(){$(a._blackBoardDIV).css("background-image","url("+n+")")},r.src=n,a._currentImage=n,a._conImg.src=a._currentImage}}returnSrc(e){var t=0;for(let n=0;n<this._keys.length;n++){var a=parseInt(this._keys[n].slice(6)),i=parseInt(this._keys[this._keys.length-1].slice(6));if(e<a)return this._next=a,this._prev=t,this._imageNumber=n-1,this._zImages["frame_"+t];if(e>i&&e<this._videoLength)return this._next=this._videoLength,this._prev=i,this._zImages["frame_"+t];t=a}}}}),paella.addPlugin(()=>(class extends paella.EventDrivenPlugin{get breaks(){return this._breaks||[]}set breaks(e){this._breaks=e}get lastEvent(){return this._lastEvent||0}set lastEvent(e){this._lastEvent=e}get visibleBreaks(){return this._visibleBreaks||[]}set visibleBreaks(e){this._visibleBreaks=e}getName(){return"es.upv.paella.breaksPlayerPlugin"}checkEnabled(e){var t=this;paella.data.read("breaks",{id:paella.initDelegate.getId()},function(a,i){a&&"object"==typeof a&&a.breaks&&a.breaks.length>0&&(t.breaks=a.breaks),e(!0)})}getEvents(){return[paella.events.timeUpdate]}onEvent(e,t){var a=this;t.videoContainer.currentTime(!0).then(function(e){a.checkBreaks(e)})}checkBreaks(e){for(var t,a=0;a<this.breaks.length;++a)(t=this.breaks[a]).s<e&&t.e>e?this.areBreaksClickable()?this.avoidBreak(t):this.showBreaks(t):t.s.toFixed(0)==e.toFixed(0)&&this.avoidBreak(t);if(!this.areBreaksClickable())for(var i in this.visibleBreaks)"object"==typeof t&&(t=this.visibleBreaks[i])&&(t.s>=e||t.e<=e)&&this.removeBreak(t)}areBreaksClickable(){return this.config.neverShow&&!(paella.editor.instance&&paella.editor.instance.isLoaded)}showBreaks(e){if(!this.visibleBreaks[e.s]){let t=e.name||paella.dictionary.translate("Break");e.elem=paella.player.videoContainer.overlayContainer.addText(t,{left:100,top:350,width:1080,height:40}),e.elem.className="textBreak",this.visibleBreaks[e.s]=e}}removeBreak(e){if(this.visibleBreaks[e.s]){var t=this.visibleBreaks[e.s].elem;paella.player.videoContainer.overlayContainer.removeElement(t),this.visibleBreaks[e.s]=null}}avoidBreak(e){var t;paella.player.videoContainer.trimEnabled()?paella.player.videoContainer.trimming().then(a=>{e.e>=a.end?(t=0,paella.player.videoContainer.pause()):t=e.e+(this.config.neverShow?.01:0)-a.start,paella.player.videoContainer.seekToTime(t)}):paella.player.videoContainer.duration(!0).then(a=>{e.e>=a?(t=0,paella.player.videoContainer.pause()):t=e.e+(this.config.neverShow?.01:0),paella.player.videoContainer.seekToTime(t)})}})),paella.addPlugin(function(){return class extends paella.CaptionParserPlugIn{get ext(){return["dfxp"]}getName(){return"es.upv.paella.captions.DFXPParserPlugin"}parse(e,t,a){for(var i=[],n=this,r=$(e),s=r.attr("xml:lang"),l=r.find("div"),o=0;o<l.length;++o){var u=$(l[o]),d=u.attr("xml:lang");if(void 0!=d&&""!=d||(void 0==s||""==s?(base.log.debug("No xml:lang found! Using '"+t+"' lang instead."),d=t):d=s),d==t){u.find("p").each(function(e,t){var a={id:e,begin:n.parseTimeTextToSeg(t.getAttribute("begin")),end:n.parseTimeTextToSeg(t.getAttribute("end")),content:$(t).text().trim()};i.push(a)});break}}i.length>0?a(!1,i):a(!0)}parseTimeTextToSeg(e){var t=0;if(/^([0-9]*([.,][0-9]*)?)s/.test(e))t=parseFloat(RegExp.$1);else{var a=e.split(":"),i=parseInt(a[0]),n=parseInt(a[1]);t=parseInt(a[2])+60*n+60*i*60}return t}}}),paella.addPlugin(function(){return class extends paella.ButtonPlugin{getInstanceName(){return"captionsPlugin"}getAlignment(){return"right"}getSubclass(){return"captionsPluginButton"}getIconClass(){return"icon-captions"}getName(){return"es.upv.paella.captionsPlugin"}getButtonType(){return paella.ButtonPlugin.type.popUpButton}getDefaultToolTip(){return base.dictionary.translate("Subtitles")}getIndex(){return 509}closeOnMouseOut(){return!1}checkEnabled(e){this._searchTimerTime=1500,this._searchTimer=null,this._pluginButton=null,this._open=0,this._parent=null,this._body=null,this._inner=null,this._bar=null,this._input=null,this._select=null,this._editor=null,this._activeCaptions=null,this._lastSel=null,this._browserLang=null,this._defaultBodyHeight=280,this._autoScroll=!0,this._searchOnCaptions=null,e(!0)}showUI(){paella.captions.getAvailableLangs().length>=1&&super.showUI()}setup(){var e=this;paella.captions.getAvailableLangs().length||paella.plugins.captionsPlugin.hideUI(),paella.events.bind(paella.events.captionsEnabled,function(t,a){e.onChangeSelection(a)}),paella.events.bind(paella.events.captionsDisabled,function(t,a){e.onChangeSelection(a)}),paella.events.bind(paella.events.captionAdded,function(t,a){e.onCaptionAdded(a),paella.plugins.captionsPlugin.showUI()}),paella.events.bind(paella.events.timeUpdate,function(t,a){e._searchOnCaptions&&e.updateCaptionHiglighted(a)}),paella.events.bind(paella.events.controlBarWillHide,function(t){e.cancelHideBar()}),e._activeCaptions=paella.captions.getActiveCaptions(),e._searchOnCaptions=e.config.searchOnCaptions||!1}cancelHideBar(){this._open>0&&paella.player.controls.cancelHideBar()}updateCaptionHiglighted(e){var t=this,a=null;e&&paella.player.videoContainer.trimming().then(i=>{let n=i.enabled?i.start:0,r=paella.captions.getActiveCaptions(),s=r&&r.getCaptionAtTime(e.currentTime+n),l=s&&s.id;null!=l&&((a=$(".bodyInnerContainer[sec-id='"+l+"']"))!=t._lasSel&&$(t._lasSel).removeClass("Highlight"),a&&($(a).addClass("Highlight"),t._autoScroll&&t.updateScrollFocus(l),t._lasSel=a))})}updateScrollFocus(e){var t=0,a=$(".bodyInnerContainer").slice(0,e);(a=a.toArray()).forEach(function(e){var a=$(e).outerHeight(!0);t+=a});var i=parseInt(t/280);$(".captionsBody").scrollTop(i*this._defaultBodyHeight)}onCaptionAdded(e){var t=paella.captions.getCaptions(e),a=document.createElement("option");a.text=t._lang.txt,a.value=e,this._select.add(a)}changeSelection(){var e=$(this._select).val();if(""==e)return $(this._body).empty(),void paella.captions.setActiveCaptions(e);paella.captions.setActiveCaptions(e),this._activeCaptions=e,this._searchOnCaptions&&this.buildBodyContent(paella.captions.getActiveCaptions()._captions,"list"),this.setButtonHideShow()}onChangeSelection(e){this._activeCaptions!=e&&($(this._body).empty(),void 0==e?(this._select.value="",$(this._input).prop("disabled",!0)):($(this._input).prop("disabled",!1),this._select.value=e,this._searchOnCaptions&&this.buildBodyContent(paella.captions.getActiveCaptions()._captions,"list")),this._activeCaptions=e,this.setButtonHideShow())}action(){switch(this._browserLang=base.dictionary.currentLanguage(),this._autoScroll=!0,this._open){case 0:this._browserLang&&void 0==paella.captions.getActiveCaptions()&&this.selectDefaultBrowserLang(this._browserLang),this._open=1,paella.keyManager.enabled=!1;break;case 1:paella.keyManager.enabled=!0,this._open=0}}buildContent(e){var t=this;t._parent=document.createElement("div"),t._parent.className="captionsPluginContainer",t._bar=document.createElement("div"),t._bar.className="captionsBar",t._searchOnCaptions&&(t._body=document.createElement("div"),t._body.className="captionsBody",t._parent.appendChild(t._body),$(t._body).scroll(function(){t._autoScroll=!1}),t._input=document.createElement("input"),t._input.className="captionsBarInput",t._input.type="text",t._input.id="captionsBarInput",t._input.name="captionsString",t._input.placeholder=base.dictionary.translate("Search captions"),t._bar.appendChild(t._input),$(t._input).change(function(){var e=$(t._input).val();t.doSearch(e)}),$(t._input).keyup(function(){var e=$(t._input).val();null!=t._searchTimer&&t._searchTimer.cancel(),t._searchTimer=new base.Timer(function(a){t.doSearch(e)},t._searchTimerTime)})),t._select=document.createElement("select"),t._select.className="captionsSelector";var a=document.createElement("option");a.text=base.dictionary.translate("None"),a.value="",t._select.add(a),paella.captions.getAvailableLangs().forEach(function(e){var a=document.createElement("option");a.text=e.lang.txt,a.value=e.id,t._select.add(a)}),t._bar.appendChild(t._select),t._parent.appendChild(t._bar),$(t._select).change(function(){t.changeSelection()}),t._editor=document.createElement("button"),t._editor.className="editorButton",t._editor.innerHTML="",t._bar.appendChild(t._editor),$(t._editor).prop("disabled",!0),$(t._editor).click(function(){var e=paella.captions.getActiveCaptions();paella.userTracking.log("paella:caption:edit",{id:e._captionsProvider+":"+e._id,lang:e._lang}),e.goToEdit()}),e.appendChild(t._parent)}selectDefaultBrowserLang(e){var t=null;paella.captions.getAvailableLangs().forEach(function(a){a.lang.code==e&&(t=a.id)}),t&&paella.captions.setActiveCaptions(t)}doSearch(e){var t=this,a=paella.captions.getActiveCaptions();a&&(""==e?t.buildBodyContent(paella.captions.getActiveCaptions()._captions,"list"):a.search(e,function(e,a){e||t.buildBodyContent(a,"search")}))}setButtonHideShow(){var e=$(".editorButton"),t=paella.captions.getActiveCaptions(),a=null;null!=t?($(this._select).width("39%"),t.canEdit(function(e,t){a=t}),a?($(e).prop("disabled",!1),$(e).show()):($(e).prop("disabled",!0),$(e).hide(),$(this._select).width("47%"))):($(e).prop("disabled",!0),$(e).hide(),$(this._select).width("47%")),this._searchOnCaptions||(a?$(this._select).width("92%"):$(this._select).width("100%"))}buildBodyContent(e,t){var a=this;$(a._body).empty(),e.forEach(function(e){paella.player.videoContainer.trimming().then(i=>{i.enabled&&(e.end<i.start||e.begin>i.end)||(a._inner=document.createElement("div"),a._inner.className="bodyInnerContainer",a._inner.innerHTML=e.content,"list"==t&&(a._inner.setAttribute("sec-begin",e.begin),a._inner.setAttribute("sec-end",e.end),a._inner.setAttribute("sec-id",e.id),a._autoScroll=!0),"search"==t&&a._inner.setAttribute("sec-begin",e.time),a._body.appendChild(a._inner),$(a._inner).hover(function(){$(this).css("background-color","rgba(250, 161, 102, 0.5)")},function(){$(this).removeAttr("style")}),$(a._inner).click(function(){var e=$(this).attr("sec-begin");paella.player.videoContainer.trimming().then(t=>{let a=t.enabled?t.start:0;paella.player.videoContainer.seekToTime(parseInt(e-a))})}))})})}}}),paella.addPlugin(function(){return class extends paella.EventDrivenPlugin{checkEnabled(e){this.containerId="paella_plugin_CaptionsOnScreen",this.container=null,this.innerContainer=null,this.top=null,this.actualPos=null,this.lastEvent=null,this.controlsPlayback=null,this.captions=!1,this.captionProvider=null,e(!paella.player.isLiveStream())}setup(){}getEvents(){return[paella.events.controlBarDidHide,paella.events.resize,paella.events.controlBarDidShow,paella.events.captionsEnabled,paella.events.captionsDisabled,paella.events.timeUpdate]}onEvent(e,t){switch(e){case paella.events.controlBarDidHide:if(this.lastEvent==e||0==this.captions)break;this.moveCaptionsOverlay("down");break;case paella.events.resize:if(0==this.captions)break;paella.player.controls.isHidden()?this.moveCaptionsOverlay("down"):this.moveCaptionsOverlay("top");break;case paella.events.controlBarDidShow:if(this.lastEvent==e||0==this.captions)break;this.moveCaptionsOverlay("top");break;case paella.events.captionsEnabled:this.buildContent(t),this.captions=!0,paella.player.controls.isHidden()?this.moveCaptionsOverlay("down"):this.moveCaptionsOverlay("top");break;case paella.events.captionsDisabled:this.hideContent(),this.captions=!1;break;case paella.events.timeUpdate:this.captions&&this.updateCaptions(t)}this.lastEvent=e}buildContent(e){this.captionProvider=e,null==this.container?(this.container=document.createElement("div"),this.container.className="CaptionsOnScreen",this.container.id=this.containerId,this.innerContainer=document.createElement("div"),this.innerContainer.className="CaptionsOnScreenInner",this.container.appendChild(this.innerContainer),null==this.controlsPlayback&&(this.controlsPlayback=$("#playerContainer_controls_playback")),paella.player.videoContainer.domElement.appendChild(this.container)):$(this.container).show()}updateCaptions(e){this.captions&&paella.player.videoContainer.trimming().then(t=>{let a=t.enabled?t.start:0;var i=paella.captions.getActiveCaptions().getCaptionAtTime(e.currentTime+a);i?($(this.container).show(),this.innerContainer.innerHTML=i.content,this.moveCaptionsOverlay("auto")):(this.innerContainer.innerHTML="",this.hideContent())})}hideContent(){$(this.container).hide()}moveCaptionsOverlay(e){if(null==this.controlsPlayback&&(this.controlsPlayback=$("#playerContainer_controls_playback")),"auto"!=e&&void 0!=e||(e=paella.player.controls.isHidden()?"down":"top"),"down"==e){var t=this.container.offsetHeight;t-=this.innerContainer.offsetHeight+10,this.innerContainer.style.bottom=0-t+"px"}if("top"==e){var a=this.controlsPlayback.offset().top;a-=this.innerContainer.offsetHeight+10,this.innerContainer.style.bottom=0-a+"px"}}getIndex(){return 1050}getName(){return"es.upv.paella.overlayCaptionsPlugin"}}}),Class("paella.ChromaVideo",paella.VideoElementBase,{_posterFrame:null,_currentQuality:null,_autoplay:!1,_streamName:null,initialize:function(e,t,a,i,n,r,s){this.parent(e,t,"canvas",a,i,n,r),this._streamName=s||"chroma";var l=this;this._stream.sources[this._streamName]&&this._stream.sources[this._streamName].sort(function(e,t){return e.res.h-t.res.h}),this.video=null,new paella.Timer(function(e){!function(){if(l.canvasController){let e=l.canvasController.canvas.domElement;l.canvasController.reshape($(e).width(),$(e).height())}}()},500).repeat=!0},defaultProfile:function(){return"chroma"},_setVideoElem:function(e){$(this.video).bind("progress",evtCallback),$(this.video).bind("loadstart",evtCallback),$(this.video).bind("loadedmetadata",evtCallback),$(this.video).bind("canplay",evtCallback),$(this.video).bind("oncanplay",evtCallback)},_loadDeps:function(){return new Promise((e,t)=>{window.$paella_bg2e?defer.resolve(window.$paella_bg2e):paella.require(paella.baseUrl+"resources/deps/bg2e.js").then(()=>{window.$paella_bg2e=bg,e(window.$paella_bg2e)}).catch(e=>{console.error(e.message),t()})})},_deferredAction:function(e){return new Promise((t,a)=>{this.video?t(e()):$(this.video).bind("canplay",()=>{this._ready=!0,t(e())})})},_getQualityObject:function(e,t){return{index:e,res:t.res,src:t.src,toString:function(){return this.res.w+"x"+this.res.h},shortLabel:function(){return this.res.h+"p"},compare:function(e){return this.res.w*this.res.h-e.res.w*e.res.h}}},allowZoom:()=>!1,getVideoData:function(){var e=this;return new Promise((t,a)=>{this._deferredAction(()=>{t({duration:e.video.duration,currentTime:e.video.currentTime,volume:e.video.volume,paused:e.video.paused,ended:e.video.ended,res:{w:e.video.videoWidth,h:e.video.videoHeight}})})})},setPosterFrame:function(e){this._posterFrame=e},setAutoplay:function(e){this._autoplay=e,e&&this.video&&this.video.setAttribute("autoplay",e)},load:function(){return new Promise((e,t)=>{this._loadDeps().then(()=>{var a=this._stream.sources[this._streamName];null===this._currentQuality&&this._videoQualityStrategy&&(this._currentQuality=this._videoQualityStrategy.getQualityIndex(a));var i=this._currentQuality<a.length?a[this._currentQuality]:null;this.video=null,this.domElement.parentNode.style.backgroundColor="transparent",i?(this.canvasController=null,buildChromaVideoCanvas(i,this.domElement).then(t=>{this.canvasController=t,this.video=t.video,this.video.pause(),i.crop&&(this.canvasController.crop=new bg.Vector4(i.crop.left,i.crop.top,i.crop.right,i.crop.bottom)),i.displacement&&(this.canvasController.transform=bg.Matrix4.Translation(i.displacement.x,i.displacement.y,0)),i.chromaColor&&(this.canvasController.chroma=new bg.Color(i.chromaColor[0],i.chromaColor[1],i.chromaColor[2],i.chromaColor[3])),i.chromaBias&&(this.canvasController.bias=i.chromaBias),e(i)})):t(new Error("Could not load video: invalid quality stream index"))})})},getQualities:function(){return new Promise((e,t)=>{setTimeout(()=>{var t=[],a=-1;this._stream.sources[this._streamName].forEach(e=>{a++,t.push(this._getQualityObject(a,e))}),e(t)},10)})},setQuality:function(e){return new Promise(t=>{var a=this.video.paused,i=this._stream.sources[this._streamName];this._currentQuality=e<i.length?e:0;var n=this.video.currentTime;this.freeze().then(()=>(this._ready=!1,this.load())).then(()=>{a||this.play(),$(this.video).on("seeked",()=>{this.unFreeze(),t(),$(this.video).off("seeked")}),this.video.currentTime=n})})},getCurrentQuality:function(){return new Promise(e=>{e(this._getQualityObject(this._currentQuality,this._stream.sources[this._streamName][this._currentQuality]))})},play:function(){return this._deferredAction(()=>{bg.app.MainLoop.singleton.updateMode=bg.app.FrameUpdate.AUTO,this.video.play()})},pause:function(){return this._deferredAction(()=>{bg.app.MainLoop.singleton.updateMode=bg.app.FrameUpdate.MANUAL,this.video.pause()})},isPaused:function(){return this._deferredAction(()=>this.video.paused)},duration:function(){return this._deferredAction(()=>this.video.duration)},setCurrentTime:function(e){return this._deferredAction(()=>{this.video.currentTime=e,$(this.video).on("seeked",()=>{this.canvasController.postRedisplay(),$(this.video).off("seeked")})})},currentTime:function(){return this._deferredAction(()=>this.video.currentTime)},setVolume:function(e){return this._deferredAction(()=>{this.video.volume=e})},volume:function(){return this._deferredAction(()=>this.video.volume)},setPlaybackRate:function(e){return this._deferredAction(()=>{this.video.playbackRate=e})},playbackRate:function(){return this._deferredAction(()=>this.video.playbackRate)},goFullScreen:function(){return this._deferredAction(()=>{var e=this.video;e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitEnterFullscreen&&e.webkitEnterFullscreen()})},unFreeze:function(){return this._deferredAction(()=>{var e=document.getElementById(this.video.className+"canvas");$(e).remove()})},freeze:function(){return this._deferredAction(function(){})},unload:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()},getDimensions:function(){return paella_DeferredNotImplemented()}}),Class("paella.videoFactories.ChromaVideoFactory",{isStreamCompatible:function(e){try{if(paella.ChromaVideo._loaded)return!1;if(paella.videoFactories.Html5VideoFactory.s_instances>0&&base.userAgent.system.iOS)return!1;for(var t in e.sources)if("chroma"==t)return!0}catch(e){}return!1},getVideoObject:function(e,t,a){return paella.ChromaVideo._loaded=!0,++paella.videoFactories.Html5VideoFactory.s_instances,new paella.ChromaVideo(e,t,a.x,a.y,a.w,a.h)}}),paella.addPlugin(function(){return class extends paella.TabBarPlugin{get divPublishComment(){return this._divPublishComment}set divPublishComment(e){this._divPublishComment=e}get divComments(){return this._divComments}set divComments(e){this._divComments=e}get publishCommentTextArea(){return this._publishCommentTextArea}set publishCommentTextArea(e){this._publishCommentTextArea=e}get publishCommentButtons(){return this._publishCommentButtons}set publishCommentButtons(e){this._publishCommentButtons=e}get canPublishAComment(){return this._canPublishAComment}set canPublishAComment(e){this._canPublishAComment=e}get comments(){return this._comments}set comments(e){this._comments=e}get commentsTree(){return this._commentsTree}set commentsTree(e){this._commentsTree=e}get domElement(){return this._domElement}set domElement(e){this._domElement=e}getSubclass(){return"showCommentsTabBar"}getName(){return"es.upv.paella.commentsPlugin"}getTabName(){return base.dictionary.translate("Comments")}checkEnabled(e){e(!0)}getIndex(){return 40}getDefaultToolTip(){return base.dictionary.translate("Comments")}action(e){this.loadContent()}buildContent(e){this.domElement=e,this.canPublishAComment=paella.initDelegate.initParams.accessControl.permissions.canWrite,this.loadContent()}loadContent(){this.divRoot=this.domElement,this.divRoot.innerHTML="",this.divPublishComment=document.createElement("div"),this.divPublishComment.className="CommentPlugin_Publish",this.divPublishComment.id="CommentPlugin_Publish",this.divComments=document.createElement("div"),this.divComments.className="CommentPlugin_Comments",this.divComments.id="CommentPlugin_Comments",this.canPublishAComment&&(this.divRoot.appendChild(this.divPublishComment),this.createPublishComment()),this.divRoot.appendChild(this.divComments),this.reloadComments()}createPublishComment(){var e,t,a,i,n=this,r=this.divPublishComment.id+"_entry";(e=document.createElement("div")).id=r,e.className="comments_entry",(t=document.createElement("img")).className="comments_entry_silhouette",t.style.width="48px",t.src=paella.initDelegate.initParams.accessControl.userData.avatar,t.id=r+"_silhouette",e.appendChild(t),(a=document.createElement("div")).className="comments_entry_container",a.id=r+"_textarea_container",e.appendChild(a),this.publishCommentTextArea=document.createElement("textarea"),this.publishCommentTextArea.id=r+"_textarea",this.publishCommentTextArea.onclick=function(){paella.keyManager.enabled=!1},this.publishCommentTextArea.onblur=function(){paella.keyManager.enabled=!0},a.appendChild(this.publishCommentTextArea),this.publishCommentButtons=document.createElement("div"),this.publishCommentButtons.id=r+"_buttons_area",a.appendChild(this.publishCommentButtons),(i=document.createElement("button")).id=r+"_btnAddComment",i.className="publish",i.onclick=function(){""!=n.publishCommentTextArea.value.replace(/\s/g,"")&&n.addComment()},i.innerHTML=base.dictionary.translate("Publish"),this.publishCommentButtons.appendChild(i),a.commentsTextArea=this.publishCommentTextArea,a.commentsBtnAddComment=i,a.commentsBtnAddCommentToInstant=this.btnAddCommentToInstant,this.divPublishComment.appendChild(e)}addComment(){var e=this,t=paella.AntiXSS.htmlEscape(e.publishCommentTextArea.value),a=new Date;this.comments.push({id:base.uuid(),userName:paella.initDelegate.initParams.accessControl.userData.name,mode:"normal",value:t,created:a});var i={allComments:this.comments};paella.data.write("comments",{id:paella.initDelegate.getId()},i,function(t,a){a&&e.loadContent()})}addReply(e,t){var a=this,i=document.getElementById(t),n=paella.AntiXSS.htmlEscape(i.value),r=new Date;paella.keyManager.enabled=!0,this.comments.push({id:base.uuid(),userName:paella.initDelegate.initParams.accessControl.userData.name,mode:"reply",parent:e,value:n,created:r});var s={allComments:this.comments};paella.data.write("comments",{id:paella.initDelegate.getId()},s,function(e,t){t&&a.reloadComments()})}reloadComments(){var e=this;e.commentsTree=[],e.comments=[],this.divComments.innerHTML="",paella.data.read("comments",{id:paella.initDelegate.getId()},function(t,a){var i,n,r;if(t&&"object"==typeof t&&t.allComments&&t.allComments.length>0){e.comments=t.allComments;var s={};for(i=0;i<t.allComments.length;++i)n=t.allComments[i].value,"reply"!==t.allComments[i].mode&&((r={}).id=t.allComments[i].id,r.userName=t.allComments[i].userName,r.mode=t.allComments[i].mode,r.value=n,r.created=t.allComments[i].created,r.replies=[],e.commentsTree.push(r),s[r.id]=e.commentsTree.length-1);for(i=0;i<t.allComments.length;++i)if(n=t.allComments[i].value,"reply"===t.allComments[i].mode){(r={}).id=t.allComments[i].id,r.userName=t.allComments[i].userName,r.mode=t.allComments[i].mode,r.value=n,r.created=t.allComments[i].created;var l=s[t.allComments[i].parent];e.commentsTree[l].replies.push(r)}e.displayComments()}})}displayComments(){for(var e=0;e<this.commentsTree.length;++e){var t=this.commentsTree[e],a=this.createACommentEntry(t);this.divComments.appendChild(a)}}createACommentEntry(e){var t,a,i,n,r=this,s=this.divPublishComment.id+"_entry"+e.id;(t=document.createElement("div")).id=s,t.className="comments_entry",(a=document.createElement("img")).className="comments_entry_silhouette",a.id=s+"_silhouette",t.appendChild(a),(i=document.createElement("div")).className="comments_entry_container",i.id=s+"_comment_container",t.appendChild(i),(n=document.createElement("div")).id=s+"_comment_metadata",i.appendChild(n);var l,o="";if(e.created){var u=new Date,d=paella.utils.timeParse.matterhornTextDateToDate(e.created);o=paella.utils.timeParse.secondsToText((u.getTime()-d.getTime())/1e3)}(l=document.createElement("div")).id=s+"_comment_value",l.className="comments_entry_comment",i.appendChild(l),l.innerHTML=e.value;var c=document.createElement("div");if(c.id=s+"_comment_reply",i.appendChild(c),paella.data.read("userInfo",{username:e.userName},function(e,t){if(e){a.src=e.avatar;var i="<span class='comments_entry_username'>"+e.name+" "+e.lastname+"</span>";i+="<span class='comments_entry_datepublish'>"+o+"</span>",n.innerHTML=i}}),1==this.canPublishAComment){var h=document.createElement("div");h.className="reply_button",h.innerHTML=base.dictionary.translate("Reply"),h.id=s+"_comment_reply_button",h.onclick=function(){var t=r.createAReplyEntry(e.id);this.style.display="none",this.parentElement.parentElement.appendChild(t)},c.appendChild(h)}for(var p=0;p<e.replies.length;++p){var m=r.createACommentReplyEntry(e.id,e.replies[p]);i.appendChild(m)}return t}createACommentReplyEntry(e,t){var a,i,n,r,s=this.divPublishComment.id+"_entry_"+e+"_reply_"+t.id;(a=document.createElement("div")).id=s,a.className="comments_entry",(i=document.createElement("img")).className="comments_entry_silhouette",i.id=s+"_silhouette",a.appendChild(i),(n=document.createElement("div")).className="comments_entry_container",n.id=s+"_comment_container",a.appendChild(n),(r=document.createElement("div")).id=s+"_comment_metadata",n.appendChild(r);var l,o="";if(t.created){var u=new Date,d=paella.utils.timeParse.matterhornTextDateToDate(t.created);o=paella.utils.timeParse.secondsToText((u.getTime()-d.getTime())/1e3)}return(l=document.createElement("div")).id=s+"_comment_value",l.className="comments_entry_comment",n.appendChild(l),l.innerHTML=t.value,paella.data.read("userInfo",{username:t.userName},function(e,t){if(e){i.src=e.avatar;var a="<span class='comments_entry_username'>"+e.name+" "+e.lastname+"</span>";a+="<span class='comments_entry_datepublish'>"+o+"</span>",r.innerHTML=a}}),a}createAReplyEntry(e){var t,a,i,n,r,s=this,l=this.divPublishComment.id+"_entry_"+e+"_reply";return(t=document.createElement("div")).id=l+"_entry",t.className="comments_entry",(a=document.createElement("img")).className="comments_entry_silhouette",a.style.width="48px",a.id=l+"_silhouette",a.src=paella.initDelegate.initParams.accessControl.userData.avatar,t.appendChild(a),(i=document.createElement("div")).className="comments_entry_container comments_reply_container",i.id=l+"_reply_container",t.appendChild(i),(n=document.createElement("textArea")).onclick=function(){paella.keyManager.enabled=!1},n.draggable=!1,n.id=l+"_textarea",i.appendChild(n),this.publishCommentButtons=document.createElement("div"),this.publishCommentButtons.id=l+"_buttons_area",i.appendChild(this.publishCommentButtons),(r=document.createElement("button")).id=l+"_btnAddComment",r.className="publish",r.onclick=function(){""!=n.value.replace(/\s/g,"")&&s.addReply(e,n.id)},r.innerHTML=base.dictionary.translate("Reply"),this.publishCommentButtons.appendChild(r),t}}}),paella.addPlugin(function(){return class extends paella.TabBarPlugin{getSubclass(){return"showDescriptionTabBar"}getName(){return"es.upv.paella.descriptionPlugin"}getTabName(){return"Descripcin"}get domElement(){return this._domElement||null}set domElement(e){this._domElement=e}buildContent(e){this.domElement=e,this.loadContent()}action(e){this.loadContent()}loadContent(){var e=this.domElement;e.innerHTML="Loading...",new paella.Timer(function(t){e.innerHTML="Loading done"},2e3)}}}),paella.addPlugin(function(){return class extends paella.ButtonPlugin{get currentUrl(){return this._currentUrl}set currentUrl(e){this._currentUrl=e}get currentMaster(){return this._currentMaster}set currentMaster(e){this._currentMaster=e}get currentSlave(){return this._currentSlave}set currentSlave(e){this._currentSlave=e}get availableMasters(){return this._availableMasters}set availableMasters(e){this._availableMasters=e}get availableSlaves(){return this._availableSlaves}set availableSlaves(e){this._availableSlaves=e}get showWidthRes(){return this._showWidthRes}set showWidthRes(e){this._showWidthRes=e}getAlignment(){return"right"}getSubclass(){return"extendedTabAdapterPlugin"}getIconClass(){return"icon-folder"}getIndex(){return 2030}getMinWindowSize(){return 550}getName(){return"es.upv.paella.extendedTabAdapterPlugin"}getDefaultToolTip(){return base.dictionary.translate("Extended Tab Adapter")}getButtonType(){return paella.ButtonPlugin.type.popUpButton}buildContent(e){e.appendChild(paella.extendedAdapter.bottomContainer)}}}),paella.addPlugin(function(){return class extends paella.ButtonPlugin{get INTERVAL_LENGTH(){return this._INTERVAL_LENGTH}set INTERVAL_LENGTH(e){this._INTERVAL_LENGTH=e}get inPosition(){return this._inPosition}set inPosition(e){this._inPosition=e}get outPosition(){return this._outPosition}set outPosition(e){this._outPosition=e}get canvas(){return this._canvas}set canvas(e){this._canvas=e}get footPrintsTimer(){return this._footPrintsTimer}set footPrintsTimer(e){this._footPrintsTimer=e}get footPrintsData(){return this._footPrintsData}set footPrintsData(e){this._footPrintsData=e}getAlignment(){return"right"}getSubclass(){return"footPrints"}getIconClass(){return"icon-stats"}getIndex(){return 590}getDefaultToolTip(){return base.dictionary.translate("Show statistics")}getName(){return"es.upv.paella.footprintsPlugin"}getButtonType(){return paella.ButtonPlugin.type.timeLineButton}setup(){var e=this;switch(paella.events.bind(paella.events.timeUpdate,function(t){e.onTimeUpdate()}),this.config.skin){case"custom":this.fillStyle=this.config.fillStyle,this.strokeStyle=this.config.strokeStyle;break;case"dark":this.fillStyle="#727272",this.strokeStyle="#424242";break;case"light":default:this.fillStyle="#d8d8d8",this.strokeStyle="#ffffff"}}checkEnabled(e){e(!paella.player.isLiveStream())}buildContent(e){var t=document.createElement("div");t.className="footPrintsContainer",this.canvas=document.createElement("canvas"),this.canvas.id="footPrintsCanvas",this.canvas.className="footPrintsCanvas",t.appendChild(this.canvas),e.appendChild(t)}onTimeUpdate(){var e=this;paella.player.videoContainer.currentTime().then(function(t){var a=Math.round(t+paella.player.videoContainer.trimStart());e.inPosition<=a&&a<=e.inPosition+e.INTERVAL_LENGTH?(e.outPosition=a,e.inPosition+e.INTERVAL_LENGTH===e.outPosition&&(e.trackFootPrint(e.inPosition,e.outPosition),e.inPosition=e.outPosition)):(e.trackFootPrint(e.inPosition,e.outPosition),e.inPosition=a,e.outPosition=a)})}trackFootPrint(e,t){var a={in:e,out:t};paella.data.write("footprints",{id:paella.initDelegate.getId()},a)}willShowContent(){var e=this;this.loadFootprints(),this.footPrintsTimer=new base.Timer(function(t){e.loadFootprints()},5e3),this.footPrintsTimer.repeat=!0}didHideContent(){null!=this.footPrintsTimer&&(this.footPrintsTimer.cancel(),this.footPrintsTimer=null)}loadFootprints(){var e=this;paella.data.read("footprints",{id:paella.initDelegate.getId()},function(t,a){var i={};paella.player.videoContainer.duration().then(function(a){for(var n=Math.floor(paella.player.videoContainer.trimStart()),r=-1,s=0,l=0;l<t.length;l++){var o=t[l].position-n;if(o<a){var u=t[l].views;if(o-1!=r)for(var d=r+1;d<o;d++)i[d]=s;i[o]=u,r=o,s=u}}e.drawFootPrints(i)})})}drawFootPrints(e){if(this.canvas){var t,a=Object.keys(e).length,i=this.canvas.getContext("2d"),n=20;for(t=0;t<a;++t)e[t]>n&&(n=e[t]);for(this.canvas.setAttribute("width",a),this.canvas.setAttribute("height",n),i.clearRect(0,0,this.canvas.width,this.canvas.height),i.fillStyle=this.fillStyle,i.strokeStyle=this.strokeStyle,i.lineWidth=2,i.webkitImageSmoothingEnabled=!1,i.mozImageSmoothingEnabled=!1,t=0;t<a-1;++t)i.beginPath(),i.moveTo(t,n),i.lineTo(t,n-e[t]),i.lineTo(t+1,n-e[t+1]),i.lineTo(t+1,n),i.closePath(),i.fill(),i.beginPath(),i.moveTo(t,n-e[t]),i.lineTo(t+1,n-e[t+1]),i.closePath(),i.stroke()}}}}),paella.addPlugin(function(){return class extends paella.SearchServicePlugIn{getName(){return"es.upv.paella.frameCaptionsSearchPlugin"}search(e,t){let a=RegExp(e,"i"),i=[];for(var n in paella.player.videoLoader.frameList){var r=paella.player.videoLoader.frameList[n];"object"==typeof r&&a.test(r.caption)&&i.push({time:n,content:r.caption,score:0})}t&&t(!1,i)}}}),paella.addPlugin(function(){return class extends paella.ButtonPlugin{get frames(){return this._frames}set frames(e){this._frames=e}get highResFrames(){return this._highResFrames}set highResFrames(e){this._highResFrames=e}get currentFrame(){return this._currentFrame}set currentFrame(e){this._currentFrame=e}get navButtons(){return this._navButtons}set navButtons(e){this._navButtons=e}get buttons(){return this._buttons||(this._buttons=[]),this._buttons}set buttons(e){this._buttons=e}get contx(){return this._contx}set contx(e){this._contx=e}getAlignment(){return"right"}getSubclass(){return"frameControl"}getIconClass(){return"icon-photo"}getIndex(){return 510}getMinWindowSize(){return 450}getName(){return"es.upv.paella.frameControlPlugin"}getButtonType(){return paella.ButtonPlugin.type.timeLineButton}getDefaultToolTip(){return base.dictionary.translate("Navigate by slides")}checkEnabled(e){this._img=null,this._searchTimer=null,this._searchTimerTime=250,null==paella.initDelegate.initParams.videoLoader.frameList?e(!1):0===paella.initDelegate.initParams.videoLoader.frameList.length?e(!1):0==Object.keys(paella.initDelegate.initParams.videoLoader.frameList).length?e(!1):e(!0)}setup(){this._showFullPreview=this.config.showFullPreview||"auto";var e,t=this,a=1,i=0,n=-1,r=13,s=27,l=37,o=39;$(this.button).keyup(function(u){var d=Math.floor(t.contx.offsetWidth/100),c=t.buttons.length%d,h=Math.floor(t.buttons.length/d);t.isPopUpOpen()&&(u.keyCode==l?n>0&&(t.buttons[n].className=e,n--,a>h&&(i=d-c),n==d*(a-1)-1-i&&0!=n&&(t.navButtons.left.scrollContainer.scrollLeft-=105*d,--a),this.hiResFrame&&t.removeHiResFrame(),base.userAgent.browser.IsMobileVersion||t.buttons[n].frameControl.onMouseOver(null,t.buttons[n].frameData),e=t.buttons[n].className,t.buttons[n].className="frameControlItem selected"):u.keyCode==o?n<t.buttons.length-1&&(n>=0&&(t.buttons[n].className=e),n++,1==a&&(i=0),n==d*a-i&&(t.navButtons.left.scrollContainer.scrollLeft+=105*d,++a),this.hiResFrame&&t.removeHiResFrame(),base.userAgent.browser.IsMobileVersion||t.buttons[n].frameControl.onMouseOver(null,t.buttons[n].frameData),e=t.buttons[n].className,t.buttons[n].className="frameControlItem selected"):u.keyCode==r?(t.buttons[n].frameControl.onClick(null,t.buttons[n].frameData),e="frameControlItem current"):u.keyCode==s&&t.removeHiResFrame())})}buildContent(e){var t=this;this.frames=[];var a=document.createElement("div");a.className="frameControlContainer",t.contx=a;var i=document.createElement("div");i.className="frameControlContent",this.navButtons={left:document.createElement("div"),right:document.createElement("div")},this.navButtons.left.className="frameControl navButton left",this.navButtons.right.className="frameControl navButton right";var n=this.getFrame(null);e.appendChild(this.navButtons.left),e.appendChild(a),a.appendChild(i),e.appendChild(this.navButtons.right),this.navButtons.left.scrollContainer=a,$(this.navButtons.left).click(function(e){this.scrollContainer.scrollLeft-=100}),this.navButtons.right.scrollContainer=a,$(this.navButtons.right).click(function(e){this.scrollContainer.scrollLeft+=100}),i.appendChild(n);var r=$(n).outerWidth(!0);i.innerHTML="",$(window).mousemove(function(e){($(i).offset().top>e.pageY||!$(i).is(":visible")||$(i).offset().top+$(i).height()<e.pageY)&&t.removeHiResFrame()});var s,l=paella.initDelegate.initParams.videoLoader.frameList;if(l){var o=Object.keys(l);s=o.length,o.map(function(e){return Number(e,10)}).sort(function(e,t){return e-t}).forEach(function(e){var a=t.getFrame(l[e]);i.appendChild(a,"frameContrlItem_"+s),t.frames.push(a)})}$(i).css({width:s*r+"px"}),paella.events.bind(paella.events.setTrim,(e,t)=>{this.updateFrameVisibility(t.trimEnabled,t.trimStart,t.trimEnd)}),paella.player.videoContainer.trimming().then(e=>{this.updateFrameVisibility(e.enabled,e.start,e.end)}),paella.events.bind(paella.events.timeupdate,(e,t)=>this.onTimeUpdate(t.currentTime))}showHiResFrame(e,t){var a=document.createElement("div"),i=document.createElement("div"),n=document.createElement("img");this._img=n,n.className="frameHiRes",n.setAttribute("src",e),n.setAttribute("style","width: 100%;"),$(i).append(n),$(a).append(i),a.setAttribute("style","display: table;"),i.setAttribute("style","display: table-cell; vertical-align:middle;");var r=document.createElement("p");r.className="frameCaption",r.innerHTML=t||"",a.append(r),this._caption=r;let s=paella.player.videoContainer.overlayContainer;switch(this._showFullPreview){case"auto":1==(l=paella.initDelegate.initParams.videoLoader.streams).length?s.addElement(a,s.getMasterRect()):l.length>=2&&s.addElement(a,s.getSlaveRect()),s.enableBackgroundMode(),this.hiResFrame=a;break;case"master":s.addElement(a,s.getMasterRect()),s.enableBackgroundMode(),this.hiResFrame=a;break;case"slave":var l;(l=paella.initDelegate.initParams.videoLoader.streams).length>=2&&(s.addElement(a,s.getSlaveRect()),s.enableBackgroundMode(),this.hiResFrame=a)}}removeHiResFrame(){var e=paella.player.videoContainer.overlayContainer;this.hiResFrame&&e.removeElement(this.hiResFrame),e.disableBackgroundMode(),this._img=null}updateFrameVisibility(e,t,a){var i;if(e)for(i=0;i<this.frames.length;++i){var n=this.frames[i],r=n.frameData;r.time<t?this.frames.length>i+1&&this.frames[i+1].frameData.time>t?$(n).show():$(n).hide():r.time>a?$(n).hide():$(n).show()}else for(i=0;i<this.frames.length;++i)$(this.frames[i]).show()}getFrame(e,t){var a=document.createElement("div");if(a.className="frameControlItem",t&&(a.id=t),e){this.buttons.push(a),a.frameData=e,a.frameControl=this;var i=e.thumb?e.thumb:e.url,n=paella.utils.timeParse.secondsToTime(e.time);a.innerHTML='<img src="'+i+'" alt="" class="frameControlImage" title="'+n+'" aria-label="'+n+'"></img>',base.userAgent.browser.IsMobileVersion||$(a).mouseover(function(e){this.frameControl.onMouseOver(e,this.frameData)}),$(a).mouseout(function(e){this.frameControl.onMouseOut(e,this.frameData)}),$(a).click(function(e){this.frameControl.onClick(e,this.frameData)})}return a}onMouseOver(e,t){var a=paella.initDelegate.initParams.videoLoader.frameList[t.time];if(a){var i=a.url;this._img?(this._img.setAttribute("src",i),this._caption.innerHTML=a.caption||""):this.showHiResFrame(i,a.caption)}null!=this._searchTimer&&clearTimeout(this._searchTimer)}onMouseOut(e,t){this._searchTimer=setTimeout(e=>this.removeHiResFrame(),this._searchTimerTime)}onClick(e,t){paella.player.videoContainer.trimming().then(e=>{let a=e.enabled?t.time-e.start:t.time;a>0?paella.player.videoContainer.seekToTime(a+1):paella.player.videoContainer.seekToTime(0)})}onTimeUpdate(e){for(var t=null,a=0;a<this.frames.length&&(this.frames[a].frameData&&this.frames[a].frameData.time<=e);++a)t=this.frames[a];this.currentFrame!=t&&t&&(this.currentFrame&&(this.currentFrame.className="frameControlItem"),this.currentFrame=t,this.currentFrame.className="frameControlItem current")}}}),paella.addPlugin(function(){return class extends paella.ButtonPlugin{getIndex(){return 551}getAlignment(){return"right"}getSubclass(){return"showFullScreenButton"}getIconClass(){return"icon-fullscreen"}getName(){return"es.upv.paella.fullScreenButtonPlugin"}checkEnabled(e){this._reload=null,e(paella.player.checkFullScreenCapability())}getDefaultToolTip(){return base.dictionary.translate("Go Fullscreen")}setup(){this._reload=!!this.config.reloadOnFullscreen&&this.config.reloadOnFullscreen.enabled,this._keepUserQuality=!this.config.reloadOnFullscreen||this.config.reloadOnFullscreen.keepUserSelection,paella.events.bind(paella.events.enterFullscreen,e=>this.onEnterFullscreen()),paella.events.bind(paella.events.exitFullscreen,e=>this.onExitFullscreen())}action(e){if(paella.player.isFullScreen())paella.player.exitFullScreen();else{if((!paella.player.checkFullScreenCapability()||base.userAgent.browser.Explorer)&&window.location!==window.parent.location){var t=window.location.href;return paella.player.pause(),void paella.player.videoContainer.currentTime().then(e=>{var a=this.secondsToHours(e);window.open(t+"&time="+a.h+"h"+a.m+"m"+a.s+"s&autoplay=true")})}paella.player.goFullScreen()}paella.player.config.player.reloadOnFullscreen&&!paella.utils.userAgent.system.iOS&&setTimeout(()=>{this._reload&&paella.player.videoContainer.setQuality(null).then(()=>{})},1e3)}secondsToHours(e){var t=Math.floor(e/3600),a=Math.floor((e-3600*t)/60),i=Math.floor(e-3600*t-60*a),n={};return t<10&&(t="0"+t),a<10&&(a="0"+a),i<10&&(i="0"+i),n.h=t,n.m=a,n.s=i,n}onEnterFullscreen(){this.setToolTip(base.dictionary.translate("Exit Fullscreen")),this.button.className=this.getButtonItemClass(!0),this.changeIconClass("icon-windowed")}onExitFullscreen(){this.setToolTip(base.dictionary.translate("Go Fullscreen")),this.button.className=this.getButtonItemClass(!1),this.changeIconClass("icon-fullscreen"),setTimeout(()=>{paella.player.onresize()},100)}getButtonItemClass(e){return"buttonPlugin "+this.getAlignment()+" "+this.getSubclass()+(e?" active":"")}}}),paella.addPlugin(function(){return class extends paella.ButtonPlugin{getIndex(){return 509}getAlignment(){return"right"}getSubclass(){return"helpButton"}getIconClass(){return"icon-help"}getName(){return"es.upv.paella.helpPlugin"}getMinWindowSize(){return 650}getDefaultToolTip(){return base.dictionary.translate("Show help")+" ("+base.dictionary.translate("Paella version:")+" "+paella.version+")"}checkEnabled(e){e((this.config&&this.config.langs||[]).length>0)}action(e){var t=base.dictionary.currentLanguage(),a=this.config&&this.config.langs||[],i=a.indexOf(t);i<0&&(i=0);let n="resources/style/help/help_"+a[i]+".html";base.userAgent.browser.IsMobileVersion?window.open(n):paella.messageBox.showFrame(n)}}}),Class("paella.HLSPlayer",paella.Html5Video,{initialize:function(e,t,a,i,n,r){this.parent(e,t,a,i,n,r,"hls")},_loadDeps:function(){return new Promise((e,t)=>{window.$paella_hls?e(window.$paella_hls):require(["resources/deps/hls.min.js"],function(t){window.$paella_hls=t,e(window.$paella_hls)})})},allowZoom:function(){return!0},load:function(){if(this._posterFrame&&this.video.setAttribute("poster",this._posterFrame),base.userAgent.system.iOS||base.userAgent.browser.Safari)return this.parent();{let e=this;return new Promise((t,a)=>{var i=this._stream.sources.hls;i&&i.length>0?(i=i[0],this._loadDeps().then(function(a){a.isSupported()&&(e._hls=new a,e._hls.loadSource(i.src),e._hls.attachMedia(e.video),e._hls.on(a.Events.LEVEL_SWITCHED,function(t,a){e.qualityIndex=a.level,e.setQuality(a.level)}),e._hls.on(a.Events.ERROR,function(t,i){if(i.fatal)switch(i.type){case a.ErrorTypes.NETWORK_ERROR:base.log.error("paella.HLSPlayer: Fatal network error encountered, try to recover"),e._hls.startLoad();break;case a.ErrorTypes.MEDIA_ERROR:base.log.error("paella.HLSPlayer: Fatal media error encountered, try to recover"),e._hls.recoverMediaError();break;default:base.log.error("paella.HLSPlayer: Fatal Error. Can not recover"),e._hls.destroy()}}),e._hls.on(a.Events.MANIFEST_PARSED,function(){e._deferredAction(function(){t()})}))})):a(new Error("Invalid source"))})}},getQualities:function(){if(base.userAgent.system.iOS||base.userAgent.browser.Safari)return new Promise((e,t)=>{e([{index:0,res:"",src:"",toString:function(){return"auto"},shortLabel:function(){return"auto"},compare:function(e){return 0}}])});{let e=this;return new Promise(t=>{this._qualities||(e._qualities=[],e._hls.levels.forEach(function(t,a){e._qualities.push(e._getQualityObject(a,{index:a,res:{w:t.width,h:t.height},bitrate:t.bitrate}))})),t(e._qualities)})}},printQualityes:function(){return new Promise((e,t)=>{this.getCurrentQuality().then(e=>this.getNextQuality()).then(t=>{e()})})},setQuality:function(e){if(base.userAgent.system.iOS||base.userAgent.browser.Safari)return Promise.resolve();if(null!==e){try{this.qualityIndex=e,this._hls.nextLevel=e}catch(e){}return Promise.resolve()}return Promise.resolve()},getNextQuality:function(){return new Promise((e,t)=>{let a=this._hls.nextLevel;e(this._qualities[a])})},getCurrentQuality:function(){return base.userAgent.system.iOS||base.userAgent.browser.Safari?Promise.resolve(0):(this.getNextQuality(),new Promise((e,t)=>{let a=void 0==this.qualityIndex?this._hls.currentLevel:this.qualityIndex;e(this._qualities[a])}))}}),Class("paella.videoFactories.HLSVideoFactory",{isStreamCompatible:function(e){void 0===paella.videoFactories.HLSVideoFactory.s_instances&&(paella.videoFactories.HLSVideoFactory.s_instances=0);try{if(paella.videoFactories.HLSVideoFactory.s_instances>0&&base.userAgent.system.iOS)return!1;for(var t in e.sources)if("hls"==t)return!0}catch(e){}return!1},getVideoObject:function(e,t,a){return++paella.videoFactories.HLSVideoFactory.s_instances,new paella.HLSPlayer(e,t,a.x,a.y,a.w,a.h)}}),paella.addPlugin(function(){return class extends paella.VideoOverlayButtonPlugin{isEditorVisible(){return null!=paella.editor.instance}getIndex(){return 10}getSubclass(){return"liveIndicator"}getAlignment(){return"right"}getDefaultToolTip(){return base.dictionary.translate("This video is a live stream")}getName(){return"es.upv.paella.liveStreamingIndicatorPlugin"}checkEnabled(e){e(paella.player.isLiveStream())}setup(){}action(e){paella.messageBox.showMessage(base.dictionary.translate("Live streaming mode: This is a live video, so, some capabilities of the player are disabled"))}}}),Class("paella.MpegDashVideo",paella.Html5Video,{_posterFrame:null,_player:null,initialize:function(e,t,a,i,n,r){this.parent(e,t,a,i,n,r)},_loadDeps:function(){return new Promise((e,t)=>{window.$paella_mpd?e(window.$paella_mpd):require(["resources/deps/dash.all.js"],function(){window.$paella_mpd=!0,e(window.$paella_mpd)})})},_getQualityObject:function(e,t,a){var i=a.length,n=Math.round(100*t/i),r=0==t?"min":t==i-1?"max":n+"%";return{index:t,res:{w:null,h:null},bitrate:e.bitrate,src:null,toString:function(){return n},shortLabel:function(){return r},compare:function(e){return this.bitrate-e.bitrate}}},load:function(){let e=this;return new Promise((t,a)=>{var i=this._stream.sources.mpd;i&&i.length>0?(i=i[0],this._loadDeps().then(function(){var a=dashjs.MediaPlayer().create();a.initialize(e.video,i.src,!0),a.getDebug().setLogToBrowserConsole(!1),e._player=a,a.on(dashjs.MediaPlayer.events.STREAM_INITIALIZED,function(i,n){a.getBitrateInfoListFor("video");e._deferredAction(function(){e._firstPlay||(e._player.pause(),e._firstPlay=!0),t()})})})):a(new Error("Invalid source"))})},supportAutoplay:function(){return!0},getQualities:function(){return new Promise(e=>{this._deferredAction(()=>{this._qualities||(this._qualities=[],this._player.getBitrateInfoListFor("video").sort((e,t)=>e.bitrate-t.bitrate).forEach((e,t,a)=>{this._qualities.push(this._getQualityObject(e,t,a))}),this.autoQualityIndex=this._qualities.length,this._qualities.push({index:this.autoQualityIndex,res:{w:null,h:null},bitrate:-1,src:null,toString:function(){return"auto"},shortLabel:function(){return"auto"},compare:function(e){return this.bitrate-e.bitrate}})),e(this._qualities)})})},setQuality:function(e){return new Promise((t,a)=>{let i=this._player.getQualityFor("video");e==this.autoQualityIndex?(this._player.setAutoSwitchQuality(!0),t()):e!=i?(this._player.setAutoSwitchQuality(!1),this._player.off(dashjs.MediaPlayer.events.METRIC_CHANGED),this._player.on(dashjs.MediaPlayer.events.METRIC_CHANGED,(e,a)=>{"metricchanged"==e.type&&i!=this._player.getQualityFor("video")&&(i=this._player.getQualityFor("video"),t())}),this._player.setQualityFor("video",e)):t()})},getCurrentQuality:function(){return new Promise((e,t)=>{if(this._player.getAutoSwitchQuality())e({index:this.autoQualityIndex,res:{w:null,h:null},bitrate:-1,src:null,toString:function(){return"auto"},shortLabel:function(){return"auto"},compare:function(e){return this.bitrate-e.bitrate}});else{var a=this._player.getQualityFor("video");e(this._getQualityObject(this._qualities[a],a,this._player.getBitrateInfoListFor("video")))}})},unFreeze:function(){return paella_DeferredNotImplemented()},freeze:function(){return paella_DeferredNotImplemented()},unload:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()}}),Class("paella.videoFactories.MpegDashVideoFactory",{isStreamCompatible:function(e){try{if(base.userAgent.system.iOS)return!1;for(var t in e.sources)if("mpd"==t)return!0}catch(e){}return!1},getVideoObject:function(e,t,a){return++paella.videoFactories.Html5VideoFactory.s_instances,new paella.MpegDashVideo(e,t,a.x,a.y,a.w,a.h)}}),paella.addPlugin(function(){return class extends paella.ButtonPlugin{getAlignment(){return"right"}getSubclass(){return"showMultipleQualitiesPlugin"}getIconClass(){return"icon-screen"}getIndex(){return 2030}getMinWindowSize(){return 550}getName(){return"es.upv.paella.multipleQualitiesPlugin"}getDefaultToolTip(){return base.dictionary.translate("Change video quality")}closeOnMouseOut(){return!0}checkEnabled(e){this._available=[],paella.player.videoContainer.getQualities().then(t=>{this._available=t,e(t.length>1)})}setup(){this.setQualityLabel(),paella.events.bind(paella.events.qualityChanged,e=>this.setQualityLabel())}getButtonType(){return paella.ButtonPlugin.type.popUpButton}buildContent(e){this._available.forEach(t=>{t.shortLabel();e.appendChild(this.getItemButton(t))})}getItemButton(e){var t=document.createElement("div");return paella.player.videoContainer.getCurrentQuality().then((a,i)=>{var n=e.shortLabel();t.className=this.getButtonItemClass(n,e.index==a),t.id=n,t.innerHTML=n,t.data=e,$(t).click(function(e){$(".multipleQualityItem").removeClass("selected"),$(".multipleQualityItem."+this.data.toString()).addClass("selected"),paella.player.videoContainer.setQuality(this.data.index).then(function(){paella.player.controls.hidePopUp(this.getName()),this.setQualityLabel()})})}),t}setQualityLabel(){paella.player.videoContainer.getCurrentQuality().then(e=>{this.setText(e.shortLabel())})}getButtonItemClass(e,t){return"multipleQualityItem "+e+(t?" selected":"")}}}),paella.addPlugin(function(){return class extends paella.ButtonPlugin{getIndex(){return 551}getAlignment(){return"right"}getSubclass(){return"PIPModeButton"}getIconClass(){return"icon-pip"}getName(){return"es.upv.paella.pipModePlugin"}checkEnabled(e){var t=paella.player.videoContainer.masterVideo().video;t&&t.webkitSetPresentationMode?e(!0):e(!1)}getDefaultToolTip(){return base.dictionary.translate("Set picture-in-picture mode.")}setup(){}action(e){var t=paella.player.videoContainer.masterVideo().video;"picture-in-picture"==t.webkitPresentationMode?t.webkitSetPresentationMode("inline"):t.webkitSetPresentationMode("picture-in-picture")}}}),paella.addPlugin(function(){return class extends paella.ButtonPlugin{constructor(){super(),this.playIconClass="icon-play",this.pauseIconClass="icon-pause",this.playSubclass="playButton",this.pauseSubclass="pauseButton"}getAlignment(){return"left"}getSubclass(){return this.playSubclass}getIconClass(){return this.playIconClass}getName(){return"es.upv.paella.playPauseButtonPlugin"}getDefaultToolTip(){return base.dictionary.translate("Play")}getIndex(){return 110}checkEnabled(e){e(!0)}setup(){paella.player.playing()&&this.changeIconClass(this.playIconClass),paella.events.bind(paella.events.play,e=>{this.changeIconClass(this.pauseIconClass),this.changeSubclass(this.pauseSubclass),this.setToolTip(paella.dictionary.translate("Pause"))}),paella.events.bind(paella.events.pause,e=>{this.changeIconClass(this.playIconClass),this.changeSubclass(this.playSubclass),this.setToolTip(paella.dictionary.translate("Play"))})}action(e){paella.player.videoContainer.paused().then(function(e){e?paella.player.play():paella.player.pause()})}}}),paella.addPlugin(function(){return class extends paella.EventDrivenPlugin{constructor(){super(),this.containerId="paella_plugin_PlayButtonOnScreen",this.container=null,this.enabled=!0,this.isPlaying=!1,this.showIcon=!0,this.firstPlay=!1}checkEnabled(e){e(!paella.player.isLiveStream()||base.userAgent.system.Android||base.userAgent.system.iOS||!paella.player.videoContainer.supportAutoplay())}getIndex(){return 1010}getName(){return"es.upv.paella.playButtonOnScreenPlugin"}setup(){var e=this;this.container=document.createElement("div"),this.container.className="playButtonOnScreen",this.container.id=this.containerId,this.container.style.width="100%",this.container.style.height="100%",paella.player.videoContainer.domElement.appendChild(this.container),$(this.container).click(function(t){e.onPlayButtonClick()});var t=document.createElement("canvas");function a(){var a=jQuery(e.container).innerWidth(),i=jQuery(e.container).innerHeight();t.width=a,t.height=i;var n=a<i?a/3:i/3,r=t.getContext("2d");r.translate((a-n)/2,(i-n)/2),r.beginPath(),r.arc(n/2,n/2,n/2,0,2*Math.PI,!0),r.closePath(),r.strokeStyle="white",r.lineWidth=10,r.stroke(),r.fillStyle="#8f8f8f",r.fill(),r.beginPath(),r.moveTo(n/3,n/4),r.lineTo(3*n/4,n/2),r.lineTo(n/3,3*n/4),r.lineTo(n/3,n/4),r.closePath(),r.fillStyle="white",r.fill(),r.stroke()}t.className="playButtonOnScreenIcon",this.container.appendChild(t),paella.events.bind(paella.events.resize,a),a()}getEvents(){return[paella.events.endVideo,paella.events.play,paella.events.pause,paella.events.showEditor,paella.events.hideEditor]}onEvent(e,t){switch(e){case paella.events.endVideo:this.endVideo();break;case paella.events.play:this.play();break;case paella.events.pause:this.pause();break;case paella.events.showEditor:this.showEditor();break;case paella.events.hideEditor:this.hideEditor()}}onPlayButtonClick(){this.firstPlay=!0,this.checkStatus()}endVideo(){this.isPlaying=!1,this.checkStatus()}play(){this.isPlaying=!0,this.showIcon=!1,this.checkStatus()}pause(){this.isPlaying=!1,this.showIcon=!1,this.checkStatus()}showEditor(){this.enabled=!1,this.checkStatus()}hideEditor(){this.enabled=!0,this.checkStatus()}checkStatus(){this.enabled&&this.isPlaying||!this.enabled||!this.showIcon?$(this.container).hide():$(this.container).show()}}}),paella.addPlugin(function(){return class extends paella.ButtonPlugin{getAlignment(){return"left"}getSubclass(){return"showPlaybackRateButton"}getIconClass(){return"icon-screen"}getIndex(){return 140}getMinWindowSize(){return 500}getName(){return"es.upv.paella.playbackRatePlugin"}getButtonType(){return paella.ButtonPlugin.type.popUpButton}getDefaultToolTip(){return base.dictionary.translate("Set playback rate")}checkEnabled(e){this.buttonItems=null,this.buttons=[],this.selected_button=null,this.defaultRate=null,this._domElement=null,this.available_rates=null,e(!base.userAgent.browser.IsMobileVersion&&null!=dynamic_cast("paella.Html5Video",paella.player.videoContainer.masterVideo()))}closeOnMouseOut(){return!0}setup(){this.defaultRate=1,this.available_rates=this.config.availableRates||[.75,1,1.25,1.5]}buildContent(e){this._domElement=e,this.buttonItems={},this.available_rates.forEach(t=>{e.appendChild(this.getItemButton(t+"x",t))})}getItemButton(e,t){var a=document.createElement("div");return a.className=1==t?this.getButtonItemClass(e,!0):this.getButtonItemClass(e,!1),a.id=e+"_button",a.innerHTML=e,a.data={label:e,rate:t,plugin:this},$(a).click(function(e){this.data.plugin.onItemClick(this,this.data.label,this.data.rate)}),a}onItemClick(e,t,a){paella.player.videoContainer.setPlaybackRate(a),this.setText(t),paella.player.controls.hidePopUp(this.getName());for(var i=this._domElement.children,n=0;n<i.length;n++)i[n].className=this.getButtonItemClass(n,!1);e.className=this.getButtonItemClass(n,!0)}getText(){return"1x"}getProfileItemButton(e,t){var a=document.createElement("div");return a.className=this.getButtonItemClass(e,!1),a.id=e+"_button",a.data={profile:e,profileData:t,plugin:this},$(a).click(function(e){this.data.plugin.onItemClick(this,this.data.profile,this.data.profileData)}),a}getButtonItemClass(e,t){return"playbackRateItem "+e+(t?" selected":"")}}}),paella.addPlugin(function(){return class extends paella.ButtonPlugin{getAlignment(){return"right"}getSubclass(){return"rateButtonPlugin"}getIconClass(){return"icon-star"}getIndex(){return 540}getMinWindowSize(){return 500}getName(){return"es.upv.paella.ratePlugin"}getButtonType(){return paella.ButtonPlugin.type.popUpButton}getDefaultToolTip(){return base.dictionary.translate("Rate this video")}checkEnabled(e){this.buttonItems=null,this.buttons=[],this.selected_button=null,this.score=0,this.count=0,this.myScore=0,this.canVote=!1,this.scoreContainer={header:null,rateButtons:null},paella.data.read("rate",{id:paella.initDelegate.getId()},(t,a)=>{t&&"object"==typeof t&&(this.score=Number(t.mean).toFixed(1),this.count=t.count,this.myScore=t.myScore,this.canVote=t.canVote),e(a)})}setup(){}setScore(e){this.score=e,this.updateScore()}closeOnMouseOut(){return!0}updateHeader(){let e=base.dictionary.translate("Not rated");this.count>0&&(e='<i class="glyphicon glyphicon-star"></i>',e+=` ${this.score} ${this.count} ${base.dictionary.translate("votes")}`),this.scoreContainer.header.innerHTML=`\n\t\t\t<div>\n\t\t\t\t<h4>${base.dictionary.translate("Video score")}:</h4>\n\t\t\t\t<h5>\n\t\t\t\t\t${e}\n\t\t\t\t</h5>\n\t\t\t\t</h4>\n\t\t\t\t<h4>${base.dictionary.translate("Vote:")}</h4>\n\t\t\t</div>\n\t\t\t`}updateRateButtons(){if(this.scoreContainer.rateButtons.className="rateButtons",this.buttons=[],this.canVote){this.scoreContainer.rateButtons.innerHTML="";for(let e=0;e<5;++e){let t=this.getStarButton(e+1);this.buttons.push(t),this.scoreContainer.rateButtons.appendChild(t)}}else this.scoreContainer.rateButtons.innerHTML=`<h5>${base.dictionary.translate("Login to vote")}</h5>`;this.updateVote()}buildContent(e){this._domElement=e;var t=document.createElement("div");e.appendChild(t),t.className="rateContainerHeader",this.scoreContainer.header=t,this.updateHeader();var a=document.createElement("div");this.scoreContainer.rateButtons=a,e.appendChild(a),this.updateRateButtons()}getStarButton(e){let t=this,a=document.createElement("i");return a.data={score:e,active:!1},a.className="starButton glyphicon glyphicon-star-empty",$(a).click(function(e){t.vote(this.data.score)}),a}vote(e){this.myScore=e;let t={mean:this.score,count:this.count,myScore:e,canVote:this.canVote};paella.data.write("rate",{id:paella.initDelegate.getId()},t,e=>{paella.data.read("rate",{id:paella.initDelegate.getId()},(e,t)=>{e&&"object"==typeof e&&(this.score=Number(e.mean).toFixed(1),this.count=e.count,this.myScore=e.myScore,this.canVote=e.canVote),this.updateHeader(),this.updateRateButtons()})})}updateVote(){this.buttons.forEach((e,t)=>{e.className=t<this.myScore?"starButton glyphicon glyphicon-star":"starButton glyphicon glyphicon-star-empty"})}}}),Class("paella.RTMPVideo",paella.VideoElementBase,{_posterFrame:null,_currentQuality:null,_duration:0,_paused:!0,_streamName:null,_flashId:null,_swfContainer:null,_flashVideo:null,_volume:1,initialize:function(e,t,a,i,n,r){this.parent(e,t,"div",a,i,n,r),this._flashId=e+"Movie",this._streamName="rtmp";var s=this;this._stream.sources.rtmp.sort(function(e,t){return e.res.h-t.res.h});var l=function(e,t){t=t.split(",");for(var a={},i=0;i<t.length;++i){var n=t[i].split(":"),r=n[0],l=n[1];"NaN"==l?l=NaN:/^true$/i.test(l)?l=!0:/^false$/i.test(l)?l=!1:isNaN(parseFloat(l))||(l=parseFloat(l)),a[r]=l}!function(e,t){if("loadedmetadata"==e||"pause"==e||s._isReady||(s._isReady=!0,s._duration=t.duration,$(s.swfContainer).trigger("paella:flashvideoready")),"progress"==e){try{s.flashVideo.setVolume(s._volume)}catch(e){}base.log.debug("Flash video event: "+e+", progress: "+s.flashVideo.currentProgress())}else"ended"==e?(base.log.debug("Flash video event: "+e),paella.events.trigger(paella.events.pause),paella.player.controls.showControls()):base.log.debug("Flash video event: "+e)}(e,a)};paella.events.bind(paella.events.flashVideoEvent,function(e,t){s.flashId==t.source&&l(t.eventName,t.values)}),Object.defineProperty(this,"swfContainer",{get:function(){return s._swfContainer}}),Object.defineProperty(this,"flashId",{get:function(){return s._flashId}}),Object.defineProperty(this,"flashVideo",{get:function(){return s._flashVideo}})},_createSwfObject:function(e,t){var a=this.identifier,i=document.createElement("div");if(this.domElement.appendChild(i),i.id=a+"Movie",this._swfContainer=i,swfobject.hasFlashPlayerVersion("9.0.0"))swfobject.embedSWF(e,i.id,"100%","100%","9.0.0","",t,{wmode:"transparent"},null,function(e){if(0==e.success){var t=document.createElement("div"),a=document.createElement("h3");a.innerHTML=base.dictionary.translate("Flash player problem");var i=document.createElement("div");i.innerHTML=base.dictionary.translate("A problem occurred trying to load flash player.")+"<br>"+base.dictionary.translate("Please go to {0} and install it.").replace("{0}","<a style='color: #800000; text-decoration: underline;' href='http://www.adobe.com/go/getflash'>http://www.adobe.com/go/getflash</a>")+"<br>"+base.dictionary.translate("If the problem presist, contact us.");var n=document.createElement("a");n.setAttribute("href","http://www.adobe.com/go/getflash"),n.innerHTML='<img style="margin:5px;" src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" alt="Obtener Adobe Flash Player" />',t.appendChild(a),t.appendChild(i),t.appendChild(n),paella.messageBox.showError(t.innerHTML)}});else{var n=document.createElement("div"),r=document.createElement("h3");r.innerHTML=base.dictionary.translate("Flash player needed");var s=document.createElement("div");s.innerHTML=base.dictionary.translate("You need at least Flash player 9 installed.")+"<br>"+base.dictionary.translate("Please go to {0} and install it.").replace("{0}","<a style='color: #800000; text-decoration: underline;' href='http://www.adobe.com/go/getflash'>http://www.adobe.com/go/getflash</a>");var l=document.createElement("a");l.setAttribute("href","http://www.adobe.com/go/getflash"),l.innerHTML='<img style="margin:5px;" src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" alt="Obtener Adobe Flash Player" />',n.appendChild(r),n.appendChild(s),n.appendChild(l),paella.messageBox.showError(n.innerHTML)}return $("#"+i.id)[0]},_deferredAction:function(e){return new Promise((t,a)=>{this.ready?t(e()):$(this.swfContainer).bind("paella:flashvideoready",()=>{this._ready=!0,t(e())})})},_getQualityObject:function(e,t){return{index:e,res:t.res,src:t.src,toString:function(){return this.res.w+"x"+this.res.h},shortLabel:function(){return this.res.h+"p"},compare:function(e){return this.res.w*this.res.h-e.res.w*e.res.h}}},getVideoData:function(){let e=this;return new Promise((t,a)=>{this._deferredAction(()=>{let a={duration:e.flashVideo.duration(),currentTime:e.flashVideo.getCurrentTime(),volume:e.flashVideo.getVolume(),paused:e._paused,ended:e._ended,res:{w:e.flashVideo.getWidth(),h:e.flashVideo.getHeight()}};t(a)})})},setPosterFrame:function(e){if(null==this._posterFrame){this._posterFrame=e;var t=document.createElement("img");t.src=e,t.className="videoPosterFrameImage",t.alt="poster frame",this.domElement.appendChild(t),this._posterFrameElement=t}},setAutoplay:function(e){this._autoplay=e},load:function(){var e=this._stream.sources.rtmp;null===this._currentQuality&&this._videoQualityStrategy&&(this._currentQuality=this._videoQualityStrategy.getQualityIndex(e));var t=this._currentQuality<e.length?e[this._currentQuality]:null;if(t){if(function(e){return e.src&&"object"==typeof e.src&&e.src.server&&e.src.stream}(t)){var a=!1;void 0===t.src.requiresSubscription&&paella.player.config.player.rtmpSettings?a=paella.player.config.player.rtmpSettings.requiresSubscription||!1:t.src.requiresSubscription&&(a=t.src.requiresSubscription);var i={};return this._autoplay&&(i.autoplay=this._autoplay),"true"==base.parameters.get("debug")&&(i.debugMode=!0),i.playerId=this.flashId,i.isLiveStream=void 0!==t.isLiveStream&&t.isLiveStream,i.server=t.src.server,i.stream=t.src.stream,i.subscribe=a,paella.player.config.player.rtmpSettings&&void 0!==paella.player.config.player.rtmpSettings.bufferTime&&(i.bufferTime=paella.player.config.player.rtmpSettings.bufferTime),this._flashVideo=this._createSwfObject("resources/deps/player_streaming.swf",i),$(this.swfContainer).trigger("paella:flashvideoready"),this._deferredAction(function(){return t})}return paella_DeferredRejected(new Error("Invalid video data"))}return paella_DeferredRejected(new Error("Could not load video: invalid quality stream index"))},getQualities:function(){return new Promise((e,t)=>{setTimeout(()=>{var t=[],a=-1;this._stream.sources.rtmp.forEach(e=>{a++,t.push(this._getQualityObject(a,e))}),e(t)},50)})},setQuality:function(e){return e=void 0!==e&&null!==e?e:0,new Promise((t,a)=>{this._paused;var i=this._stream.sources.rtmp;this._currentQuality=e<i.length?e:0;i[e];this._ready=!1,this._isReady=!1,this.load().then(function(){t()})})},getCurrentQuality:function(){return new Promise((e,t)=>{e(this._getQualityObject(this._currentQuality,this._stream.sources.rtmp[this._currentQuality]))})},play:function(){var e=this;return this._deferredAction(function(){e._posterFrameElement&&(e._posterFrameElement.parentNode.removeChild(e._posterFrameElement),e._posterFrameElement=null),e._paused=!1,e.flashVideo.play()})},pause:function(){var e=this;return this._deferredAction(function(){e._paused=!0,e.flashVideo.pause()})},isPaused:function(){var e=this;return this._deferredAction(function(){return e._paused})},duration:function(){var e=this;return this._deferredAction(function(){return e.flashVideo.duration()})},setCurrentTime:function(e){var t=this;return this._deferredAction(function(){var a=t.flashVideo.duration();t.flashVideo.seekTo(100*e/a)})},currentTime:function(){var e=this;return this._deferredAction(function(){return e.flashVideo.getCurrentTime()})},setVolume:function(e){var t=this;return this._volume=e,this._deferredAction(function(){t.flashVideo.setVolume(e)})},volume:function(){var e=this;return this._deferredAction(function(){return e.flashVideo.getVolume()})},setPlaybackRate:function(e){var t=this;return this._deferredAction(function(){t._playbackRate=e})},playbackRate:function(){var e=this;return this._deferredAction(function(){return e._playbackRate})},goFullScreen:function(){return paella_DeferredNotImplemented()},unFreeze:function(){return this._deferredAction(function(){})},freeze:function(){return this._deferredAction(function(){})},unload:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()},getDimensions:function(){return paella_DeferredNotImplemented()}}),Class("paella.videoFactories.RTMPVideoFactory",{isStreamCompatible:function(e){try{if(base.userAgent.system.iOS||base.userAgent.system.Android)return!1;for(var t in e.sources)if("rtmp"==t)return!0}catch(e){}return!1},getVideoObject:function(e,t,a){return new paella.RTMPVideo(e,t,a.x,a.y,a.w,a.h)}}),paella.addPlugin(function(){return class extends paella.SearchServicePlugIn{getName(){return"es.upv.paella.search.captionsSearchPlugin"}search(e,t){paella.captions.search(e,t)}}}),paella.addPlugin(function(){return class extends paella.ButtonPlugin{getAlignment(){return"right"}getSubclass(){return"searchButton"}getIconClass(){return"icon-binoculars"}getMinWindowSize(){return 550}getName(){return"es.upv.paella.searchPlugin"}getButtonType(){return paella.ButtonPlugin.type.popUpButton}getDefaultToolTip(){return base.dictionary.translate("Search")}getIndex(){return 510}closeOnMouseOut(){return!0}checkEnabled(e){this._open=!1,this._sortDefault="time",this._colorSearch=!1,this._localImages=null,this._searchTimer=null,this._searchTimerTime=1500,this._searchBody=null,e(!0)}setup(){var e=this;$(".searchButton").click(function(t){e._open?e._open=!1:(e._open=!0,setTimeout(function(){$("#searchBarInput").focus()},0))}),e._localImages=paella.initDelegate.initParams.videoLoader.frameList,e._colorSearch=e.config.colorSearch||!1,e._sortDefault=e.config.sortType||"time",paella.events.bind(paella.events.controlBarWillHide,function(t){e._open&&paella.player.controls.cancelHideBar()})}prettyTime(e){var t=Math.floor(e/3600)%24;t=("00"+t).slice(t.toString().length);var a=Math.floor(e/60)%60;a=("00"+a).slice(a.toString().length);var i=Math.floor(e%60);return t+":"+a+":"+(i=("00"+i).slice(i.toString().length))}search(e,t){paella.searchService.search(e,t)}getPreviewImage(e){var t=Object.keys(this._localImages);t.push(e),t.sort(function(e,t){return parseInt(e)-parseInt(t)});var a=t.indexOf(e)-1,i=t[a=a>0?a:0];return i=parseInt(i),this._localImages[i].url}createLoadingElement(e){var t=document.createElement("div");t.className="loader";t.innerHTML='<svg version="1.1" id="loader-1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="40px" height="40px" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50;" xml:space="preserve"><path fill="#000" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z"><animateTransform attributeType="xml"attributeName="transform"type="rotate"from="0 25 25"to="360 25 25"dur="0.6s"repeatCount="indefinite"/></path></svg>',e.appendChild(t);var a=document.createElement("p");a.className="sBodyText",a.innerHTML=base.dictionary.translate("Searching")+"...",e.appendChild(a)}createNotResultsFound(e){var t=document.createElement("div");t.className="noResults",t.innerHTML=base.dictionary.translate("Sorry! No results found."),e.appendChild(t)}doSearch(e,t){var a=this;$(t).empty(),a.createLoadingElement(t),a.search(e,function(e,i){if($(t).empty(),!e)if(0==i.length)a.createNotResultsFound(t);else for(var n=0;n<i.length;n++){"score"==a._sortDefault&&i.sort(function(e,t){return t.score-e.score}),"time"==a._sortDefault&&i.sort(function(e,t){return e.time-t.time});var r=document.createElement("div");r.className="sBodyInnerContainer",a._colorSearch&&(i[n].score<=.3&&$(r).addClass("redScore"),i[n].score>=.7&&$(r).addClass("greenScore"));var s=document.createElement("div");s.className="TimePicContainer";var l=document.createElement("img");l.className="sBodyPicture",l.src=a.getPreviewImage(i[n].time);var o=document.createElement("p");o.className="sBodyText",o.innerHTML="<span class='timeSpan'>"+a.prettyTime(i[n].time)+"</span>"+i[n].content,s.appendChild(l),r.appendChild(s),r.appendChild(o),t.appendChild(r),r.setAttribute("sec",i[n].time),$(r).hover(function(){$(this).css("background-color","#faa166")},function(){$(this).removeAttr("style")}),$(r).click(function(){var e=$(this).attr("sec");paella.player.videoContainer.seekToTime(e),paella.player.play()})}})}buildContent(e){var t=this,a=document.createElement("div");a.className="searchPluginContainer";var i=document.createElement("div");i.className="searchBody",a.appendChild(i),t._searchBody=i;var n=document.createElement("div");n.className="searchBar",a.appendChild(n);var r=document.createElement("input");r.className="searchBarInput",r.type="text",r.id="searchBarInput",r.name="searchString",r.placeholder=base.dictionary.translate("Search"),n.appendChild(r),$(r).change(function(){var e=$(r).val();null!=t._searchTimer&&t._searchTimer.cancel(),""!=e&&t.doSearch(e,i)}),$(r).keyup(function(e){if(13!=e.keyCode){var a=$(r).val();null!=t._searchTimer&&t._searchTimer.cancel(),""!=a?t._searchTimer=new base.Timer(function(e){t.doSearch(a,i)},t._searchTimerTime):$(t._searchBody).empty()}}),$(r).focus(function(){paella.keyManager.enabled=!1}),$(r).focusout(function(){paella.keyManager.enabled=!0}),e.appendChild(a)}}}),paella.addPlugin(function(){return class extends paella.ButtonPlugin{getAlignment(){return"right"}getSubclass(){return"showSocialPluginButton"}getIconClass(){return"icon-social"}getIndex(){return 560}getMinWindowSize(){return 600}getName(){return"es.upv.paella.socialPlugin"}checkEnabled(e){e(!0)}getDefaultToolTip(){return base.dictionary.translate("Share this video")}getButtonType(){return paella.ButtonPlugin.type.popUpButton}closeOnMouseOut(){return!0}setup(){if(this.buttonItems=null,this.socialMedia=null,this.buttons=[],this.selected_button=null,"es"==base.dictionary.currentLanguage()){base.dictionary.addDictionary({"Custom size:":"Tamao personalizado:","Choose your embed size. Copy the text and paste it in your html page.":"Elija el tamao del video a embeber. Copie el texto y pguelo en su pgina html.","Width:":"Ancho:","Height:":"Alto:"})}var e=this,t=13,a=38,i=40;$(this.button).keyup(function(n){e.isPopUpOpen()&&(n.keyCode==a?e.selected_button>0&&(e.selected_button<e.buttons.length&&(e.buttons[e.selected_button].className="socialItemButton "+e.buttons[e.selected_button].data.mediaData),e.selected_button--,e.buttons[e.selected_button].className=e.buttons[e.selected_button].className+" selected"):n.keyCode==i?e.selected_button<e.buttons.length-1&&(e.selected_button>=0&&(e.buttons[e.selected_button].className="socialItemButton "+e.buttons[e.selected_button].data.mediaData),e.selected_button++,e.buttons[e.selected_button].className=e.buttons[e.selected_button].className+" selected"):n.keyCode==t&&e.onItemClick(e.buttons[e.selected_button].data.mediaData))})}buildContent(e){this.buttonItems={},this.socialMedia=["facebook","twitter","embed"],this.socialMedia.forEach(t=>{var a=this.getSocialMediaItemButton(t);this.buttonItems[this.socialMedia.indexOf(t)]=a,e.appendChild(a),this.buttons.push(a)}),this.selected_button=this.buttons.length}getSocialMediaItemButton(e){var t=document.createElement("div");return t.className="socialItemButton "+e,t.id=e+"_button",t.data={mediaData:e,plugin:this},$(t).click(function(e){this.data.plugin.onItemClick(this.data.mediaData)}),t}onItemClick(e){var t=this.getVideoUrl();switch(e){case"twitter":window.open("http://twitter.com/home?status="+t);break;case"facebook":window.open("http://www.facebook.com/sharer.php?u="+t);break;case"embed":this.embedPress()}paella.player.controls.hidePopUp(this.getName())}getVideoUrl(){return document.location.href}embedPress(){var e=document.location.protocol+"//"+document.location.host,t=document.location.pathname.split("/");t.length>0&&(t[t.length-1]="embed.html");var a=paella.initDelegate.getId(),i=e+t.join("/")+"?id="+a,n="<div id='embedContent' style='text-align:left; font-size:14px; color:black;'><div id=''>"+("<div style='display:inline-block;'>     <div class='embedSizeButton' style='width:110px; height:73px;'> <span style='display:flex; align-items:center; justify-content:center; width:100%; height:100%;'> 620x349 </span></div>    <div class='embedSizeButton' style='width:100px; height:65px;'> <span style='display:flex; align-items:center; justify-content:center; width:100%; height:100%;'> 540x304 </span></div>    <div class='embedSizeButton' style='width:90px;  height:58px;'> <span style='display:flex; align-items:center; justify-content:center; width:100%; height:100%;'> 460x259 </span></div>    <div class='embedSizeButton' style='width:80px;  height:50px;'> <span style='display:flex; align-items:center; justify-content:center; width:100%; height:100%;'> 380x214 </span></div>    <div class='embedSizeButton' style='width:70px;  height:42px;'> <span style='display:flex; align-items:center; justify-content:center; width:100%; height:100%;'> 300x169 </span></div></div><div style='display:inline-block; vertical-align:bottom; margin-left:10px;'>    <div>"+base.dictionary.translate("Custom size:")+"</div>    <div>"+base.dictionary.translate("Width:")+" <input id='social_embed_width-input' class='embedSizeInput' maxlength='4' type='text' name='Costum width min 300px' alt='Costum width min 300px' title='Costum width min 300px' value=''></div>    <div>"+base.dictionary.translate("Height:")+" <input id='social_embed_height-input' class='embedSizeInput' maxlength='4' type='text' name='Costum width min 300px' alt='Costum width min 300px' title='Costum width min 300px' value=''></div></div>")+"</div> <div id=''>"+base.dictionary.translate("Choose your embed size. Copy the text and paste it in your html page.")+"</div> <div id=''><textarea id='social_embed-textarea' class='social_embed-textarea' rows='4' cols='1' style='font-size:12px; width:95%; overflow:auto; margin-top:5px; color:black;'></textarea></div>  </div>";paella.messageBox.showMessage(n,{closeButton:!0,width:"750px",height:"210px",onClose(){}});var r=$("#social_embed_width-input")[0],s=$("#social_embed_height-input")[0];r.onkeyup=function(e){var t=parseInt(r.value),a=parseInt(s.value);isNaN(t)?r.value="":t<300?$("#social_embed-textarea")[0].value="Embed width too low. The minimum value is a width of 300.":(isNaN(a)&&(a=(t/(16/9)).toFixed(),s.value=a),$("#social_embed-textarea")[0].value='<iframe allowfullscreen src="'+i+'" style="border:0px #FFFFFF none;" name="Paella Player" scrolling="no" frameborder="0" marginheight="0px" marginwidth="0px" width="'+t+'" height="'+a+'"></iframe>')};for(var l=$(".embedSizeButton"),o=0;o<l.length;o+=1){l[o].onclick=function(e){var t=e.target?e.target.textContent:e.toElement.textContent;if(t){var a=t.trim().split("x");r.value=a[0],s.value=a[1],$("#social_embed-textarea")[0].value='<iframe allowfullscreen src="'+i+'" style="border:0px #FFFFFF none;" name="Paella Player" scrolling="no" frameborder="0" marginheight="0px" marginwidth="0px" width="'+a[0]+'" height="'+a[1]+'"></iframe>'}}}}}}),paella.addPlugin(function(){return class extends paella.EventDrivenPlugin{getName(){return"es.upv.paella.test.videoLoadPlugin"}checkEnabled(e){if(this.startTime=0,this.endTime=0,this.startTime=Date.now(),"es"==base.dictionary.currentLanguage()){base.dictionary.addDictionary({"Video loaded in {0} seconds":"Video cargado en {0} segundos"})}e(!0)}getEvents(){return[paella.events.loadComplete]}onEvent(e,t){switch(e){case paella.events.loadComplete:this.onLoadComplete()}}onLoadComplete(){this.endTime=Date.now();var e=(this.endTime-this.startTime)/1e3;this.showOverlayMessage(base.dictionary.translate("Video loaded in {0} seconds").replace(/\{0\}/g,e))}showOverlayMessage(e){var t=paella.player.videoContainer.overlayContainer,a=document.createElement("div");a.className="videoLoadTestOverlay";var i=document.createElement("div");i.className="btn",i.innerHTML="X",i.onclick=function(){t.removeElement(a)};var n=document.createElement("div");n.className="videoLoadTest",n.innerHTML=e,n.appendChild(i),a.appendChild(n),t.addElement(a,{left:40,top:50,width:430,height:80})}}}),paella.addPlugin(function(){return class extends paella.ButtonPlugin{getAlignment(){return"right"}getSubclass(){return"themeChooserPlugin"}getIconClass(){return"icon-paintbrush"}getIndex(){return 2030}getMinWindowSize(){return 600}getName(){return"es.upv.paella.themeChooserPlugin"}getDefaultToolTip(){return base.dictionary.translate("Change theme")}getButtonType(){return paella.ButtonPlugin.type.popUpButton}checkEnabled(e){this.currentUrl=null,this.currentMaster=null,this.currentSlave=null,this.availableMasters=[],this.availableSlaves=[],paella.player.config.skin&&paella.player.config.skin.available&&paella.player.config.skin.available instanceof Array&&paella.player.config.skin.available.length>0?e(!0):e(!1)}buildContent(e){var t=this;paella.player.config.skin.available.forEach(function(a){var i=document.createElement("div");i.className="themebutton",i.innerHTML=a.replace("-"," ").replace("_"," "),$(i).click(function(e){paella.utils.skin.set(a),paella.player.controls.hidePopUp(t.getName())}),e.appendChild(i)})}}}),paella.addDataDelegate("cameraTrack",()=>(class extends paella.DataDelegate{read(e,t,a){let i=paella.player.videoLoader.getVideoUrl();i?(i+="trackhd.json",paella.utils.ajax.get({url:i},e=>{if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}e.positions.sort((e,t)=>e.time-t.time),a(e)},()=>a(null))):a(null)}write(e,t,a,i){}remove(e,t,a){}})),(()=>{let e=null;function t(e,t){let a=t?1e3*(t.time-e.time):100;a>2e3&&(a=2e3);let i=this._videoData.originalWidth/this._videoData.width,n=e&&e.rect||[0,0],r=n[0]/this._videoData.originalWidth,s=(n[1]+this._videoData.originalHeight/2)/this._videoData.originalHeight;paella.player.videoContainer.masterVideo().setZoom(100*i,r*i*100,100*(s*i-1),a)}paella.addPlugin(function(){return class extends paella.EventDrivenPlugin{constructor(){super(),e=this,this._videoData={},this._trackData=[],this._enabled=!0}checkEnabled(e){paella.data.read("cameraTrack",{id:paella.initDelegate.getId()},t=>{t?(this._videoData.width=t.width,this._videoData.height=t.height,this._videoData.originalWidth=t.originalWidth,this._videoData.originalHeight=t.originalHeight,this._trackData=t.positions,this._enabled=!0):this._enabled=!1,e(this._enabled)})}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._enabled&&t.apply(this,[this._lastPosition])}getName(){return"es.upv.paella.track4kPlugin"}getEvents(){return[paella.events.timeupdate,paella.events.play,paella.events.seekToTime]}onEvent(e,t){this._trackData.length&&(e==paella.events.play||(e==paella.events.timeupdate?this.updateZoom(t.currentTime):e==paella.events.seekToTime&&this.seekTo(t.newPosition)))}updateZoom(e){let a=function(e){let t=null;return e=Math.round(e),this._trackData.some((a,i)=>(a.time==e&&(t=a),null!=t)),t}.apply(this,[e]),i=function(e){let t=-1;return e=Math.round(e),this._trackData.some((a,i)=>(a.time>=e&&(t=i),-1!=t)),this._trackData.length>t+1?this._trackData[t+1]:null}.apply(this,[e]);a&&this._lastPosition!=a&&this._enabled&&(this._lastPosition=a,t.apply(this,[a,i]))}seekTo(e){let a=function(e){let t=this._trackData[0];return e=Math.round(e),this._trackData.some((a,i)=>a.time==e||(t=a,!1)),t}.apply(this,[e]);a&&this._enabled&&(this._lastPosition=a,t.apply(this,[a]))}}}),paella.addPlugin(function(){return class extends paella.ButtonPlugin{getAlignment(){return"right"}getSubclass(){return"videoZoomToolbar"}getIconClass(){return"icon-screen"}closeOnMouseOut(){return!0}getIndex(){return 2030}getMinWindowSize(){return paella.player.config.player&&paella.player.config.player.videoZoom&&paella.player.config.player.videoZoom.minWindowSize||600}getName(){return"es.upv.paella.videoZoomTrack4kPlugin"}getDefaultToolTip(){return base.dictionary.translate("Set video zoom")}getButtonType(){return paella.ButtonPlugin.type.popUpButton}checkEnabled(t){paella.player.videoContainer.videoPlayers().then(a=>{let i=paella.player.config.plugins.list[this.getName()],n=i.targetStreamIndex,r=i.autoModeByDefault;this.targetPlayer=a.length>n?a[n]:null,e.enabled=r,t(paella.player.config.player.videoZoom.enabled&&this.targetPlayer&&this.targetPlayer.allowZoom())})}buildContent(t){let a=()=>{e.enabled?this.changeIconClass("icon-mini-videocamera"):this.changeIconClass("icon-mini-zoom-in")};function i(e,t,a){let i=document.createElement("div");return i.className=`videoZoomToolbarItem ${e}`,i.innerHTML=a||`<i class="glyphicon glyphicon-${e}"></i>`,$(i).click(t),i}paella.events.bind(paella.events.videoZoomChanged,(e,t)=>{a()}),a(),t.appendChild(i("zoom-in",e=>{this.zoomIn()})),t.appendChild(i("zoom-out",e=>{this.zoomOut()})),t.appendChild(i("zoom-auto",e=>{this.zoomAuto(),paella.player.controls.hidePopUp(this.getName())},"auto"))}zoomIn(){e.enabled=!1,this.targetPlayer.zoomIn()}zoomOut(){e.enabled=!1,this.targetPlayer.zoomOut()}zoomAuto(){e.enabled=!0}}})})(),paella.plugins.translectures={},Class("paella.captions.translectures.Caption",paella.captions.Caption,{initialize:function(e,t,a,i,n,r){this.parent(e,t,a,i,r),this._captionsProvider="translecturesCaptionsProvider",this._editURL=n},canEdit:function(e){e(!1,void 0!=this._editURL&&""!=this._editURL)},goToEdit:function(){var e=this;paella.player.auth.userData().then(function(t){1==t.isAnonymous?e.askForAnonymousOrLoginEdit():e.doEdit()})},doEdit:function(){window.location.href=this._editURL},doLoginAndEdit:function(){paella.player.auth.login(this._editURL)},askForAnonymousOrLoginEdit:function(){var e=this,t=document.createElement("div");t.className="translecturesCaptionsMessageBox";var a=document.createElement("div");a.className="title",a.innerHTML=base.dictionary.translate("You are trying to modify the transcriptions, but you are not Logged in!"),t.appendChild(a);var i=document.createElement("div");i.className="authMethodsContainer",t.appendChild(i);var n=document.createElement("div");n.className="authMethod",i.appendChild(n);var r=document.createElement("a");r.href="#",r.style.color="#004488",n.appendChild(r);var s=document.createElement("img");s.src="resources/style/caption_mlangs_anonymous.png",s.alt="Anonymous",s.style.height="100px",r.appendChild(s);var l=document.createElement("p");l.innerHTML=base.dictionary.translate("Continue editing the transcriptions anonymously"),r.appendChild(l),$(r).click(function(){e.doEdit()}),(n=document.createElement("div")).className="authMethod",i.appendChild(n),(r=document.createElement("a")).href="#",r.style.color="#004488",n.appendChild(r),(s=document.createElement("img")).src="resources/style/caption_mlangs_lock.png",s.alt="Login",s.style.height="100px",r.appendChild(s),(l=document.createElement("p")).innerHTML=base.dictionary.translate("Log in and edit the transcriptions"),r.appendChild(l),$(r).click(function(){e.doLoginAndEdit()}),paella.messageBox.showElement(t)}}),Class("paella.plugins.translectures.CaptionsPlugIn",paella.EventDrivenPlugin,{getName:function(){return"es.upv.paella.translecture.captionsPlugin"},getEvents:function(){return[]},onEvent:function(e,t){},checkEnabled:function(e){var t=this,a=paella.player.videoIdentifier;if(void 0==this.config.tLServer||void 0==this.config.tLdb)base.log.warning(this.getName()+" plugin not configured!"),e(!1);else{var i=(this.config.tLServer+"/langs?db=${tLdb}&id=${videoId}").replace(/\$\{videoId\}/gi,a).replace(/\$\{tLdb\}/gi,this.config.tLdb);base.ajax.get({url:i},function(n,r,s,l){0==n.scode?(n.langs.forEach(function(e){var i,n=(t.config.tLServer+"/dfxp?format=1&pol=0&db=${tLdb}&id=${videoId}&lang=${tl.lang.code}").replace(/\$\{videoId\}/gi,a).replace(/\$\{tLdb\}/gi,t.config.tLdb).replace(/\$\{tl.lang.code\}/gi,e.code);t.config.tLEdit&&(i=t.config.tLEdit.replace(/\$\{videoId\}/gi,a).replace(/\$\{tLdb\}/gi,t.config.tLdb).replace(/\$\{tl.lang.code\}/gi,e.code));var r=e.value;switch(e.type){case 0:r+=" ("+paella.dictionary.translate("Auto")+")";break;case 1:r+=" ("+paella.dictionary.translate("Under review")+")"}var s=new paella.captions.translectures.Caption(e.code,"dfxp",n,{code:e.code,txt:r},i);paella.captions.addCaptions(s)}),e(!1)):(base.log.debug("Error getting available captions from translectures: "+i),e(!1))},function(t,a,n){base.log.debug("Error getting available captions from translectures: "+i),e(!1)})}}}),new paella.plugins.translectures.CaptionsPlugIn,paella.addPlugin(function(){return class extends paella.userTracking.SaverPlugIn{getName(){return"es.upv.paella.usertracking.elasticsearchSaverPlugin"}checkEnabled(e){this.type="userTrackingSaverPlugIn",this._url=this.config.url,this._index=this.config.index||"paellaplayer",this._type=this.config.type||"usertracking";var t=!0;void 0==this._url&&(t=!1,base.log.debug("No ElasticSearch URL found in config file. Disabling ElasticSearch PlugIn")),e(t)}log(e,t){var a=t;"object"!=typeof a&&(a={value:a}),paella.player.videoContainer.currentTime().then(function(t){var i={date:new Date,video:paella.initDelegate.getId(),playing:!paella.player.videoContainer.paused(),time:parseInt(t+paella.player.videoContainer.trimStart()),event:e,params:a};paella.ajax.post({url:this._url+"/"+this._index+"/"+this._type+"/",params:JSON.stringify(i)})})}}}),paella.addPlugin(function(){return class extends paella.userTracking.SaverPlugIn{getName(){return"es.upv.paella.usertracking.GoogleAnalyticsSaverPlugin"}checkEnabled(e){var t,a,i,n,r,s,l=this.config.trackingID,o=this.config.domain||"auto";l?(base.log.debug("Google Analitycs Enabled"),t=window,a=document,i="script",n="__gaTracker",t.GoogleAnalyticsObject=n,t[n]=t[n]||function(){(t[n].q=t[n].q||[]).push(arguments)},t[n].l=1*new Date,r=a.createElement(i),s=a.getElementsByTagName(i)[0],r.async=1,r.src="//www.google-analytics.com/analytics.js",s.parentNode.insertBefore(r,s),__gaTracker("create",l,o),__gaTracker("send","pageview"),e(!0)):(base.log.debug("No Google Tracking ID found in config file. Disabling Google Analitycs PlugIn"),e(!1))}log(e,t){if(void 0===this.config.category||!0===this.config.category){var a=this.config.category||"PaellaPlayer",i=e,n="";try{n=JSON.stringify(t)}catch(e){}__gaTracker("send","event",a,i,n)}}}});var _paq=_paq||[];function buildVideo360Canvas(e,t){let a=new class extends bg.app.WindowController{constructor(e){super(),this.stream=e}get video(){return this.texture?this.texture.video:null}loaded(){return new Promise(e=>{let t=()=>{this.video?e(this):setTimeout(t,100)};t()})}buildScene(){this._root=new bg.scene.Node(this.gl,"Root node"),bg.base.Loader.RegisterPlugin(new bg.base.TextureLoaderPlugin),bg.base.Loader.RegisterPlugin(new bg.base.VideoTextureLoaderPlugin),bg.base.Loader.RegisterPlugin(new bg.base.VWGLBLoaderPlugin),bg.base.Loader.Load(this.gl,this.stream.src).then(e=>{this.texture=e;let t=bg.scene.PrimitiveFactory.Sphere(this.gl,1,50),a=new bg.scene.Node(this.gl);a.addComponent(t),t.getMaterial(0).texture=e,t.getMaterial(0).lightEmission=1,t.getMaterial(0).lightEmissionMaskInvert=!0,t.getMaterial(0).cullFace=!1,this._root.addChild(a),this.postRedisplay()});let e=new bg.scene.Node(this.gl,"Light");this._root.addChild(e),this._camera=new bg.scene.Camera;let t=new bg.scene.Node("Camera");t.addComponent(this._camera),t.addComponent(new bg.scene.Transform);let a=new bg.manipulation.OrbitCameraController;t.addComponent(a),a.maxPitch=90,a.minPitch=-90,a.maxDistance=0,a.minDistace=0,this._root.addChild(t)}init(){bg.Engine.Set(new bg.webgl1.Engine(this.gl)),this.buildScene(),this._renderer=bg.render.Renderer.Create(this.gl,bg.render.RenderPath.FORWARD),this._inputVisitor=new bg.scene.InputVisitor}frame(e){this.texture&&this.texture.update(),this._renderer.frame(this._root,e)}display(){this._renderer.display(this._root,this._camera)}reshape(e,t){this._camera.viewport=new bg.Viewport(0,0,e,t),this._camera.projection.perspective(60,this._camera.viewport.aspectRatio,.1,100)}mouseDown(e){this._inputVisitor.mouseDown(this._root,e)}mouseDrag(e){this._inputVisitor.mouseDrag(this._root,e),this.postRedisplay()}mouseWheel(e){this._inputVisitor.mouseWheel(this._root,e),this.postRedisplay()}touchStart(e){this._inputVisitor.touchStart(this._root,e)}touchMove(e){this._inputVisitor.touchMove(this._root,e),this.postRedisplay()}mouseUp(e){this._inputVisitor.mouseUp(this._root,e)}mouseMove(e){this._inputVisitor.mouseMove(this._root,e)}mouseOut(e){this._inputVisitor.mouseOut(this._root,e)}touchEnd(e){this._inputVisitor.touchEnd(this._root,e)}}(e),i=bg.app.MainLoop.singleton;return i.updateMode=bg.app.FrameUpdate.AUTO,i.canvas=t,i.run(a),a.loaded()}function buildVideo360ThetaCanvas(e,t){function a(e,t,a){const i=(n=((e+90)/180-1)*Math.PI,r=(.5-t/180)*Math.PI,new bg.Vector3(Math.cos(r)*Math.cos(n),Math.cos(r)*Math.sin(n),Math.sin(r)));var n,r;const s=function(e,t,a){let i=a;return a<-1?i=-1:a>1&&(i=1),new bg.Vector2(Math.atan2(t,e),Math.acos(i)/Math.PI)}(Math.sin(-.5*Math.PI)*i.z+Math.cos(-.5*Math.PI)*i.x,i.y,Math.cos(-.5*Math.PI)*i.z-Math.sin(-.5*Math.PI)*i.x),l=0===a?.883*s.y*Math.cos(s.x)*.5+.25:.883*(1-s.y)*Math.cos(-1*s.x+Math.PI)*.5+.75,o=0===a?.784888888888881*s.y*Math.sin(s.x)+.55555555555556:.784888888888881*(1-s.y)*Math.sin(-1*s.x+Math.PI)+.55555555555556;return new bg.Vector2(l,o)}let i=new class extends bg.app.WindowController{constructor(e){super(),this.stream=e}get video(){return this.texture?this.texture.video:null}loaded(){return new Promise(e=>{let t=()=>{this.video?e(this):setTimeout(t,100)};t()})}buildScene(){this._root=new bg.scene.Node(this.gl,"Root node"),bg.base.Loader.RegisterPlugin(new bg.base.TextureLoaderPlugin),bg.base.Loader.RegisterPlugin(new bg.base.VideoTextureLoaderPlugin),bg.base.Loader.RegisterPlugin(new bg.base.VWGLBLoaderPlugin),bg.base.Loader.Load(this.gl,this.stream.src).then(e=>{this.texture=e;let t=function(e){let t=new bg.scene.Node(e),i=new bg.scene.Drawable;t.addComponent(i);let n=new bg.base.PolyList(e),r=[],s=[],l=[];for(let e=0;e<=180;e+=5){for(let t=0;t<=360;t+=5)r.push(new bg.Vector3(Math.sin(Math.PI*e/180)*Math.sin(Math.PI*t/180)*1,1*Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)*Math.cos(Math.PI*t/180)*1)),s.push(new bg.Vector3(0,0,-1));for(let t=0;t<=180;t+=5)l.push(a(t,e,0));for(let t=180;t<=360;t+=5)l.push(a(t,e,1))}function o(e,t,a,i,r,s,l,o,u){n.vertex.push(e.x),n.vertex.push(e.y),n.vertex.push(e.z),n.vertex.push(t.x),n.vertex.push(t.y),n.vertex.push(t.z),n.vertex.push(a.x),n.vertex.push(a.y),n.vertex.push(a.z),n.normal.push(i.x),n.normal.push(i.y),n.normal.push(i.z),n.normal.push(r.x),n.normal.push(r.y),n.normal.push(r.z),n.normal.push(s.x),n.normal.push(s.z),n.normal.push(s.z),n.texCoord0.push(l.x),n.texCoord0.push(l.y),n.texCoord0.push(o.x),n.texCoord0.push(o.y),n.texCoord0.push(u.x),n.texCoord0.push(u.y),n.index.push(n.index.length),n.index.push(n.index.length),n.index.push(n.index.length)}for(let e=0;e<36;e++)for(let t=0;t<72;t++){const a=73*e+t,i=t<36?74*e+t:74*e+t+1;l[i+0],l[i+1],l[i+74],l[i+1],l[i+75],l[i+74];let n=r[a+0],u=s[a+0],d=l[i+0],c=r[a+1],h=s[a+1],p=l[i+1],m=r[a+73],g=s[a+73],v=l[i+74],f=r[a+74],y=s[a+74],b=l[i+75];o(n,c,m,u,h,g,d,p,v),o(c,f,m,h,y,g,p,b,v)}n.build(),i.addPolyList(n);let u=bg.Matrix4.Scale(-1,1,1);return t.addComponent(new bg.scene.Transform(u)),t}(this.gl),i=t.component("bg.scene.Drawable");i.getMaterial(0).texture=e,i.getMaterial(0).lightEmission=1,i.getMaterial(0).lightEmissionMaskInvert=!0,i.getMaterial(0).cullFace=!1,this._root.addChild(t),this.postRedisplay()});let e=new bg.scene.Node(this.gl,"Light");this._root.addChild(e),this._camera=new bg.scene.Camera;let t=new bg.scene.Node("Camera");t.addComponent(this._camera),t.addComponent(new bg.scene.Transform);let i=new bg.manipulation.OrbitCameraController;t.addComponent(i),i.maxPitch=90,i.minPitch=-90,i.maxDistance=0,i.minDistace=0,this._root.addChild(t)}init(){bg.Engine.Set(new bg.webgl1.Engine(this.gl)),this.buildScene(),this._renderer=bg.render.Renderer.Create(this.gl,bg.render.RenderPath.FORWARD),this._inputVisitor=new bg.scene.InputVisitor}frame(e){this.texture&&this.texture.update(),this._renderer.frame(this._root,e)}display(){this._renderer.display(this._root,this._camera)}reshape(e,t){this._camera.viewport=new bg.Viewport(0,0,e,t),this._camera.projection.perspective(60,this._camera.viewport.aspectRatio,.1,100)}mouseDown(e){this._inputVisitor.mouseDown(this._root,e)}mouseDrag(e){this._inputVisitor.mouseDrag(this._root,e),this.postRedisplay()}mouseWheel(e){this._inputVisitor.mouseWheel(this._root,e),this.postRedisplay()}touchStart(e){this._inputVisitor.touchStart(this._root,e)}touchMove(e){this._inputVisitor.touchMove(this._root,e),this.postRedisplay()}mouseUp(e){this._inputVisitor.mouseUp(this._root,e)}mouseMove(e){this._inputVisitor.mouseMove(this._root,e)}mouseOut(e){this._inputVisitor.mouseOut(this._root,e)}touchEnd(e){this._inputVisitor.touchEnd(this._root,e)}}(e),n=bg.app.MainLoop.singleton;return n.updateMode=bg.app.FrameUpdate.AUTO,n.canvas=t,n.run(i),i.loaded()}function onYouTubeIframeAPIReady(){paella.youtubePlayerVars.apiReadyPromise.resolve()}paella.addPlugin(function(){return class extends paella.userTracking.SaverPlugIn{getName(){return"es.upv.paella.usertracking.piwikSaverPlugIn"}checkEnabled(e){this.config.tracker&&this.config.siteId?(_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){var t=this.config.tracker;_paq.push(["setTrackerUrl",t+"/piwik.php"]),_paq.push(["setSiteId",this.config.siteId]);var a=document,i=a.createElement("script"),n=a.getElementsByTagName("script")[0];i.type="text/javascript",i.async=!0,i.defer=!0,i.src=t+"piwik.js",n.parentNode.insertBefore(i,n),e(!0)}()):e(!1)}log(e,t){var a=this.config.category||"PaellaPlayer",i=e,n="";try{n=JSON.stringify(t)}catch(e){}_paq.push(["trackEvent",a,i,n])}}}),Class("paella.Video360",paella.VideoElementBase,{_posterFrame:null,_currentQuality:null,_autoplay:!1,_streamName:null,initialize:function(e,t,a,i,n,r,s){this.parent(e,t,"canvas",0,0,1280,720),this._streamName=s||"video360";var l=this;paella.player.videoContainer.disablePlayOnClick(),this._stream.sources[this._streamName]&&this._stream.sources[this._streamName].sort(function(e,t){return e.res.h-t.res.h}),this.video=null,new paella.Timer(function(e){l.canvasController&&l.canvasController.canvas.domElement},500).repeat=!0},defaultProfile:function(){return"chroma"},_setVideoElem:function(e){$(this.video).bind("progress",evtCallback),$(this.video).bind("loadstart",evtCallback),$(this.video).bind("loadedmetadata",evtCallback),$(this.video).bind("canplay",evtCallback),$(this.video).bind("oncanplay",evtCallback)},_loadDeps:function(){return new Promise((e,t)=>{window.$paella_bg2e?defer.resolve(window.$paella_bg2e):paella.require(paella.baseUrl+"resources/deps/bg2e.js").then(()=>{window.$paella_bg2e=bg,e(window.$paella_bg2e)}).catch(e=>{console.error(e.message),t()})})},_deferredAction:function(e){return new Promise((t,a)=>{this.video?t(e()):$(this.video).bind("canplay",()=>{this._ready=!0,t(e())})})},_getQualityObject:function(e,t){return{index:e,res:t.res,src:t.src,toString:function(){return this.res.w+"x"+this.res.h},shortLabel:function(){return this.res.h+"p"},compare:function(e){return this.res.w*this.res.h-e.res.w*e.res.h}}},allowZoom:()=>!1,getVideoData:function(){var e=this;return new Promise((t,a)=>{this._deferredAction(()=>{t({duration:e.video.duration,currentTime:e.video.currentTime,volume:e.video.volume,paused:e.video.paused,ended:e.video.ended,res:{w:e.video.videoWidth,h:e.video.videoHeight}})})})},setPosterFrame:function(e){this._posterFrame=e},setAutoplay:function(e){this._autoplay=e,e&&this.video&&this.video.setAttribute("autoplay",e)},load:function(){return new Promise((e,t)=>{this._loadDeps().then(()=>{var a=this._stream.sources[this._streamName];null===this._currentQuality&&this._videoQualityStrategy&&(this._currentQuality=this._videoQualityStrategy.getQualityIndex(a));var i=this._currentQuality<a.length?a[this._currentQuality]:null;this.video=null,i?(this.canvasController=null,buildVideo360Canvas(i,this.domElement).then(t=>{this.canvasController=t,this.video=t.video,this.video.pause(),this.disableEventCapture(),e(i)})):t(new Error("Could not load video: invalid quality stream index"))})})},getQualities:function(){return new Promise((e,t)=>{setTimeout(()=>{var t=[],a=-1;this._stream.sources[this._streamName].forEach(e=>{a++,t.push(this._getQualityObject(a,e))}),e(t)},10)})},setQuality:function(e){return new Promise(t=>{var a=this.video.paused,i=this._stream.sources[this._streamName];this._currentQuality=e<i.length?e:0;var n=this.video.currentTime;this.freeze().then(()=>(this._ready=!1,this.load())).then(()=>{a||this.play(),$(this.video).on("seeked",()=>{this.unFreeze(),t(),$(this.video).off("seeked")}),this.video.currentTime=n})})},getCurrentQuality:function(){return new Promise(e=>{e(this._getQualityObject(this._currentQuality,this._stream.sources[this._streamName][this._currentQuality]))})},play:function(){return this._deferredAction(()=>{bg.app.MainLoop.singleton.updateMode=bg.app.FrameUpdate.AUTO,this.video.play()})},pause:function(){return this._deferredAction(()=>{bg.app.MainLoop.singleton.updateMode=bg.app.FrameUpdate.MANUAL,this.video.pause()})},isPaused:function(){return this._deferredAction(()=>this.video.paused)},duration:function(){return this._deferredAction(()=>this.video.duration)},setCurrentTime:function(e){return this._deferredAction(()=>{this.video.currentTime=e,$(this.video).on("seeked",()=>{this.canvasController.postRedisplay(),$(this.video).off("seeked")})})},currentTime:function(){return this._deferredAction(()=>this.video.currentTime)},setVolume:function(e){return this._deferredAction(()=>{this.video.volume=e})},volume:function(){return this._deferredAction(()=>this.video.volume)},setPlaybackRate:function(e){return this._deferredAction(()=>{this.video.playbackRate=e})},playbackRate:function(){return this._deferredAction(()=>this.video.playbackRate)},goFullScreen:function(){return this._deferredAction(()=>{var e=this.video;e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitEnterFullscreen&&e.webkitEnterFullscreen()})},unFreeze:function(){return this._deferredAction(()=>{var e=document.getElementById(this.video.className+"canvas");$(e).remove()})},freeze:function(){return this._deferredAction(function(){})},unload:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()},getDimensions:function(){return paella_DeferredNotImplemented()}}),Class("paella.videoFactories.Video360Factory",{isStreamCompatible:function(e){try{if(paella.ChromaVideo._loaded)return!1;if(paella.videoFactories.Html5VideoFactory.s_instances>0&&base.userAgent.system.iOS)return!1;for(var t in e.sources)if("video360"==t)return!0}catch(e){}return!1},getVideoObject:function(e,t,a){return paella.ChromaVideo._loaded=!0,++paella.videoFactories.Html5VideoFactory.s_instances,new paella.Video360(e,t,a.x,a.y,a.w,a.h)}}),Class("paella.Video360Theta",paella.VideoElementBase,{_posterFrame:null,_currentQuality:null,_autoplay:!1,_streamName:null,initialize:function(e,t,a,i,n,r,s){this.parent(e,t,"canvas",0,0,1280,720),this._streamName=s||"video360theta";var l=this;paella.player.videoContainer.disablePlayOnClick(),this._stream.sources[this._streamName]&&this._stream.sources[this._streamName].sort(function(e,t){return e.res.h-t.res.h}),this.video=null,new paella.Timer(function(e){l.canvasController&&l.canvasController.canvas.domElement},500).repeat=!0},defaultProfile:function(){return"chroma"},_setVideoElem:function(e){$(this.video).bind("progress",evtCallback),$(this.video).bind("loadstart",evtCallback),$(this.video).bind("loadedmetadata",evtCallback),$(this.video).bind("canplay",evtCallback),$(this.video).bind("oncanplay",evtCallback)},_loadDeps:function(){return new Promise((e,t)=>{window.$paella_bg2e?defer.resolve(window.$paella_bg2e):paella.require(paella.baseUrl+"resources/deps/bg2e.js").then(()=>{window.$paella_bg2e=bg,e(window.$paella_bg2e)}).catch(e=>{console.error(e.message),t()})})},_deferredAction:function(e){return new Promise((t,a)=>{this.video?t(e()):$(this.video).bind("canplay",()=>{this._ready=!0,t(e())})})},_getQualityObject:function(e,t){return{index:e,res:t.res,src:t.src,toString:function(){return this.res.w+"x"+this.res.h},shortLabel:function(){return this.res.h+"p"},compare:function(e){return this.res.w*this.res.h-e.res.w*e.res.h}}},allowZoom:()=>!1,getVideoData:function(){var e=this;return new Promise((t,a)=>{this._deferredAction(()=>{t({duration:e.video.duration,currentTime:e.video.currentTime,volume:e.video.volume,paused:e.video.paused,ended:e.video.ended,res:{w:e.video.videoWidth,h:e.video.videoHeight}})})})},setPosterFrame:function(e){this._posterFrame=e},setAutoplay:function(e){this._autoplay=e,e&&this.video&&this.video.setAttribute("autoplay",e)},load:function(){return new Promise((e,t)=>{this._loadDeps().then(()=>{var a=this._stream.sources[this._streamName];null===this._currentQuality&&this._videoQualityStrategy&&(this._currentQuality=this._videoQualityStrategy.getQualityIndex(a));var i=this._currentQuality<a.length?a[this._currentQuality]:null;this.video=null,i?(this.canvasController=null,buildVideo360ThetaCanvas(i,this.domElement).then(t=>{this.canvasController=t,this.video=t.video,this.video.pause(),this.disableEventCapture(),e(i)})):t(new Error("Could not load video: invalid quality stream index"))})})},getQualities:function(){return new Promise((e,t)=>{setTimeout(()=>{var t=[],a=-1;this._stream.sources[this._streamName].forEach(e=>{a++,t.push(this._getQualityObject(a,e))}),e(t)},10)})},setQuality:function(e){return new Promise(t=>{var a=this.video.paused,i=this._stream.sources[this._streamName];this._currentQuality=e<i.length?e:0;var n=this.video.currentTime;this.freeze().then(()=>(this._ready=!1,this.load())).then(()=>{a||this.play(),$(this.video).on("seeked",()=>{this.unFreeze(),t(),$(this.video).off("seeked")}),this.video.currentTime=n})})},getCurrentQuality:function(){return new Promise(e=>{e(this._getQualityObject(this._currentQuality,this._stream.sources[this._streamName][this._currentQuality]))})},play:function(){return this._deferredAction(()=>{bg.app.MainLoop.singleton.updateMode=bg.app.FrameUpdate.AUTO,this.video.play()})},pause:function(){return this._deferredAction(()=>{bg.app.MainLoop.singleton.updateMode=bg.app.FrameUpdate.MANUAL,this.video.pause()})},isPaused:function(){return this._deferredAction(()=>this.video.paused)},duration:function(){return this._deferredAction(()=>this.video.duration)},setCurrentTime:function(e){return this._deferredAction(()=>{this.video.currentTime=e,$(this.video).on("seeked",()=>{this.canvasController.postRedisplay(),$(this.video).off("seeked")})})},currentTime:function(){return this._deferredAction(()=>this.video.currentTime)},setVolume:function(e){return this._deferredAction(()=>{this.video.volume=e})},volume:function(){return this._deferredAction(()=>this.video.volume)},setPlaybackRate:function(e){return this._deferredAction(()=>{this.video.playbackRate=e})},playbackRate:function(){return this._deferredAction(()=>this.video.playbackRate)},goFullScreen:function(){return this._deferredAction(()=>{var e=this.video;e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitEnterFullscreen&&e.webkitEnterFullscreen()})},unFreeze:function(){return this._deferredAction(()=>{var e=document.getElementById(this.video.className+"canvas");$(e).remove()})},freeze:function(){return this._deferredAction(function(){})},unload:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()},getDimensions:function(){return paella_DeferredNotImplemented()}}),Class("paella.videoFactories.Video360ThetaFactory",{isStreamCompatible:function(e){try{if(paella.ChromaVideo._loaded)return!1;if(paella.videoFactories.Html5VideoFactory.s_instances>0&&base.userAgent.system.iOS)return!1;for(var t in e.sources)if("video360theta"==t)return!0}catch(e){}return!1},getVideoObject:function(e,t,a){return paella.ChromaVideo._loaded=!0,++paella.videoFactories.Html5VideoFactory.s_instances,new paella.Video360Theta(e,t,a.x,a.y,a.w,a.h)}}),paella.addDataDelegate("metadata",()=>(class extends paella.DataDelegate{read(e,t,a){a(paella.player.videoLoader.getMetadata()[t],!0)}write(e,t,a,i){i({},!0)}remove(e,t,a){a({},!0)}})),paella.addPlugin(function(){return class extends paella.VideoOverlayButtonPlugin{getIndex(){return 10}getSubclass(){return"videoData"}getAlignment(){return"left"}getDefaultToolTip(){return""}checkEnabled(e){let t=paella.player.config.plugins.list["es.upv.paella.videoDataPlugin"],a=t&&t.excludeLocations||[],i=t&&t.excludeParentLocations||[],n=a.some(e=>{return RegExp(e,"i").test(location.href)});window!=window.parent&&(n=n||i.some(e=>{let t=RegExp(e,"i");try{return t.test(parent.location.href)}catch(e){return!1}})),e(!n)}setup(){let e=document.createElement("h1");e.innerHTML="",e.className="videoTitle",this.button.appendChild(e),paella.data.read("metadata","title",function(t){e.innerHTML=t})}action(e){}getName(){return"es.upv.paella.videoDataPlugin"}}}),paella.addPlugin(function(){let e=320,t=180;return class extends paella.VideoOverlayButtonPlugin{getIndex(){return 10}getSubclass(){return"videoZoom"}getAlignment(){return"right"}getDefaultToolTip(){return""}checkEnabled(e){e(!0)}setup(){function a(){let e=$(".videoZoomButton"),t=$(".videoZoom");this._visible?(e.show(),t.show()):(e.hide(),t.hide())}this._thumbnails=[],this._visible=!1,paella.player.videoContainer.videoPlayers().then(i=>{i.forEach((i,n)=>{i.allowZoom()&&(this._visible=i.zoomAvailable(),function(e){let t=e.parent.domElement,a=document.createElement("button");t.appendChild(a),a.className="videoZoomButton btn zoomIn",a.innerHTML='<i class="glyphicon glyphicon-zoom-in"></i>',$(a).on("mousedown",()=>{paella.player.videoContainer.disablePlayOnClick(),e.zoomIn()}),$(a).on("mouseup",()=>{setTimeout(()=>paella.player.videoContainer.enablePlayOnClick(),10)}),a=document.createElement("button"),t.appendChild(a),a.className="videoZoomButton btn zoomOut",a.innerHTML='<i class="glyphicon glyphicon-zoom-out"></i>',$(a).on("mousedown",()=>{paella.player.videoContainer.disablePlayOnClick(),e.zoomOut()}),$(a).on("mouseup",()=>{setTimeout(()=>paella.player.videoContainer.enablePlayOnClick(),10)})}.apply(this,[i]),i.supportsCaptureFrame().then(r=>{if(r){let r=document.createElement("div");r.className="zoom-container";let s=function(a){let i=document.createElement("canvas");return i.width=e,i.height=t,i.className="zoom-thumbnail",i.id="zoomContainer"+a,i}.apply(this,[n]),l=function(){let e=document.createElement("div");return e.className="zoom-rect",e}.apply(this);this.button.appendChild(r),r.appendChild(s),r.appendChild(l),$(r).hide(),this._thumbnails.push({player:i,thumbContainer:r,zoomRect:l,canvas:s}),a.apply(this)}}))})});let i=!1;paella.events.bind(paella.events.play,a=>{let n=()=>{this._thumbnails.forEach(a=>{!function(a){let i=a.player,n=a.canvas;i.captureFrame().then(a=>{n.getContext("2d").drawImage(a.source,0,0,e,t)})}(a)}),i&&setTimeout(()=>{n()},2e3)};i=!0,n()}),paella.events.bind(paella.events.pause,e=>{i=!1}),paella.events.bind(paella.events.videoZoomChanged,(e,t)=>{this._thumbnails.some(e=>{if(e.player==t.video){if(e.player.zoom>100){$(e.thumbContainer).show();let a=100*t.video.zoomOffset.x/t.video.zoom,i=100*t.video.zoomOffset.y/t.video.zoom,n=e.zoomRect;$(n).css({left:a+"%",top:i+"%",width:1e4/t.video.zoom+"%",height:1e4/t.video.zoom+"%"})}else $(e.thumbContainer).hide();return!0}})}),paella.events.bind(paella.events.zoomAvailabilityChanged,(e,t)=>{this._visible=t.available,a.apply(this)})}action(e){}getName(){return"es.upv.paella.videoZoomPlugin"}}}),paella.addPlugin(function(){return class extends paella.ButtonPlugin{getAlignment(){return"right"}getSubclass(){return"videoZoomToolbar"}getIconClass(){return"icon-screen"}getIndex(){return 2030}getMinWindowSize(){return paella.player.config.player&&paella.player.config.player.videoZoom&&paella.player.config.player.videoZoom.minWindowSize||600}getName(){return"es.upv.paella.videoZoomToolbarPlugin"}getDefaultToolTip(){return base.dictionary.translate("Change theme")}getButtonType(){return paella.ButtonPlugin.type.popUpButton}checkEnabled(e){paella.player.videoContainer.videoPlayers().then(t=>{let a=paella.player.config.plugins.list["es.upv.paella.videoZoomToolbarPlugin"].targetStreamIndex;this.targetPlayer=t.length>a?t[a]:null,e(paella.player.config.player.videoZoom.enabled&&this.targetPlayer&&this.targetPlayer.allowZoom())})}buildContent(e){function t(e,t){let a=document.createElement("div");return a.className=`videoZoomToolbarItem ${e}`,a.innerHTML=`<i class="glyphicon glyphicon-${e}"></i>`,$(a).click(t),a}paella.events.bind(paella.events.videoZoomChanged,(e,t)=>{this.setText(Math.round(t.video.zoom)+"%")}),this.setText("100%"),e.appendChild(t("zoom-in",e=>{this.targetPlayer.zoomIn()})),e.appendChild(t("zoom-out",e=>{this.targetPlayer.zoomOut()}))}}}),paella.addPlugin(function(){return class extends paella.ButtonPlugin{getAlignment(){return"right"}getSubclass(){return"showViewModeButton"}getIconClass(){return"icon-presentation-mode"}getIndex(){return 540}getMinWindowSize(){return 300}getName(){return"es.upv.paella.viewModePlugin"}getButtonType(){return paella.ButtonPlugin.type.popUpButton}getDefaultToolTip(){return base.dictionary.translate("Change video layout")}checkEnabled(e){this.buttonItems=null,this.buttons=[],this.selected_button=null,this.active_profiles=null,this.active_profiles=this.config.activeProfiles,e(!paella.player.videoContainer.isMonostream)}closeOnMouseOut(){return!0}setup(){var e=this,t=13,a=38,i=40;paella.events.bind(paella.events.setProfile,function(t,a){e.onProfileChange(a.profileName)}),$(this.button).keyup(function(n){e.isPopUpOpen()&&(n.keyCode==a?e.selected_button>0&&(e.selected_button<e.buttons.length&&(e.buttons[e.selected_button].className="viewModeItemButton "+e.buttons[e.selected_button].data.profile),e.selected_button--,e.buttons[e.selected_button].className=e.buttons[e.selected_button].className+" selected"):n.keyCode==i?e.selected_button<e.buttons.length-1&&(e.selected_button>=0&&(e.buttons[e.selected_button].className="viewModeItemButton "+e.buttons[e.selected_button].data.profile),e.selected_button++,e.buttons[e.selected_button].className=e.buttons[e.selected_button].className+" selected"):n.keyCode==t&&e.onItemClick(e.buttons[e.selected_button],e.buttons[e.selected_button].data.profile,e.buttons[e.selected_button].data.profile))})}buildContent(e){var t=this;this.buttonItems={},paella.Profiles.loadProfileList(function(a){Object.keys(a).forEach(function(i){if(!a[i].hidden){if(t.active_profiles){var n=!1;if(t.active_profiles.forEach(function(e){e==i&&(n=!0)}),0==n)return}var r=paella.player.videoContainer.sourceData[0].sources;if(("s_p_blackboard2"!=i||0!=r.hasOwnProperty("image"))&&("chroma"!=i||r.chroma)){var s=a[i],l=t.getProfileItemButton(i,s);t.buttonItems[i]=l,e.appendChild(l),t.buttons.push(l),paella.player.selectedProfile==i&&(t.buttonItems[i].className=t.getButtonItemClass(i,!0))}}}),t.selected_button=t.buttons.length})}getProfileItemButton(e,t){var a=document.createElement("div");return a.className=this.getButtonItemClass(e,!1),a.id=e+"_button",a.data={profile:e,profileData:t,plugin:this},$(a).click(function(e){this.data.plugin.onItemClick(this,this.data.profile,this.data.profileData)}),a}onProfileChange(e){var t=this,a=this.buttonItems[e],i=this.buttonItems;Object.keys(i).forEach(function(e){t.buttonItems[e].className=t.getButtonItemClass(e,!1)}),a&&(a.className=t.getButtonItemClass(e,!0))}onItemClick(e,t,a){this.buttonItems[t]&&paella.player.setProfile(t),paella.player.controls.hidePopUp(this.getName())}getButtonItemClass(e,t){return"viewModeItemButton "+e+(t?" selected":"")}}}),paella.addPlugin(function(){return class extends paella.ButtonPlugin{getAlignment(){return"left"}getSubclass(){return"volumeRangeButton"}getIconClass(){return"icon-volume-high"}getName(){return"es.upv.paella.volumeRangePlugin"}getButtonType(){return paella.ButtonPlugin.type.popUpButton}getDefaultToolTip(){return base.dictionary.translate("Volume")}getIndex(){return 120}closeOnMouseOut(){return!0}checkEnabled(e){this._tempMasterVolume=0,this._inputMaster=null,this._control_NotMyselfEvent=!0,this._storedValue=!1,e(!base.userAgent.browser.IsMobileVersion)}setup(){var e=this;paella.events.bind(paella.events.videoUnloaded,function(t,a){e.storeVolume()}),paella.events.bind(paella.events.singleVideoReady,function(t,a){e.loadStoredVolume(a)}),paella.events.bind(paella.events.setVolume,function(t,a){e.updateVolumeOnEvent(a)})}updateVolumeOnEvent(e){this._control_NotMyselfEvent?this._inputMaster=e.master:this._control_NotMyselfEvent=!0}storeVolume(){var e=this;paella.player.videoContainer.mainAudioPlayer().volume().then(function(t){e._tempMasterVolume=t,e._storedValue=!0})}loadStoredVolume(e){0==this._storedValue&&this.storeVolume(),this._tempMasterVolume&&paella.player.videoContainer.setVolume({master:this._tempMasterVolume}),this._storedValue=!1}buildContent(e){var t=this,a=document.createElement("div");a.className="videoRangeContainer";var i=document.createElement("div");i.className="range";var n=document.createElement("div");n.className="image master";var r=document.createElement("input");function s(){var e=$(r).val();t._control_NotMyselfEvent=!1,paella.player.videoContainer.setVolume({master:e})}t._inputMaster=r,r.type="range",r.min=0,r.max=1,r.step=.01,paella.player.videoContainer.masterVideo().volume().then(e=>{r.value=e}),$(r).bind("input",function(e){s()}),$(r).change(function(){s()}),i.appendChild(n),i.appendChild(r),a.appendChild(i),paella.events.bind(paella.events.setVolume,(e,t)=>{r.value=t.master,this.updateClass()}),e.appendChild(a),t.updateClass();var l=37,o=39;$(this.button).keyup(function(e){t.isPopUpOpen()&&paella.player.videoContainer.volume().then(t=>{let a=-1;e.keyCode==l?a=t-.1:e.keyCode==o&&(a=t+.1),-1!=a&&(a=a<0?0:a>1?1:a,paella.player.videoContainer.setVolume(a).then(e=>{}))})})}updateClass(){var e="";paella.player.videoContainer.mainAudioPlayer().volume().then(t=>{e=void 0===t?"icon-volume-mid":0==t?"icon-volume-mute":t<.33?"icon-volume-low":t<.66?"icon-volume-mid":"icon-volume-high",this.changeIconClass(e)})}}}),Class("paella.videoFactories.WebmVideoFactory",{webmCapable:function(){var e=document.createElement("video");return!!e.canPlayType&&""!==e.canPlayType('video/webm; codecs="vp8, vorbis"')},isStreamCompatible:function(e){try{if(!this.webmCapable())return!1;for(var t in e.sources)if("webm"==t)return!0}catch(e){}return!1},getVideoObject:function(e,t,a){return new paella.Html5Video(e,t,a.x,a.y,a.w,a.h,"webm")}}),paella.addPlugin(function(){return class extends paella.EventDrivenPlugin{getName(){return"es.upv.paella.windowTitlePlugin"}checkEnabled(e){this._initDone=!1,paella.player.videoContainer.masterVideo().duration().then(e=>{this.loadTitle()}),e(!0)}loadTitle(){var e=paella.player.videoLoader.getMetadata()&&paella.player.videoLoader.getMetadata().title;document.title=e||document.title,this._initDone=!0}}}),Class("paella.YoutubeVideo",paella.VideoElementBase,{_posterFrame:null,_currentQuality:null,_autoplay:!1,_readyPromise:null,initialize:function(e,t,a,i,n,r){this.parent(e,t,"div",a,i,n,r);var s=this;this._readyPromise=$.Deferred(),Object.defineProperty(this,"video",{get:function(){return s._youtubePlayer}})},_deferredAction:function(e){return new Promise((t,a)=>{this._readyPromise.then(function(){t(e())},function(){a()})})},_getQualityObject:function(e,t){var a=0;switch(t){case"small":a=1;break;case"medium":a=2;break;case"large":a=3;break;case"hd720":a=4;break;case"hd1080":a=5;break;case"highres":a=6}return{index:e,res:{w:null,h:null},src:null,label:t,level:a,bitrate:a,toString:function(){return this.label},shortLabel:function(){return this.label},compare:function(e){return this.level-e.level}}},_onStateChanged:function(e){console.log("On state changed")},getVideoData:function(){var e=this;return new Promise((t,a)=>{var i=this._stream.sources.youtube[0];this._deferredAction(()=>{var a={duration:e.video.getDuration(),currentTime:e.video.getCurrentTime(),volume:e.video.getVolume(),paused:!e._playing,ended:e.video.ended,res:{w:i.res.w,h:i.res.h}};t(a)})})},setPosterFrame:function(e){this._posterFrame=e},setAutoplay:function(e){this._autoplay=e},setRect:function(e,t){this._rect=JSON.parse(JSON.stringify(e));var a=new paella.RelativeVideoSize,i={top:a.percentVSize(e.top)+"%",left:a.percentWSize(e.left)+"%",width:a.percentWSize(e.width)+"%",height:a.percentVSize(e.height)+"%",position:"absolute"};if(t){this.disableClassName();var n=this;$("#"+this.identifier).animate(i,400,function(){n.enableClassName(),paella.events.trigger(paella.events.setComposition,{video:n})}),this.enableClassNameAfter(400)}else $("#"+this.identifier).css(i),paella.events.trigger(paella.events.setComposition,{video:this})},setVisible:function(e,t){"true"==e&&t?($("#"+this.identifier).show(),$("#"+this.identifier).animate({opacity:1},300)):"true"!=e||t?"false"==e&&t?$("#"+this.identifier).animate({opacity:0},300):"false"!=e||t||$("#"+this.identifier).hide():$("#"+this.identifier).show()},setLayer:function(e){$("#"+this.identifier).css({zIndex:e})},load:function(){var e=this;return new Promise((t,a)=>{this._qualityListReadyPromise=$.Deferred(),paella.youtubePlayerVars.apiReadyPromise.then(()=>{var i=this._stream.sources.youtube[0];i?(this._youtubePlayer=new YT.Player(e.identifier,{height:"390",width:"640",videoId:i.id,playerVars:{controls:0,disablekb:1},events:{onReady:function(t){e._readyPromise.resolve()},onStateChanged:function(e){console.log("state changed")},onPlayerStateChange:function(e){console.log("state changed")}}}),t()):a(new Error("Could not load video: invalid quality stream index"))})})},getQualities:function(){let e=this;return new Promise((t,a)=>{e._qualityListReadyPromise.then(function(a){var i=[],n=-1;e._qualities={},a.forEach(t=>{n++,e._qualities[t]=e._getQualityObject(n,t),i.push(e._qualities[t])}),t(i)})})},setQuality:function(e){return new Promise((t,a)=>{this._qualityListReadyPromise.then(a=>{for(var i in this._qualities){var n=this._qualities[i];if("object"==typeof n&&n.index==e){this.video.setPlaybackQuality(n.label);break}}t()})})},getCurrentQuality:function(){return new Promise((e,t)=>{this._qualityListReadyPromise.then(t=>{e(this._qualities[this.video.getPlaybackQuality()])})})},play:function(){let e=this;return new Promise((t,a)=>{e._playing=!0,e.video.playVideo(),new base.Timer(e=>{var a=this.video.getAvailableQualityLevels();a.length?(e.repeat=!1,this._qualityListReadyPromise.resolve(a),t()):e.repeat=!0},500)})},pause:function(){return this._deferredAction(()=>{this._playing=!1,this.video.pauseVideo()})},isPaused:function(){return this._deferredAction(()=>!this._playing)},duration:function(){return this._deferredAction(()=>this.video.getDuration())},setCurrentTime:function(e){return this._deferredAction(()=>{this.video.seekTo(e)})},currentTime:function(){return this._deferredAction(()=>this.video.getCurrentTime())},setVolume:function(e){return this._deferredAction(()=>{this.video.setVolume&&this.video.setVolume(100*e)})},volume:function(){return this._deferredAction(()=>this.video.getVolume()/100)},setPlaybackRate:function(e){return this._deferredAction(()=>{this.video.playbackRate=e})},playbackRate:function(){return this._deferredAction(()=>this.video.playbackRate)},goFullScreen:function(){return this._deferredAction(()=>{var e=this.video;e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitEnterFullscreen&&e.webkitEnterFullscreen()})},unFreeze:function(){return this._deferredAction(()=>{var e=document.getElementById(this.video.className+"canvas");$(e).remove()})},freeze:function(){return this._deferredAction(()=>{var e=document.createElement("canvas");e.id=this.video.className+"canvas",e.width=this.video.videoWidth,e.height=this.video.videoHeight,e.style.cssText=this.video.style.cssText,e.style.zIndex=2,e.getContext("2d").drawImage(this.video,0,0,16*Math.ceil(e.width/16),16*Math.ceil(e.height/16)),this.video.parentElement.appendChild(e)})},unload:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()},getDimensions:function(){return paella_DeferredNotImplemented()}}),Class("paella.videoFactories.YoutubeVideoFactory",{initYoutubeApi:function(){if(!this._initialized){var e=document.createElement("script");e.src="https://www.youtube.com/iframe_api";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t),paella.youtubePlayerVars={apiReadyPromise:new $.Deferred},this._initialized=!0}},isStreamCompatible:function(e){try{for(var t in e.sources)if("youtube"==t)return!0}catch(e){}return!1},getVideoObject:function(e,t,a){return this.initYoutubeApi(),new paella.YoutubeVideo(e,t,a.x,a.y,a.w,a.h)}}),paella.addPlugin(function(){return class extends paella.EventDrivenPlugin{getIndex(){return 20}getAlignment(){return"right"}getSubclass(){return"zoomButton"}getDefaultToolTip(){return base.dictionary.translate("Zoom")}getEvents(){return[paella.events.timeUpdate,paella.events.setComposition,paella.events.loadPlugins,paella.events.play]}onEvent(e,t){switch(e){case paella.events.timeUpdate:this.imageUpdate(e,t);break;case paella.events.setComposition:this.compositionChanged(e,t);break;case paella.events.loadPlugins:this.loadPlugin(e,t);break;case paella.events.play:this.exitPhotoMode()}}checkEnabled(e){if(paella.player.videoContainer.sourceData.length<2)return this._zImages=null,this._imageNumber=null,this._isActivated=!1,this._isCreated=!1,this._keys=null,this._ant=null,this._next=null,this._videoLength=null,this._compChanged=!1,this._restartPlugin=!1,this._actualImage=null,this._zoomIncr=null,this._maxZoom=null,this._minZoom=null,this._dragMode=!1,this._mouseDownPosition=null,void e(!1);paella.player.videoContainer.sourceData[0].sources.hasOwnProperty("image")?e(!0):e(!1)}setupIcons(){var e=$(".zoomFrame").width(),t=document.createElement("div");t.className="arrowsLeft",t.style.display="none";var a=document.createElement("div");a.className="arrowsRight",a.style.display="none",a.style.left=e-24+"px",$(t).click(()=>{this.arrowCallLeft(),event.stopPropagation()}),$(a).click(()=>{this.arrowCallRight(),event.stopPropagation()});var i=document.createElement("div");i.className="iconsFrame";var n=document.createElement("button");n.className="zoomActionButton buttonZoomIn",n.style.display="none";var r=document.createElement("button");r.className="zoomActionButton buttonZoomOut",r.style.display="none";var s=document.createElement("button");s.className="zoomActionButton buttonSnapshot",s.style.display="none";var l=document.createElement("button");l.className="zoomActionButton buttonZoomOn",$(i).append(l),$(i).append(s),$(i).append(n),$(i).append(r),$(".newframe").append(i),$(".newframe").append(t),$(".newframe").append(a),$(l).click(()=>{this._isActivated?(this.exitPhotoMode(),$(".zoomActionButton.buttonZoomOn").removeClass("clicked")):(this.enterPhotoMode(),$(".zoomActionButton.buttonZoomOn").addClass("clicked")),event.stopPropagation()}),$(s).click(()=>{null!=this._actualImage&&window.open(this._actualImage,"_blank"),event.stopPropagation()}),$(n).click(()=>{this.zoomIn(),event.stopPropagation()}),$(r).click(()=>{this.zoomOut(),event.stopPropagation()})}enterPhotoMode(){$(".zoomFrame").show(),$(".zoomFrame").css("opacity","1"),this._isActivated=!0,$(".buttonSnapshot").show(),$(".buttonZoomOut").show(),$(".buttonZoomIn").show(),$(".arrowsRight").show(),$(".arrowsLeft").show(),paella.player.pause(),this._imageNumber<=1?$(".arrowsLeft").hide():this._isActivated&&$(".arrowsLeft").show(),this._imageNumber>=this._keys.length-2?$(".arrowsRight").hide():this._isActivated&&$(".arrowsRight").show()}exitPhotoMode(){$(".zoomFrame").hide(),this._isActivated=!1,$(".buttonSnapshot").hide(),$(".buttonZoomOut").hide(),$(".buttonZoomIn").hide(),$(".arrowsRight").hide(),$(".arrowsLeft").hide(),$(".zoomActionButton.buttonZoomOn").removeClass("clicked")}setup(){this._maxZoom=this.config.maxZoom||500,this._minZoom=this.config.minZoom||100,this._zoomIncr=this.config.zoomIncr||10,this._zImages={},this._zImages=paella.player.videoContainer.sourceData[0].sources.image[0].frames,this._videoLength=paella.player.videoContainer.sourceData[0].sources.image[0].duration,this._keys=Object.keys(this._zImages),this._keys=this._keys.sort(function(e,t){return e=e.slice(6),t=t.slice(6),parseInt(e)-parseInt(t)}),this._next=0,this._ant=0}loadPlugin(){0==this._isCreated&&(this.createOverlay(),this.setupIcons(),$(".zoomFrame").hide(),this._isActivated=!1,this._isCreated=!0)}imageUpdate(e,t){var a=Math.round(t.currentTime),i=$(".zoomFrame").css("background-image");if($(".newframe").length>0){if(this._zImages.hasOwnProperty("frame_"+a)){if(i==this._zImages["frame_"+a])return;i=this._zImages["frame_"+a]}else{if(!(a>this._next||a<this._ant||this._compChanged))return;this._compChanged&&(this._compChanged=!1),i=this.returnSrc(a)}$("#photo_01").attr("src",i).load();var n=new Image;n.onload=function(){$(".zoomFrame").css("background-image","url("+i+")")},n.src=i,this._actualImage=i,this._imageNumber<=1?$(".arrowsLeft").hide():this._isActivated&&$(".arrowsLeft").show(),this._imageNumber>=this._keys.length-2?$(".arrowsRight").hide():this._isActivated&&$(".arrowsRight").show()}}returnSrc(e){var t=0;for(i=0;i<this._keys.length;i++){var a=parseInt(this._keys[i].slice(6)),n=parseInt(this._keys[this._keys.length-1].slice(6));if(e<a)return this._next=a,this._ant=t,this._imageNumber=i-1,this._zImages["frame_"+t];if(e>n&&e<this._videoLength)return this._next=this._videoLength,this._ant=n,this._zImages["frame_"+t];t=a}}arrowCallLeft(){if(this._imageNumber-1>=0){var e=this._keys[this._imageNumber-1];this._imageNumber-=1,paella.player.videoContainer.seekToTime(parseInt(e.slice(6)))}}arrowCallRight(){if(this._imageNumber+1<=this._keys.length){var e=this._keys[this._imageNumber+1];this._imageNumber+=1,paella.player.videoContainer.seekToTime(parseInt(e.slice(6)))}}createOverlay(){var e=document.createElement("div");e.className="newframe",overlayContainer=paella.player.videoContainer.overlayContainer,overlayContainer.addElement(e,overlayContainer.getMasterRect());var t=document.createElement("div");t.className="zoomFrame",e.insertBefore(t,e.firstChild),$(t).click(function(e){e.stopPropagation()}),$(t).bind("mousewheel",e=>{e.originalEvent.wheelDelta/120>0?this.zoomIn():this.zoomOut()}),$(t).mousedown(e=>{this.mouseDown(e.clientX,e.clientY)}),$(t).mouseup(e=>{this.mouseUp()}),$(t).mouseleave(e=>{this.mouseLeave()}),$(t).mousemove(e=>{this.mouseMove(e.clientX,e.clientY)})}mouseDown(e,t){this._dragMode=!0,this._mouseDownPosition={x:e,y:t}}mouseUp(){this._dragMode=!1}mouseLeave(){this._dragMode=!1}mouseMove(e,t){if(this._dragMode){$(".zoomFrame")[0];var a=this._backgroundPosition?this._backgroundPosition:{left:0,top:0},i=($(".zoomFrame").width(),$(".zoomFrame").height(),this._mouseDownPosition.x-e),n=this._mouseDownPosition.y-t,r=a.left+i,s=a.top+n;r=(r=r>=0?r:0)<=100?r:100,s=(s=s>=0?s:0)<=100?s:100,$(".zoomFrame").css("background-position",r+"% "+s+"%"),this._backgroundPosition={left:r,top:s},this._mouseDownPosition.x=e,this._mouseDownPosition.y=t}}zoomIn(){let e=$(".zoomFrame").css("background-size");e=e.split(" "),(e=parseInt(e[0]))<this._maxZoom&&$(".zoomFrame").css("background-size",e+this._zoomIncr+"% auto")}zoomOut(){let e=$(".zoomFrame").css("background-size");e=e.split(" "),(e=parseInt(e[0]))>this._minZoom&&$(".zoomFrame").css("background-size",e-this._zoomIncr+"% auto")}imageUpdateOnPause(e){var t=Math.round(e),a=$(".zoomFrame").css("background-image");if($(".newframe").length>0&&a!=this._actualImage){if(this._zImages.hasOwnProperty("frame_"+t)){if(a==this._zImages["frame_"+t])return;a=this._zImages["frame_"+t]}else this._compChanged=!1,a=this.returnSrc(t);$("#photo_01").attr("src",a).load();var i=new Image;i.onload=function(){$(".zoomFrame").css("background-image","url("+a+")")},i.src=a,this._actualImage=a}}compositionChanged(e,t){$(".newframe").remove(),this._isCreated=!1,paella.player.videoContainer.getMasterVideoRect().visible&&(this.loadPlugin(),paella.player.paused()&&paella.player.videoContainer.currentTime().then(e=>{this.imageUpdateOnPause(e)})),this._compChanged=!0}getName(){return"es.upv.paella.zoomPlugin"}}}),paella.addPlugin(function(){return class extends paella.userTracking.SaverPlugIn{getName(){return"org.opencast.usertracking.MatomoSaverPlugIn"}checkEnabled(e){var t=this.config.site_id,a=this.config.server,i=this.config.heartbeat,n=this;a&&t?("/"!=a.substr(-1)&&(a+="/"),require([a+"piwik.js"],function(e){base.log.debug("Matomo Analytics Enabled"),paella.userTracking.matomotracker=Piwik.getAsyncTracker(a+"piwik.php",t),paella.userTracking.matomotracker.client_id=n.config.client_id,i&&i>0&&paella.userTracking.matomotracker.enableHeartBeatTimer(i),Piwik&&Piwik.MediaAnalytics&&Piwik.MediaAnalytics.scanForMedia(),n.registerVisit()}),e(!0)):(base.log.debug("No Matomo Site ID found in config file. Disabling Matomo Analytics PlugIn"),e(!1))}registerVisit(){var e,t,a,i,n;paella.opencast&&paella.opencast._episode?(e=paella.opencast._episode.dcTitle,t=paella.opencast._episode.id,n=paella.opencast._episode.dcCreator,paella.userTracking.matomotracker.setCustomVariable(5,"client",paella.userTracking.matomotracker.client_id||"Paella Opencast")):paella.userTracking.matomotracker.setCustomVariable(5,"client",paella.userTracking.matomotracker.client_id||"Paella Standalone"),paella.opencast&&paella.opencast._episode&&paella.opencast._episode.mediapackage&&(i=paella.opencast._episode.mediapackage.series,a=paella.opencast._episode.mediapackage.seriestitle),e&&paella.userTracking.matomotracker.setCustomVariable(1,"event",e+" ("+t+")","page"),a&&paella.userTracking.matomotracker.setCustomVariable(2,"series",a+" ("+i+")","page"),n&&paella.userTracking.matomotracker.setCustomVariable(3,"presenter",n,"page"),paella.userTracking.matomotracker.setCustomVariable(4,"view_mode",void 0,"page"),e&&n?(paella.userTracking.matomotracker.setDocumentTitle(e+" - "+(n||"Unknown")),paella.userTracking.matomotracker.trackPageView(e+" - "+(n||"Unknown"))):paella.userTracking.matomotracker.trackPageView()}log(e,t){if(void 0!==paella.userTracking.matomotracker){if(void 0===this.config.category||!0===this.config.category){var a="";try{a=JSON.stringify(t)}catch(e){}switch(e){case paella.events.play:paella.userTracking.matomotracker.trackEvent("Player.Controls","Play");break;case paella.events.pause:paella.userTracking.matomotracker.trackEvent("Player.Controls","Pause");break;case paella.events.endVideo:paella.userTracking.matomotracker.trackEvent("Player.Status","Ended");break;case paella.events.showEditor:paella.userTracking.matomotracker.trackEvent("Player.Editor","Show");break;case paella.events.hideEditor:paella.userTracking.matomotracker.trackEvent("Player.Editor","Hide");break;case paella.events.enterFullscreen:paella.userTracking.matomotracker.trackEvent("Player.View","Fullscreen");break;case paella.events.exitFullscreen:paella.userTracking.matomotracker.trackEvent("Player.View","ExitFullscreen");break;case paella.events.loadComplete:paella.userTracking.matomotracker.trackEvent("Player.Status","LoadComplete");break;case paella.events.showPopUp:paella.userTracking.matomotracker.trackEvent("Player.PopUp","Show",a);break;case paella.events.hidePopUp:paella.userTracking.matomotracker.trackEvent("Player.PopUp","Hide",a);break;case paella.events.captionsEnabled:paella.userTracking.matomotracker.trackEvent("Player.Captions","Enabled",a);break;case paella.events.captionsDisabled:paella.userTracking.matomotracker.trackEvent("Player.Captions","Disabled",a);break;case paella.events.setProfile:paella.userTracking.matomotracker.trackEvent("Player.View","Profile",a);break;case paella.events.seekTo:case paella.events.seekToTime:paella.userTracking.matomotracker.trackEvent("Player.Controls","Seek",a);break;case paella.events.setVolume:paella.userTracking.matomotracker.trackEvent("Player.Settings","Volume",a);break;case paella.events.resize:paella.userTracking.matomotracker.trackEvent("Player.View","resize",a);break;case paella.events.setPlaybackRate:paella.userTracking.matomotracker.trackEvent("Player.Controls","PlaybackRate",a)}}}else base.log.debug("Matomo Tracker is missing")}}});