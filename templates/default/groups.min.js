var xoctGroup={selected_id:0,data_url:"",container:null,groups:[],participants:[],lng:[delete_group="Delete Group?",no_title="Please insert title",none_available="None available"],before_load:function(){},after_load:function(){},lngFromJson:function(a){this.lng=JSON.parse(a)},init:function(a,b,c,d){"undefined"!=typeof c&&(this.before_load=c),"undefined"!=typeof d&&(this.after_load=d),this.data_url=a,$(b).html("<ul id=\"xoct_groups\" class=\"list-group\"></ul>"),this.container=$("#xoct_groups"),this.load(),$(document).on("click",".xoct_group_delete",function(){xoctGroup.deleteGroup($(this).parent().data("group-id"))}),$(document).on("click",".xoct_group",function(){xoctGroup.selectGroup($(this).data("group-id"))})},clear:function(){this.container.empty(),this.selected_id=0},load:function(a,b){if(a="undefined"==typeof a?function(){}:a,b="undefined"!=typeof b&&b,b)var c=this.selected_id;var d=this;this.before_load();var e=this.data_url;$.ajax({url:e,type:"GET",data:{cmd:"getParticipants"}}).done(function(f){d.participants=f,$.ajax({url:e,type:"GET",data:{cmd:"getAll"}}).done(function(e){d.groups=e,d.loadGroupGUI(b,c),xoctGroupParticipant.clear(),xoctGroupParticipant.load(),d.after_load(),a()})})},loadGroupGUI:function(a,b){var c=this;for(let d in c.clear(),c.groups)c.container.append("<a class=\"list-group-item xoct_group\" data-group-id=\""+c.groups[d].id+"\">"+c.groups[d].title+"<button class=\"btn btn-danger xoct_group_delete pull-right\"><span class=\"glyphicon glyphicon-remove\"></span></button><Button class=\"btn pull-right\" id=\"xoct_user_counter_"+c.groups[d].id+"\">"+c.groups[d].users.length+"</button></li>");c.groups&&0!==c.groups.length||c.container.html("<li class=\"list-group-item\">"+c.lng.none_available+"</li>"),c.groups&&1===c.groups.length?c.selectGroup(c.groups[0].id):a&&c.selectGroup(b)},deleteGroup:function(a){var b=this.data_url,c=this;confirm(this.lng.delete_group)&&(this.before_load(),$.ajax({url:b,type:"GET",data:{cmd:"delete",id:a}}).done(function(){c.groups=c.groups.filter(function(b){return b.id.toString()!==a.toString()}),c.loadGroupGUI(),c.after_load()}))},selectGroup:function(a,b){b="undefined"!=typeof b&&b,this.selected_id!=a||b?(this.selected_id=a,this.deselectAll(),xoctGroupParticipant.load(),xoctGroupParticipant.loadForGroupId(a),$("[data-group-id=\""+a+"\"]").addClass("active")):(this.deselectAll(),this.selected_id=0)},deselectAll:function(){$(".xoct_group").each(function(){$(this).removeClass("active")}),xoctGroupParticipant.clear()},getGroup:function(a){var b=null;return this.groups.forEach(function(c){parseInt(c.id)===parseInt(a)&&(b=c)}),b},getSelectedGroup:function(){return this.getGroup(this.selected_id)},removeParticipant:function(a){this.getSelectedGroup().users=this.getSelectedGroup().users.filter(function(b){return b.toString()!==a.toString()}),$("#xoct_user_counter_"+this.selected_id).html(this.getSelectedGroup().users.length)},addParticipant:function(a){this.getSelectedGroup().users.push(a.toString()),$("#xoct_user_counter_"+this.selected_id).html(this.getSelectedGroup().users.length)},getSelectedGroupParticipants:function(){var a=this,b=this.getSelectedGroup(),c=[];for(let d in b.users)c.push(a.getParticipant(b.users[d]));return c},getAvailableParticipantsForSelectedGroup:function(){var a=this;if(0===a.selected_id)return a.participants;var b=this.getSelectedGroup(),c=[];for(let d in a.participants)b.users.includes(a.participants[d].user_id)||c.push(a.participants[d]);return c},isInAnyGroup:function(a){var b=!1;return this.groups.forEach(function(c){-1!==c.users.indexOf(a)&&(b=!0)}),b},getParticipant:function(a){return this.participants.find(function(b){return b.user_id===a})},create:function(a,b){if(!a)return void alert(this.lng.no_title);var c=this,d=this.data_url;this.deselectAll(),this.before_load(),$.ajax({url:d+"&cmd=create",type:"POST",data:{title:a}}).done(function(a){c.groups.push(a),c.loadGroupGUI(),c.after_load(),b(a)})}};